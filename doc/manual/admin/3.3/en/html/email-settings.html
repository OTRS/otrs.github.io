<html><head>
<!-- otrs.github.io -->
<link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="../../../../../documentation.reset.css">
<link rel="stylesheet" href="../../../../../documentation.design.css">
<script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="../../../../../documentation.js"></script>
<!-- otrs.github.io -->
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Email settings</title><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"><link rel="home" href="index.html" title="OTRS 3.3 - Admin Manual"><link rel="up" href="administration.html" title="Chapter 4. Administration"><link rel="prev" href="backup-and-restore.html" title="Backing up the system"><link rel="next" href="external-backends.html" title="Using external backends"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Email settings</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="backup-and-restore.html">Prev</a> </td><th width="60%" align="center">Chapter 4. Administration</th><td width="20%" align="right"> <a accesskey="n" href="external-backends.html">Next</a></td></tr></table><hr></div><div class="section" title="Email settings"><div class="titlepage"><div><div><h2 class="title"><a name="email-settings"></a>Email settings</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="email-settings.html#email">Sending/Receiving emails</a></span></dt><dd><dl><dt><span class="section"><a href="email-settings.html#email-sending">Sending emails</a></span></dt><dd><dl><dt><span class="section"><a href="email-settings.html#email-sending-sendmail">Via Sendmail (default)</a></span></dt><dt><span class="section"><a href="email-settings.html#email-sending-smtp">Via SMTP server or smarthost</a></span></dt></dl></dd><dt><span class="section"><a href="email-settings.html#email-receiving">Receiving emails</a></span></dt><dd><dl><dt><span class="section"><a href="email-settings.html#email-receiving-pop3">Mail accounts configured via the OTRS GUI</a></span></dt><dt><span class="section"><a href="email-settings.html#email-receiving-cmd">Via command line program and procmail (otrs.PostMaster.pl)</a></span></dt><dt><span class="section"><a href="email-settings.html#email-receiving-fetchmail">Fetching emails via POP3 or IMAP and fetchmail for otrs.PostMaster.pl</a></span></dt><dt><span class="section"><a href="email-settings.html#email-receiving-filter">Filtering/dispatching by OTRS/PostMaster modules (for more complex dispatching)</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="email-settings.html#configure-pgp">Secure email with PGP</a></span></dt><dt><span class="section"><a href="email-settings.html#smime">Secure email with S/MIME</a></span></dt></dl></div><div class="section" title="Sending/Receiving emails"><div class="titlepage"><div><div><h3 class="title"><a name="email"></a>Sending/Receiving emails</h3></div></div></div><div class="section" title="Sending emails"><div class="titlepage"><div><div><h4 class="title"><a name="email-sending"></a>Sending emails</h4></div></div></div><div class="section" title="Via Sendmail (default)"><div class="titlepage"><div><div><h5 class="title"><a name="email-sending-sendmail"></a>Via Sendmail (default)</h5></div></div></div><p>
OTRS can send out emails via <a class="ulink" href="http://www.sendmail.org/" target="_top">Sendmail</a>, <a class="ulink" href="http://www.postfix.org/" target="_top">Postfix</a>, <a class="ulink" href="http://www.qmail.org" target="_top">Qmail</a> or <a class="ulink" href="http://www.exim.org" target="_top">Exim</a>). The default configuration is to use Sendmail and should work out-of-the-box.
</p><p>
You can configure the sendmail settings via the graphical configuration frontend (Framework::Core::Sendmail)
</p></div><div class="section" title="Via SMTP server or smarthost"><div class="titlepage"><div><div><h5 class="title"><a name="email-sending-smtp"></a>Via SMTP server or smarthost</h5></div></div></div><p>
OTRS can send emails via SMTP (<a class="ulink" href="http://www.ietf.org/rfc/rfc821.txt" target="_top">Simple Mail Transfer Protocol / RFC 821</a>) or Secure SMTP. You will want to use this on non-UNIX platforms (e.g. Windows).
</p><p>
The SMTP server settings can be configured via the SysConfig (Framework::Core::Sendmail). If you don't see SMTPS available as an option, the required Perl modules are missing. In that case, please refer to <a class="link" href="manual-installation-of-otrs.html#installation-of-perl-modules" title="Installation of Perl modules">"Installation of Perl modules required for OTRS"</a> for instructions.
</p></div></div><div class="section" title="Receiving emails"><div class="titlepage"><div><div><h4 class="title"><a name="email-receiving"></a>Receiving emails</h4></div></div></div><div class="section" title="Mail accounts configured via the OTRS GUI"><div class="titlepage"><div><div><h5 class="title"><a name="email-receiving-pop3"></a>Mail accounts configured via the OTRS GUI</h5></div></div></div><p>
OTRS is able to receive emails from POP3, POP3S, IMAP, and IMAPS mail accounts.
</p><p>
Configure your mail accounts via the PostMaster Mail Accounts link on the Admin page.
</p><p>
If a new mail account is to be created (see Figure below), then its mail server name, login name and password must be specified. Also, you need to select the mail server type, which can be POP3, POP3S, IMAP or IMAPS. If you don't see your server type available as an option, the required Perl modules are missing on your system. In that case, please refer to <a class="link" href="manual-installation-of-otrs.html#installation-of-perl-modules" title="Installation of Perl modules"> "Installation of Perl modules required for OTRS"</a> for instructions.</p><p>
</p><div class="screenshot"><div><img src="screenshots/add-mailaccount.png"></div></div><p>
</p><p>
<span class="emphasis"><em>Figure: Adding a mail account.</em></span>
</p><p>If you select Yes for the value of the Trusted option, any X-OTRS headers attached to an incoming message are evaluated and executed. Because the X-OTRS header can execute some actions in the ticket system, you should set the Trusted option to Yes only for known senders. X-OTRS-Headers are used by the <a class="link" href="administration.html#adminarea-postmasterfilter" title="Filtering incoming email messages">filter module</a> in OTRS. The X-OTRS headers are explained <a class="link" href="administration.html#table-of-x-otrs-headers" title="Table 4.5. Function of the different X-OTRS-headers">in this table</a> in more detail. Any postmaster filter rules created are executed, irrespective of the Trusted option's setting.
</p><p>
The distribution of incoming messages can be controlled if they need to be sorted by queue or by the content of the "To:" field. For the Dispatching field, if "Dispatching by selected queue" is selected, all incoming messages will be sorted into the specified queue. The address where the mail was sent to is disregarded in this case. If "Dispatching by email To: field" is selected, the system checks if a queue is linked with the address in the To: field of the incoming mail. You can link an address to a queue in the <a class="link" href="administration.html#adminarea-emailaddresses" title="Email addresses">E-mail address management</a> section of the Admin page. If the address in the To: field is linked with a queue, the new message will be sorted into the linked queue. If no link is found between the address in the To: field and any queue, then the message flows into the "Raw" queue in the system, which is the <a class="link" href="Ticket.html#Ticket:Core::PostMaster:PostmasterDefaultQueue" title="PostmasterDefaultQueue">PostmasterDefaultQueue</a> after a default installation.
</p><p>
All data for the mail accounts are saved in the OTRS database. The <code class="filename">otrs.PostMasterMailbox.pl</code> script, which is located in the <code class="filename">bin</code> directory of your OTRS installation, uses the settings in the database and fetches the mail. You can execute <code class="filename">./bin/otrs.PostMasterMailbox.pl</code> manually to check if all your mail settings are working properly.
</p><p>
On a normal installation, the mail will be fetched every 10 minutes by the <code class="filename">postmaster_mailbox</code> cron job. For further information about modifying cron jobs, please refer to the <a class="link" href="manual-installation-of-otrs.html#cronjobs" title="Setting up the cron jobs for OTRS">"Setting up the cron jobs for OTRS"</a> section.
</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
When fetching mail, OTRS deletes the mail from the POP or IMAP server. There is no option to also keep a copy on the server. If you want to retain a copy on the server, you should create forwarding rules on your mail server. Please consult your mail server documentation for details.
</p></div></div><div class="section" title="Via command line program and procmail (otrs.PostMaster.pl)"><div class="titlepage"><div><div><h5 class="title"><a name="email-receiving-cmd"></a>Via command line program and procmail (otrs.PostMaster.pl)</h5></div></div></div><p>
If you cannot use mail accounts to get the email into OTRS, the command line program <code class="filename">bin/otrs.PostMaster.pl</code> might be a way around the problem. It takes the mails via STDIN and pipes them directly into OTRS. That means email will be available in your OTRS system if the MDA (mail delivery agent, e.g. procmail) executes this program.
</p><p>
To test <code class="filename">bin/otrs.PostMaster.pl</code> without an MDA, execute the command of the following script.
</p><p>
</p><pre class="screen">
linux:/opt/otrs# cd bin
linux:/opt/otrs/bin# cat ../doc/sample_mails/test-email-1.box | ./otrs.PostMaster.pl
linux:/opt/otrs/bin#
</pre><p>
</p><p>
<span class="emphasis"><em>Script: Testing PostMaster without the MDA.</em></span>
</p><p>
If the email is shown in the QueueView, then your setup is working.
</p><p>
Procmail is a very common e-mail filter in Linux environments. It is installed on most systems. If not, have a look at the <a class="ulink" href="http://www.procmail.org/" target="_top"><em class="citetitle">procmail homepage</em></a>.
</p><p>
To configure procmail for OTRS (based upon a procmail configured MTA such as sendmail, postfix, exim or qmail), use the
<code class="filename">~otrs/.procmailrc.dist</code> file and copy it to <code class="filename">.procmailrc</code> and add the lines of the script below.
</p><p>
</p><pre class="programlisting">
SYS_HOME=$HOME
PATH=/bin:/usr/bin:/usr/local/bin
# --
# Pipe all email into the PostMaster process.
# --
:0 :
| $SYS_HOME/bin/otrs.PostMaster.pl
</pre><p>
</p><p>
<span class="emphasis"><em>Script: Configuring procmail for OTRS.</em></span>
</p><p>
All email sent to the local OTRS user will be piped into <code class="filename">bin/otrs.PostMaster.pl</code> and then shown in your QueueView.
</p></div><div class="section" title="Fetching emails via POP3 or IMAP and fetchmail for otrs.PostMaster.pl"><div class="titlepage"><div><div><h5 class="title"><a name="email-receiving-fetchmail"></a>Fetching emails via POP3 or IMAP and fetchmail for otrs.PostMaster.pl</h5></div></div></div><p>
In order to get email from your mail server, via a POP3 or IMAP mailbox, to the OTRS machine/local OTRS account and to procmail, use <a class="ulink" href="http://fetchmail.berlios.de/" target="_top">fetchmail</a>.
</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
A working SMTP configuration on the OTRS machine is required.
</p></div><p>
You can use the <code class="filename">.fetchmailrc.dist</code> in the home directory of OTRS and copy it to <code class="filename">.fetchmailrc</code>. Modfiy/change it for your needs (see the Example 7-1 below).
</p><div class="example"><a name="fetchmailrc"></a><p class="title"><b>Example 4.2. .fetchmailrc</b></p><div class="example-contents"><p>
</p><pre class="programlisting">
#poll (mailserver) protocol POP3 user (user) password (password) is (localuser)
poll mail.example.com protocol POP3 user joe password mama is otrs
</pre><p>
</p></div></div><br class="example-break"><p>
Don't forget to set the .fetchmailrc to 710 ("chmod 710 .fetchmailrc")!
</p><p>
With the <code class="filename">.fetchmailrc</code> from the Example 7-1 above, all email will be forwarded to the local OTRS account, if the command <span class="command"><strong>fetchmail -a</strong></span> is executed. Set up a cronjob with this command if you want to fetch the mails regularly.
</p></div><div class="section" title="Filtering/dispatching by OTRS/PostMaster modules (for more complex dispatching)"><div class="titlepage"><div><div><h5 class="title"><a name="email-receiving-filter"></a>Filtering/dispatching by OTRS/PostMaster modules (for more complex dispatching)</h5></div></div></div><p>
If you use the bin/otrs.PostMaster.pl or bin/otrs.PostMasterMailbox.pl method, you can insert or modify X-OTRS header entries with the PostMaster filter modules. With the X-OTRS headers, the ticket system can execute some actions on
incoming mails, sort them into a specific queue, change the priority or change the customer ID, for example. More information about the X-OTRS headers are available in the section about <a class="link" href="administration.html#adminarea-postmasterpop3-account" title="Using mail accounts">adding mail accounts</a> from the OTRS Admin page.
</p><p>
There are some default filter modules:
</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
The job name (e.g. $Self-&gt;{'PostMaster::PreFilterModule'}-&gt;{'JobName'}) needs to be unique!
</p></div><p>
Kernel::System::PostMaster::Filter::Match is a default module to match on some email header (e.g. From, To, Subject, ...). It can set new email headers (e.g. X-OTRS-Ignore: yes or X-OTRS-Queue: spam) if a filter rule matches. The jobs of the Example 7-2 can be inserted in <code class="filename">Kernel/Config.pm</code>
</p><div class="example"><a name="filter-module-match-example"></a><p class="title"><b>Example 4.3. Example jobs for the filter module Kernel::System::PostMaster::Filter::Match</b></p><div class="example-contents"><p>
</p><pre class="programlisting">
    # Job Name: 1-Match
    # (block/ignore all spam email with From: noreply@)
    $Self-&gt;{'PostMaster::PreFilterModule'}-&gt;{'1-Match'} = {
        Module =&gt; 'Kernel::System::PostMaster::Filter::Match',
        Match =&gt; {
            From =&gt; 'noreply@',
        },
        Set =&gt; {
            'X-OTRS-Ignore' =&gt; 'yes',
        },
    };
    # Job Name: 2-Match
    # (sort emails with From: sales@example.com and Subject: **ORDER**
    # into queue 'Order')
    $Self-&gt;{'PostMaster::PreFilterModule'}-&gt;{'2-Match'} = {
        Module =&gt; 'Kernel::System::PostMaster::Filter::Match',
        Match =&gt; {
            To =&gt; 'sales@example.com',
            Subject =&gt; '**ORDER**',
        },
        Set =&gt; {
            'X-OTRS-Queue' =&gt; 'Order',
        },
    };
</pre><p>
</p></div></div><br class="example-break"><p>
Kernel::System::PostMaster::Filter::CMD is a default module to pipe the email into an external command. The output is given to STDOUT and if the result is true, then set new email header (e.g. X-OTRS-Ignore: yes or X-OTRS-Queue: spam). The Example 7-3 can be used in <code class="filename">Kernel/Config.pm</code>
</p><div class="example"><a name="filter-module-cmd-example"></a><p class="title"><b>Example 4.4. Example job for the filter module Kernel::System::PostMaster::Filter::CMD</b></p><div class="example-contents"><p>
</p><pre class="programlisting">
    # Job Name: 5-SpamAssassin
    # (SpamAssassin example setup, ignore spam emails)
    $Self-&gt;{'PostMaster::PreFilterModule'}-&gt;{'5-SpamAssassin'} = {
        Module =&gt; 'Kernel::System::PostMaster::Filter::CMD',
        CMD =&gt; '/usr/bin/spamassassin | grep -i "X-Spam-Status: yes"',
        Set =&gt; {
            'X-OTRS-Ignore' =&gt; 'yes',
        },
    };
</pre><p>
</p></div></div><br class="example-break"><p>
    Kernel::System::PostMaster::Filter::ExternalTicketNumberRecognition is a default module that
    adds the possibility to parse external identifiers, in the email subject, the body or both using
    regular expressions. It then stores this value in a defined dynamic field. When an email comes
    in, OTRS will first search for an external identifier and when it finds one, query OTRS on the
    pre-defined dynamic field field. If it finds an existing ticket, it will update this ticket,
    otherwise it will create a new ticket with the external reference number in the separate field.
</p><p>
    OTRS SysConfig already provide 4 different settings to setup different external ticket numbers.
    If more settings are needed they need to need to be added manually. The following example can be
    used in <code class="filename">Kernel/Config.pm</code> to extend SysConfig settings.
</p><div class="example"><a name="filter-module-externalticketrecognition-example"></a><p class="title"><b>Example 4.5. 
        Example job for the filter module
        Kernel::System::PostMaster::Filter::ExternalTicketNumberRecognition
    </b></p><div class="example-contents"><pre class="programlisting">
    # Job Name: ExternalNumber
    # External Ticket Number Reconition, check for Incident-&lt;number&gt; in incoming mails subject and
    # body from the addeesses &lt;sender&gt;@externalticket.com, if number is found it will be stored in
    # the dynamic field 'ExternalNumber' (that need to be setup in the Admin Panel).
    $Self-&gt;{'PostMaster::PreFilterModule'}-&gt;{'000-ExternalTicketNumberRecognition5'} =  {
        'FromAddressRegExp' =&gt; '\\s*@externalticket.com',
        'NumberRegExp'      =&gt; 'Incident-(\\d.*)',
        'SearchInSubject'   =&gt; '1',
        'SearchInBody'      =&gt; '1',
        'TicketStateTypes'  =&gt; 'new;open'
        'DynamicFieldName'  =&gt; 'ExternalNumber',
        'Module'            =&gt; 'Kernel::System::PostMaster::Filter::ExternalTicketNumberRecognition',
        'Name'              =&gt; 'Test External Ticket Number',
        'SenderType'        =&gt; 'system',
    };
    </pre></div></div><br class="example-break"><div class="itemizedlist"><p><span class="emphasis"><em>Configuration Options</em></span></p><ul class="itemizedlist"><li class="listitem"><p>FromAddressRegExp</p><p>
            This is an optional setting. Only mails matching this "From:" address will be considered
            for this filter. You can adjust this setting to the sender address your external system
            uses for outgoing mails. In case this address can differ, you can set this option to
            empty. OTRS will in that case not check the sender address.
        </p></li><li class="listitem"><p>NumberRegExp</p><p>
            This is a mandatory setting. This setting contains the regular expression OTRS will use
            to extract the ticket number out of the subject and/or ticket body. The default regular
            expression will match occurrences of for example 'Incident-12354' and will put the part
            between parentheses in the dynamic field field, in this case '12354'.
        </p></li><li class="listitem"><p>SearchInSubject</p><p>If this is set to '1', the email subject is searched for a ticket number.</p></li><li class="listitem"><p>SearchInBody</p><p>If this is set to '1', the email body is searched for a ticket number.</p></li><li class="listitem"><p>TicketStateTypes</p><p>
            This is an optional setting. If given, it will search OTRS only for open external
            tickets of given state types. The state types are separated with semicolons.
        </p></li><li class="listitem"><p>DynamicField</p><p>
            This is a required setting. It defines the dynamic filed that is used to store the
            external number (the field name must exist in the system and has to be valid).
        </p></li><li class="listitem"><p>SenderType</p><p>This defines the sender type used for the articles created in OTRS.</p></li></ul></div><p>
Of course it's also possible to develop your own PostMaster filter modules.
</p></div></div></div><div class="section" title="Secure email with PGP"><div class="titlepage"><div><div><h3 class="title"><a name="configure-pgp"></a>Secure email with PGP</h3></div></div></div><p>
OTRS has the capability to sign or encrypt outgoing messages with PGP. Furthermore, encrypted incoming messages can be decrypted. Encryption and decryption are done with the GPL tool GnuPG. To setup GnuPG for OTRS, the following steps have to be performed:
</p><p>
</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
    Install GnuPG, via the package manager of your operating system.
    </p></li><li class="listitem"><p>
    Configure GnuPG for use with OTRS. The necessary directories for GnuPG and a private key have to be created. The command shown in the script below has to be executed as user 'otrs' from a shell.
    </p><p>
    </p><pre class="screen">
    linux:~# su otrs
    linux:/root$ cd
    linux:~$ pwd
    /opt/otrs
    linux:~$ gpg --gen-key
    gpg (GnuPG) 1.4.2; Copyright (C) 2005 Free Software Foundation, Inc.
    This program comes with ABSOLUTELY NO WARRANTY.
    This is free software, and you are welcome to redistribute it
    under certain conditions. See the file COPYING for details.

    gpg: directory `/opt/otrs/.gnupg' created
    gpg: new configuration file `/opt/otrs/.gnupg/gpg.conf' created
    gpg: WARNING: options in `/opt/otrs/.gnupg/gpg.conf' are not yet active during t
    his run
    gpg: keyring `/opt/otrs/.gnupg/secring.gpg' created
    gpg: keyring `/opt/otrs/.gnupg/pubring.gpg' created
    Please select what kind of key you want:
       (1) DSA and Elgamal (default)
       (2) DSA (sign only)
       (5) RSA (sign only)
    Your selection? 1
    DSA keypair will have 1024 bits.
    ELG-E keys may be between 1024 and 4096 bits long.
    What keysize do you want? (2048)
    Requested keysize is 2048 bits
    Please specify how long the key should be valid.
         0 = key does not expire
      &lt;n&gt;  = key expires in n days
      &lt;n&gt;w = key expires in n weeks
      &lt;n&gt;m = key expires in n months
      &lt;n&gt;y = key expires in n years
    Key is valid for? (0)
    Key does not expire at all
    Is this correct? (y/N) y

    You need a user ID to identify your key; the software constructs the user ID
    from the Real Name, Comment and Email Address in this form:
        "Heinrich Heine (Der Dichter) &lt;heinrichh@duesseldorf.de&gt;"

    Real name: Ticket System
    Email address: support@example.com
    Comment: Private PGP Key for the ticket system with address support@example.com
    You selected this USER-ID:
    "Ticket System (Private PGP Key for the ticket system with address support@examp
    le.com) &lt;support@example.com&gt;"

    Change (N)ame, (C)omment, (E)mail or (O)kay/(Q)uit? O
    You need a Passphrase to protect your secret key.

    Passphrase: secret
    Repeat passphrase: secret

    We need to generate a lot of random bytes. It is a good idea to perform
    some other action (type on the keyboard, move the mouse, utilize the
    disks) during the prime generation; this gives the random number
    generator a better chance to gain enough entropy.
    ++++++++++.+++++++++++++++++++++++++....+++++.+++++...+++++++++++++++++++++++++.
    +++++++++++++++++++++++++.+++++.+++++.+++++++++++++++++++++++++&gt;++++++++++&gt;+++++
    .......&gt;+++++&lt;+++++................................+++++

    Not enough random bytes available.  Please do some other work to give
    the OS a chance to collect more entropy! (Need 280 more bytes)

    ++++++++++.+++++..++++++++++..+++++....++++++++++++++++++++.+++++++++++++++.++++
    ++++++++++++++++++++++++++.++++++++++.+++++++++++++++.++++++++++.+++++++++++++++
    ..+++++&gt;.+++++....&gt;+++++........................................................
    ...........................................................&gt;+++++&lt;+++++.........
    .............+++++^^^
    gpg: /opt/otrs/.gnupg/trustdb.gpg: trustdb created
    gpg: key 7245A970 marked as ultimately trusted
    public and secret key created and signed.

    gpg: checking the trustdb
    gpg: 3 marginal(s) needed, 1 complete(s) needed, PGP trust model
    gpg: depth: 0  valid:   1  signed:   0  trust: 0-, 0q, 0n, 0m, 0f, 1u
    pub   1024D/7245A970 2006-02-03
          Key fingerprint = 2ED5 BC36 D2B6 B055 7EE1  5833 1D7B F967 7245 A970
     uid                  Ticket System (Private pgp key for ticket system with addre
    ss support@example.com) &lt;support@example.com&gt;
    sub   2048g/52B97069 2006-02-03

    linux:~$
    </pre><p>
    </p><p>
    <span class="emphasis"><em>Script: Configuring GnuPG.</em></span>
    </p><p>
        As shown in the script below, the default settings can be applied for most of the required parameters. Only the values for the key owner have to be entered correctly, with a proper password specified for the key.
    </p></li><li class="listitem"><p>
    Now OTRS has to be made ready to use PGP. From the Admin console, open the SysConfig interface and search for "PGP". Select the sub group Crypt::PGP from the search results.
    </p><p>
    In the screen for the PGP settings, PGP should be activated for OTRS (first option). Also, the path to the gpg program should be set and checked.
    </p><p>
    The next config setting (PGP::Options) may also require changing. Via this config setting, the parameters that are used for every execution of gpg by the 'otrs' user can be specified. In particular, the directory of the config files for GnuPG of the 'otrs' user is important. In the example <code class="filename">/opt/otrs/.gnupg</code> is used. This directory was created earlier during the PGP configuration.
    </p><p>
        Via the next config option (PGP::Key::Password) it is possible to specify the pairs of key IDs and their passwords for own private keys. Because communication partners from outside write to the ticket system with their messages encrypted with your public key, OTRS can decrypt these messages with the ID/passwords specified here.
    </p><p>
    How to get the id of your own private key? The ID of your own private key is already shown during the key generation (see step 1 from above). It is also possible to get the ID if the command specified in the following script is executed as user 'otrs':
    </p><p>
    </p><pre class="screen">
    linux:~# su otrs
    linux:/root$ cd
    linux:~$ pwd
    /opt/otrs
    linux:~$ gpg --list-keys
    /opt/otrs/.gnupg/pubring.gpg
    ----------------------------
    pub   1024D/7245A970 2006-02-03
    uid                  Ticket System (Private pgp key for ticket system with
    address support@example.com) &lt;support@example.com&gt;
    sub   2048g/52B97069 2006-02-03

    linux:~$
    </pre><p>
    </p><p>
    <span class="emphasis"><em>Script: Getting the ID of your own private key.</em></span>
    </p><p>
    The ID of the private key can be found in the line that starts with "sub". It is a hexadecimal string that is eight characters long, in the example above it is "52B97069". The password you have to specify for this key in the ticket system is the same that was given during key generation.
    </p><p>
    After this data is inserted, the "Update" button can be used to save the settings. OTRS is ready to receive and decrypt encoded messages now.
    </p></li><li class="listitem"><p>
    Finally, import a customer's public key. This ensures that encrypted messages can be sent out to this customer. There are two ways to import a public key of a customer.
    </p><p>
    The first way is to specify the public key of a customer in the customer management interface.
    </p><p>
    The second way is to specify the key via the PGP settings, reachable from the Admin page. On the right section of this screen, all already imported public keys of customers are displayed. After PGP has been activated and configured for OTRS, your own public key should also be listed there. In the left area of the PGP setting screen it is possible to search for keys. Also, a new public key can be uploaded into the system from a file.
    </p><p>
    The files with the public key that need to be imported into OTRS have to be GnuPGP compatible key files. In most cases, the key stored in a file is an "ASCII armored key". OTRS can deal with this format.
    </p></li></ol></div><p>
</p></div><div class="section" title="Secure email with S/MIME"><div class="titlepage"><div><div><h3 class="title"><a name="smime"></a>Secure email with S/MIME</h3></div></div></div><p>
At first glance, encryption with S/MIME seems a little more complicated than with PGP. First, you have to establish a Certification Authority (CA) for the OTRS system. The subsequent steps are very much like those needed with PGP: configure OTRS, install your own certificate, import other public certificates as needed, etc.
</p><p>
The S/MIME configuration is conducted outside the OTRS web interface for the most part, and should be carried out in a shell by the 'otrs' user. The MIME configuration under Linux is based on SSL (OpenSSL). Therefore, check first of all whether the OpenSSL package is installed on your system. The OpenSSL package includes a script called CA.pl, with which the most important steps of certificate creation can be performed. To simplify the procedure, find out where in the filesystem the CA.pl script is stored and enter the location temporarily into the PATH variable of the shell (see Script below).
</p><p>
</p><pre class="screen">
otrs@linux:~&gt; rpm -ql openssl | grep CA
/usr/share/ssl/misc/CA.pl
otrs@linux:~&gt; export PATH=$PATH:/usr/share/ssl/misc
otrs@linux:~&gt; which CA.pl
/usr/share/ssl/misc/CA.pl
otrs@linux:~&gt; mkdir tmp; cd tmp
otrs@linux:~/tmp&gt;
</pre><p>
</p><p>
<span class="emphasis"><em>Script: Configuring S/MIME.</em></span>
</p><p>
The script above shows that a new temporary directory ~/tmp has been created, in which the certificate is to be generated.
</p><p>
To create a certificate, perform the following operations in the command line (we assume that the OTRS administrator has to create a SSL certificate for test and learning purposes. In case you already have a certified SSL certificate for the encryption, use it and skip these steps):
</p><p>
</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
    Establish your own Certification Authority for SSL. You need it to certify the request for your own SSL certificate (see Script below).
    </p><p>
    </p><pre class="screen">
otrs@linux:~/tmp&gt; CA.pl -newca
CA certificate filename (or enter to create)

Making CA certificate ...
Generating a 1024 bit RSA private key
...++++++
......++++++
writing new private key to './demoCA/private/cakey.pem'
Enter PEM pass phrase:
Verifying - Enter PEM pass phrase:
-----
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [AU]:DE
State or Province Name (full name) [Some-State]:OTRS-state
Locality Name (eg, city) []:OTRS-town
Organization Name (eg, company) [Internet Widgits Pty Ltd]:Your company
Organizational Unit Name (eg, section) []:
Common Name (eg, YOUR name) []:OTRS Admin
Email Address []:otrs@your-domain.tld
otrs@linux:~/tmp&gt; ls -la demoCA/
total 8
-rw-r--r--  1 otrs otrs 1330 2006-01-08 17:54 cacert.pem
drwxr-xr-x  2 otrs otrs   48 2006-01-08 17:53 certs
drwxr-xr-x  2 otrs otrs   48 2006-01-08 17:53 crl
-rw-r--r--  1 otrs otrs    0 2006-01-08 17:53 index.txt
drwxr-xr-x  2 otrs otrs   48 2006-01-08 17:53 newcerts
drwxr-xr-x  2 otrs otrs   80 2006-01-08 17:54 private
-rw-r--r--  1 otrs otrs   17 2006-01-08 17:54 serial
otrs@linux:~/tmp&gt;
    </pre><p>
    </p><p>
    <span class="emphasis"><em>Script: Establishing a Certification Authority for SSL.</em></span>
    </p></li><li class="listitem"><p>
    Generate a certificate request (see Script below).
    </p><p>
    </p><pre class="screen">
otrs@linux:~/tmp&gt; CA.pl -newreq
Generating a 1024 bit RSA private key
..........................................++++++
....++++++
writing new private key to 'newreq.pem'
Enter PEM pass phrase:
Verifying - Enter PEM pass phrase:
-----
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [AU]:DE\keyreturn
State or Province Name (full name) [Some-State]:OTRS-state
Locality Name (eg, city) []:OTRS-town
Organization Name (eg, company) [Internet Widgits Pty Ltd]:Your company
Organizational Unit Name (eg, section) []:
Common Name (eg, YOUR name) []:OTRS admin
Email Address []:otrs@your-domain.tld

Please enter the following 'extra' attributes
to be sent with your certificate request
A challenge password []:
An optional company name []:
Request (and private key) is in newreq.pem
otrs@linux:~/tmp&gt; ls -la
total 4
drwxr-xr-x  6 otrs otrs  232 2006-01-08 17:54 demoCA
-rw-r--r--  1 otrs otrs 1708 2006-01-08 18:04 newreq.pem
otrs@linux:~/tmp&gt;
    </pre><p>
    </p><p>
    <span class="emphasis"><em>Script: Creating a certificate request.</em></span>
    </p></li><li class="listitem"><p>
    Signing of the certificate request. The certificate request can either be signed and thereby certified by your own CA, or made more credible by being signed by another external certified CA (see Script below).
    </p><p>
    </p><pre class="screen">
otrs@linux:~/tmp&gt; CA.pl -signreq
Using configuration from /etc/ssl/openssl.cnf
Enter pass phrase for ./demoCA/private/cakey.pem:
Check that the request matches the signature
Signature ok
Certificate Details:
        Serial Number:
            fd:85:f6:9f:14:07:16:c8
        Validity
            Not Before: Jan  8 17:04:37 2006 GMT
            Not After : Jan  8 17:04:37 2007 GMT
        Subject:
            countryName               = DE
            stateOrProvinceName       = OTRS-state
            localityName              = OTRS-town
            organizationName          = Your Company
            commonName                = OTRS administrator
            emailAddress              = otrs@your-domain.tld
        X509v3 extensions:
            X509v3 Basic Constraints:
                CA:FALSE
            Netscape Comment:
                OpenSSL Generated Certificate
            X509v3 Subject Key Identifier:
                01:D9:1E:58:C0:6D:BF:27:ED:37:34:14:D6:04:AC:C4:64:98:7A:22
            X509v3 Authority Key Identifier:
                keyid:10:4D:8D:4C:93:FD:2C:AA:9A:B3:26:80:6B:F5:D5:31:E2:8E:DB:A8
                DirName:/C=DE/ST=OTRS-state/L=OTRS-town/O=Your Company/
                CN=OTRS admin/emailAddress=otrs@your-domain.tld
                serial:FD:85:F6:9F:14:07:16:C7

Certificate is to be certified until Jan  8 17:04:37 2007 GMT (365 days)
Sign the certificate? [y/n]:y

1 out of 1 certificate requests certified, commit? [y/n]y
Write out database with 1 new entries
Data Base Updated
Signed certificate is in newcert.pem
otrs@linux:~/tmp&gt;
    </pre><p>
    </p><p>
    <span class="emphasis"><em>Script: Signing of the certificate request.</em></span>
    </p></li><li class="listitem"><p>
    Generate your own certificate, and all data going with it, using the signed certificate request (see Script below).
    </p><p>
    </p><pre class="screen">
otrs@linux:~/tmp&gt; CA.pl -pkcs12 "OTRS Certificate"
Enter pass phrase for newreq.pem:
Enter Export Password:
Verifying - Enter Export Password:
otrs@linux:~/tmp&gt; ls -la
total 12
drwxr-xr-x  6 otrs otrs  328 2006-01-08 18:04 demoCA
-rw-r--r--  1 otrs otrs 3090 2006-01-08 18:13 newcert.p12
-rw-r--r--  1 otrs otrs 3791 2006-01-08 18:04 newcert.pem
-rw-r--r--  1 otrs otrs 1708 2006-01-08 18:04 newreq.pem
otrs@linux:~/tmp&gt;
    </pre><p>
    </p><p>
    <span class="emphasis"><em>Script: Generating a new certificate.</em></span>
    </p></li></ol></div><p>
</p><p>
Now that these operations have been performed, the S/MIME setup must be completed in OTRS.
</p><p>
This part of the setup is carried out in the Admin page, choosing the link <a class="link" href="administration.html#adminarea-smime" title="SMIME">"SMIME"</a>. In case the general S/MIME support in OTRS has not yet been enabled, the mask points this out to the administrator and provides an appropriate link for enabling it.
</p><p>
With the SysConfig group <a class="link" href="Framework.html#Framework:Crypt::SMIME" title="Crypt::SMIME">"Crypt::SMIME"</a>, you can also enable and configure the general S/MIME support.
</p><p>
Here you can activate S/MIME support, and define the paths for the OpenSSL command and the directory for the certificates. The key file created above must be stored in the directory indicated here. Otherwise OpenSSL cannot use it.
</p><p>
The next step is performed in the <a class="link" href="administration.html#adminarea-smime" title="SMIME">S/MIME configuration on the OTRS Admin page</a>. Here, you can import the private key(s) of the OTRS system and the public keys of other communication partners. Enter the public key that has been created in the beginning of this section and added to OTRS.
</p><p>
Obviously, all public S/MIME keys of communication partners can be imported using the <a class="link" href="administration.html#adminarea-customers" title="Customers">customer administration tool</a> as well.
</p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="backup-and-restore.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="administration.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="external-backends.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Backing up the system </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Using external backends</td></tr></table></div></body></html>
