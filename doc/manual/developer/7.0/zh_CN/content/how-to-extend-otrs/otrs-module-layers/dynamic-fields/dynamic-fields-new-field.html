

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh-CN" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh-CN" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>创建一个新动态字段 &mdash; OTRS Developer Manual 7.0 文档</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../../../_static/css/otrs.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="索引" href="../../../../genindex.html" />
    <link rel="search" title="搜索" href="../../../../search.html" />
    <link rel="next" title="创建一个动态字段功能扩展" href="dynamic-fields-extend.html" />
    <link rel="prev" title="如何扩展动态字段" href="dynamic-fields-extend-options.html" /> 

  
  <script src="../../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          
    
    
    <a href="https://doc.otrs.com/doc" class="icon fa-rocket DocumentationOverview"> OTRS Documentation</a>

    

          
            <a href="../../../index.html" class="icon icon-home"> OTRS Developer Manual
          

          
            
            <img src="../../../../_static/otrs-logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                7.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          


        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">目录</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../get-started.html">入门</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../how-it-works.html">OTRS内部 - 如何工作</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../how-to-extend-otrs.html">如何扩展OTRS</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../writing-otrs-application.html">编写新的OTRS前端模块</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../writing-new-otrs-frontend-component.html">编写新的OTRS前端组件</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../otrs-module-layers.html">使用OTRS模块层的功能</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../agent-auth.html">服务人员身份验证模块</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auth-sync.html">身份验证同步模块</a></li>
<li class="toctree-l3"><a class="reference internal" href="../customer-auth.html">客户身份验证模块</a></li>
<li class="toctree-l3"><a class="reference internal" href="../customer-user-preferences.html">客户用户首选项模块</a></li>
<li class="toctree-l3"><a class="reference internal" href="../queue-preferences.html">队列首选项模块</a></li>
<li class="toctree-l3"><a class="reference internal" href="../service-preferences.html">服务首选项模块</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sla-preferences.html">SLA首选项模块</a></li>
<li class="toctree-l3"><a class="reference internal" href="../log.html">日志模块</a></li>
<li class="toctree-l3"><a class="reference internal" href="../outputfilter.html">输出过滤器</a></li>
<li class="toctree-l3"><a class="reference internal" href="../stats.html">统计模块</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ticketnumber-generator.html">工单编号生成器模块</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ticketevent.html">工单事件模块</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dashboard.html">仪表板模块</a></li>
<li class="toctree-l3"><a class="reference internal" href="../notify.html">通知模块</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ticket-menu.html">工单菜单模块</a></li>
<li class="toctree-l3"><a class="reference internal" href="../gi-transport.html">网络传输</a></li>
<li class="toctree-l3"><a class="reference internal" href="../gi-mapping.html">映射</a></li>
<li class="toctree-l3"><a class="reference internal" href="../gi-invoker.html">调用程序</a></li>
<li class="toctree-l3"><a class="reference internal" href="../gi-operation.html">操作</a></li>
<li class="toctree-l3"><a class="reference internal" href="../daemon/daemon-modules.html">OTRS守护进程</a></li>
<li class="toctree-l3"><a class="reference internal" href="../daemon/scheduler-task-worker-modules.html">OTRS调度程序</a></li>
<li class="toctree-l3"><a class="reference internal" href="dynamic-fields-overview.html">概览</a></li>
<li class="toctree-l3"><a class="reference internal" href="dynamic-fields-framework.html">动态字段框架</a></li>
<li class="toctree-l3"><a class="reference internal" href="dynamic-fields-interaction.html">动态字段与前端模块交互</a></li>
<li class="toctree-l3"><a class="reference internal" href="dynamic-fields-extend-options.html">如何扩展动态字段</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">创建一个新动态字段</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#dynamic-field-password-files">Password动态字段的文件</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="dynamic-fields-extend.html">创建一个动态字段功能扩展</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ticket-postmaster-modules.html">工单邮箱管理员模块</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process-management-modules.html">流程管理</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../how-to-publish-otrs-extensions.html">如何发布你的OTRS扩展</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../documentation.html">文档</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">为OTRS做出贡献</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../additional-resources.html">其它资源</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">OTRS Developer Manual</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../how-to-extend-otrs.html">如何扩展OTRS</a> &raquo;</li>
        
          <li><a href="../../otrs-module-layers.html">使用OTRS模块层的功能</a> &raquo;</li>
        
      <li>创建一个新动态字段</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/OTRS/doc-developer/blob/rel-7_0/content/how-to-extend-otrs/otrs-module-layers/dynamic-fields/dynamic-fields-new-field.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="creating-a-new-dynamic-field">
<h1>创建一个新动态字段<a class="headerlink" href="#creating-a-new-dynamic-field" title="永久链接至标题">¶</a></h1>
<p>为了说明此过程，将创建一个新的动态字段 <em>Password</em>。 此新动态字段类型将为工单或信件对象显示新的密码字段。 由于与文本动态字段非常相似，我们将使用 <code class="docutils literal notranslate"><span class="pre">Base</span></code> 和 <code class="docutils literal notranslate"><span class="pre">BaseText</span></code> 驱动程序作为构建此新字段的基础。</p>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<p class="last">此新密码字段实现仅用于教育目的，它不提供任何级别的安全性，不建议用于生产系统。</p>
</div>
<p>要创建这个新的动态字段，我们将创建4个文件：</p>
<ol class="arabic simple">
<li>一个用于注册模块的配置文件（XML）。</li>
<li>一个用于设置字段选项的管理对话框模块（Perl）。</li>
<li>一个管理对话框的模板模块。</li>
<li>一个动态字段驱动程序（Perl）。</li>
</ol>
<p>文件结构：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$HOME (e. g. /opt/otrs/)
|
...
|--/Kernel/
|   |--/Config/
|   |   |--/Files/
|   |   |   |--/XML/
|   |   |   |   |DynamicFieldPassword.xml
...
|   |--/Modules/
|   |   |AdminDynamicFieldPassword.pm
...
|   |--/Output/
|   |   |--/HTML/
|   |   |   |--/Standard/
|   |   |   |   |AdminDynamicFieldPassword.tt
...
|   |--/System/
|   |   |--/DynamicField/
|   |   |   |--/Driver/
|   |   |   |   |Password.pm
...
</pre></div>
</div>
<div class="section" id="dynamic-field-password-files">
<h2>Password动态字段的文件<a class="headerlink" href="#dynamic-field-password-files" title="永久链接至标题">¶</a></h2>
<div class="section" id="dynamic-field-configuration-file-example">
<h3>动态字段配置文件示例<a class="headerlink" href="#dynamic-field-configuration-file-example" title="永久链接至标题">¶</a></h3>
<p>配置文件用于注册后端对象的动态字段类型（驱动程序）和对象类型驱动程序。 它们还在框架中存储管理模块的标准注册。</p>
<p>在本节中，将显示和解释password动态字段的配置文件。</p>
<div class="highlight-XML notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;</span>
<span class="nt">&lt;otrs_config</span> <span class="na">version=</span><span class="s">&quot;2.0&quot;</span> <span class="na">init=</span><span class="s">&quot;Application&quot;</span><span class="nt">&gt;</span>
</pre></div>
</div>
<p>这是配置文件的正常头文件。</p>
<div class="highlight-XML notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ConfigItem</span> <span class="na">Name=</span><span class="s">&quot;DynamicFields::Driver###Password&quot;</span> <span class="na">Required=</span><span class="s">&quot;0&quot;</span> <span class="na">Valid=</span><span class="s">&quot;1&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Description</span> <span class="na">Translatable=</span><span class="s">&quot;1&quot;</span><span class="nt">&gt;</span>DynamicField backend registration.<span class="nt">&lt;/Description&gt;</span>
    <span class="nt">&lt;Group&gt;</span>DynamicFieldPassword<span class="nt">&lt;/Group&gt;</span>
    <span class="nt">&lt;SubGroup&gt;</span>DynamicFields::Backend::Registration<span class="nt">&lt;/SubGroup&gt;</span>
    <span class="nt">&lt;Setting&gt;</span>
        <span class="nt">&lt;Hash&gt;</span>
            <span class="nt">&lt;Item</span> <span class="na">Key=</span><span class="s">&quot;DisplayName&quot;</span> <span class="na">Translatable=</span><span class="s">&quot;1&quot;</span><span class="nt">&gt;</span>Password<span class="nt">&lt;/Item&gt;</span>
            <span class="nt">&lt;Item</span> <span class="na">Key=</span><span class="s">&quot;Module&quot;</span><span class="nt">&gt;</span>Kernel::System::DynamicField::Driver::Password<span class="nt">&lt;/Item&gt;</span>
            <span class="nt">&lt;Item</span> <span class="na">Key=</span><span class="s">&quot;ConfigDialog&quot;</span><span class="nt">&gt;</span>AdminDynamicFieldPassword<span class="nt">&lt;/Item&gt;</span>
        <span class="nt">&lt;/Hash&gt;</span>
    <span class="nt">&lt;/Setting&gt;</span>
<span class="nt">&lt;/ConfigItem&gt;</span>
</pre></div>
</div>
<p>此设置为后端模块注册password动态字段驱动程序，以便它可以包含在可用动态字段类型列表中。 它还在键 <code class="docutils literal notranslate"><span class="pre">ConfigDialog</span></code> 中指定了自己的管理对话框。 主动态字段管理模块使用此键来管理此新的动态字段类型。</p>
<div class="highlight-XML notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ConfigItem</span> <span class="na">Name=</span><span class="s">&quot;Frontend::Module###AdminDynamicFieldPassword&quot;</span> <span class="na">Required=</span><span class="s">&quot;0&quot;</span> <span class="na">Valid=</span><span class="s">&quot;1&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Description</span> <span class="na">Translatable=</span><span class="s">&quot;1&quot;</span><span class="nt">&gt;</span>Frontend module registration for the agent interface.<span class="nt">&lt;/Description&gt;</span>
    <span class="nt">&lt;Group&gt;</span>DynamicFieldPassword<span class="nt">&lt;/Group&gt;</span>
    <span class="nt">&lt;SubGroup&gt;</span>Frontend::Admin::ModuleRegistration<span class="nt">&lt;/SubGroup&gt;</span>
    <span class="nt">&lt;Setting&gt;</span>
        <span class="nt">&lt;FrontendModuleReg&gt;</span>
            <span class="nt">&lt;Group&gt;</span>admin<span class="nt">&lt;/Group&gt;</span>
            <span class="nt">&lt;Description&gt;</span>Admin<span class="nt">&lt;/Description&gt;</span>
            <span class="nt">&lt;Title</span> <span class="na">Translatable=</span><span class="s">&quot;1&quot;</span><span class="nt">&gt;</span>Dynamic Fields Text Backend GUI<span class="nt">&lt;/Title&gt;</span>
            <span class="nt">&lt;Loader&gt;</span>
                <span class="nt">&lt;JavaScript&gt;</span>Core.Agent.Admin.DynamicField.js<span class="nt">&lt;/JavaScript&gt;</span>
            <span class="nt">&lt;/Loader&gt;</span>
        <span class="nt">&lt;/FrontendModuleReg&gt;</span>
    <span class="nt">&lt;/Setting&gt;</span>
<span class="nt">&lt;/ConfigItem&gt;</span>
</pre></div>
</div>
<p>这是管理界面中password管理对话框的标准模块注册。</p>
<div class="highlight-XML notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;/otrs_config&gt;</span>
</pre></div>
</div>
<p>一个配置文件的标准关闭。</p>
</div>
<div class="section" id="dynamic-field-admin-dialog-example">
<h3>动态字段管理对话框示例<a class="headerlink" href="#dynamic-field-admin-dialog-example" title="永久链接至标题">¶</a></h3>
<p>管理对话框是管理（添加或编辑）动态字段的标准管理模块。</p>
<p>在本节中，将显示和解释password动态字段的管理对话框。</p>
<div class="highlight-Perl notranslate"><div class="highlight"><pre><span></span><span class="c1"># --</span>
<span class="c1"># Copyright (C) 2001-2020 OTRS AG, https://otrs.com/</span>
<span class="c1"># --</span>
<span class="c1"># This software comes with ABSOLUTELY NO WARRANTY. For details, see</span>
<span class="c1"># the enclosed file COPYING for license information (GPL). If you</span>
<span class="c1"># did not receive this file, see https://www.gnu.org/licenses/gpl-3.0.txt.</span>
<span class="c1"># --</span>

<span class="k">package</span> <span class="nn">Kernel::Modules::AdminDynamicFieldPassword</span><span class="p">;</span>

<span class="k">use</span> <span class="nn">strict</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">warnings</span><span class="p">;</span>

<span class="k">use</span> <span class="nn">Kernel::System::VariableCheck</span> <span class="sx">qw(:all)</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">Kernel::System::Valid</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">Kernel::System::CheckItem</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">Kernel::System::DynamicField</span><span class="p">;</span>
</pre></div>
</div>
<p>这是可在常见OTRS模块中找到的通用标头。 类/包名称通过 <code class="docutils literal notranslate"><span class="pre">package</span></code> 关键字声明。</p>
<div class="highlight-Perl notranslate"><div class="highlight"><pre><span></span><span class="k">sub</span> <span class="nf">new</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span> <span class="nv">$Type</span><span class="p">,</span> <span class="nv">%Param</span> <span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="k">my</span> <span class="nv">$Self</span> <span class="o">=</span> <span class="p">{</span><span class="nv">%Param</span><span class="p">};</span>
    <span class="nb">bless</span><span class="p">(</span> <span class="nv">$Self</span><span class="p">,</span> <span class="nv">$Type</span> <span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="sx">qw(ParamObject LayoutObject LogObject ConfigObject)</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="nv">$_</span><span class="p">}</span> <span class="p">)</span> <span class="p">{</span>
            <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">LayoutObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">FatalError</span><span class="p">(</span> <span class="n">Message</span> <span class="o">=&gt;</span> <span class="s">&quot;Got no $_!&quot;</span> <span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1"># create additional objects</span>
    <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">ValidObject</span><span class="p">}</span> <span class="o">=</span> <span class="nn">Kernel::System::Valid</span><span class="o">-&gt;</span><span class="k">new</span><span class="p">(</span> <span class="nv">%</span><span class="p">{</span><span class="nv">$Self</span><span class="p">}</span> <span class="p">);</span>

    <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">DynamicFieldObject</span><span class="p">}</span> <span class="o">=</span> <span class="nn">Kernel::System::DynamicField</span><span class="o">-&gt;</span><span class="k">new</span><span class="p">(</span> <span class="nv">%</span><span class="p">{</span><span class="nv">$Self</span><span class="p">}</span> <span class="p">);</span>

    <span class="c1"># get configured object types</span>
    <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">ObjectTypeConfig</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">ConfigObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">Get</span><span class="p">(</span><span class="s">&#39;DynamicFields::ObjectType&#39;</span><span class="p">);</span>

    <span class="c1"># get the fields config</span>
    <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">FieldTypeConfig</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">ConfigObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">Get</span><span class="p">(</span><span class="s">&#39;DynamicFields::Backend&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="p">{};</span>

    <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">DefaultValueMask</span><span class="p">}</span> <span class="o">=</span> <span class="s">&#39;****&#39;</span><span class="p">;</span>
    <span class="k">return</span> <span class="nv">$Self</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>构造函数 <code class="docutils literal notranslate"><span class="pre">new</span></code> 创建了一个新的类实例。 根据编码指南，必须在 <code class="docutils literal notranslate"><span class="pre">new</span></code> 中创建此模块中所需的其它类的对象。</p>
<div class="highlight-Perl notranslate"><div class="highlight"><pre><span></span><span class="k">sub</span> <span class="nf">Run</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span> <span class="nv">$Self</span><span class="p">,</span> <span class="nv">%Param</span> <span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">Subaction</span><span class="p">}</span> <span class="ow">eq</span> <span class="s">&#39;Add&#39;</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="n">_Add</span><span class="p">(</span>
            <span class="nv">%Param</span><span class="p">,</span>
        <span class="p">);</span>
    <span class="p">}</span>
    <span class="k">elsif</span> <span class="p">(</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">Subaction</span><span class="p">}</span> <span class="ow">eq</span> <span class="s">&#39;AddAction&#39;</span> <span class="p">)</span> <span class="p">{</span>

        <span class="c1"># challenge token check for write action</span>
        <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">LayoutObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">ChallengeTokenCheck</span><span class="p">();</span>

        <span class="k">return</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="n">_AddAction</span><span class="p">(</span>
            <span class="nv">%Param</span><span class="p">,</span>
        <span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">Subaction</span><span class="p">}</span> <span class="ow">eq</span> <span class="s">&#39;Change&#39;</span> <span class="p">)</span> <span class="p">{</span>

        <span class="k">return</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="n">_Change</span><span class="p">(</span>
            <span class="nv">%Param</span><span class="p">,</span>
        <span class="p">);</span>
    <span class="p">}</span>
    <span class="k">elsif</span> <span class="p">(</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">Subaction</span><span class="p">}</span> <span class="ow">eq</span> <span class="s">&#39;ChangeAction&#39;</span> <span class="p">)</span> <span class="p">{</span>

        <span class="c1"># challenge token check for write action</span>
        <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">LayoutObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">ChallengeTokenCheck</span><span class="p">();</span>

        <span class="k">return</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="n">_ChangeAction</span><span class="p">(</span>
            <span class="nv">%Param</span><span class="p">,</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">LayoutObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">ErrorScreen</span><span class="p">(</span>
        <span class="n">Message</span> <span class="o">=&gt;</span> <span class="s">&quot;Undefined subaction.&quot;</span><span class="p">,</span>
    <span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Run</span></code> 是Web请求调用的默认函数。 我们尝试使这个函数尽可能简单，并让helper函数完成艰苦的工作。</p>
<div class="highlight-Perl notranslate"><div class="highlight"><pre><span></span><span class="k">sub</span> <span class="nf">_Add</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span> <span class="nv">$Self</span><span class="p">,</span> <span class="nv">%Param</span> <span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="k">my</span> <span class="nv">%GetParam</span><span class="p">;</span>
    <span class="k">for</span> <span class="k">my</span> <span class="nv">$Needed</span> <span class="p">(</span><span class="sx">qw(ObjectType FieldType FieldOrder)</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$GetParam</span><span class="p">{</span><span class="nv">$Needed</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">ParamObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">GetParam</span><span class="p">(</span> <span class="n">Param</span> <span class="o">=&gt;</span> <span class="nv">$Needed</span> <span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nv">$Needed</span> <span class="p">)</span> <span class="p">{</span>

            <span class="k">return</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">LayoutObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">ErrorScreen</span><span class="p">(</span>
                <span class="n">Message</span> <span class="o">=&gt;</span> <span class="s">&quot;Need $Needed&quot;</span><span class="p">,</span>
            <span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1"># get the object type and field type display name</span>
    <span class="k">my</span> <span class="nv">$ObjectTypeName</span> <span class="o">=</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">ObjectTypeConfig</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span> <span class="nv">$GetParam</span><span class="p">{</span><span class="n">ObjectType</span><span class="p">}</span> <span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">DisplayName</span><span class="p">}</span> <span class="o">||</span> <span class="s">&#39;&#39;</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$FieldTypeName</span>  <span class="o">=</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">FieldTypeConfig</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span> <span class="nv">$GetParam</span><span class="p">{</span><span class="n">FieldType</span><span class="p">}</span> <span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">DisplayName</span><span class="p">}</span>   <span class="o">||</span> <span class="s">&#39;&#39;</span><span class="p">;</span>

    <span class="k">return</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="n">_ShowScreen</span><span class="p">(</span>
        <span class="nv">%Param</span><span class="p">,</span>
        <span class="nv">%GetParam</span><span class="p">,</span>
        <span class="n">Mode</span>           <span class="o">=&gt;</span> <span class="s">&#39;Add&#39;</span><span class="p">,</span>
        <span class="n">ObjectTypeName</span> <span class="o">=&gt;</span> <span class="nv">$ObjectTypeName</span><span class="p">,</span>
        <span class="n">FieldTypeName</span>  <span class="o">=&gt;</span> <span class="nv">$FieldTypeName</span><span class="p">,</span>
    <span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">_Add</span></code> 函数也很简单，它只是从Web请求获取一些参数并调用 <code class="docutils literal notranslate"><span class="pre">_ShowScreen()</span></code> 函数。 通常，不需要修改此函数。</p>
<div class="highlight-Perl notranslate"><div class="highlight"><pre><span></span><span class="k">sub</span> <span class="nf">_AddAction</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span> <span class="nv">$Self</span><span class="p">,</span> <span class="nv">%Param</span> <span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="k">my</span> <span class="nv">%Errors</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">%GetParam</span><span class="p">;</span>

    <span class="k">for</span> <span class="k">my</span> <span class="nv">$Needed</span> <span class="p">(</span><span class="sx">qw(Name Label FieldOrder)</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$GetParam</span><span class="p">{</span><span class="nv">$Needed</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">ParamObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">GetParam</span><span class="p">(</span> <span class="n">Param</span> <span class="o">=&gt;</span> <span class="nv">$Needed</span> <span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nv">$GetParam</span><span class="p">{</span><span class="nv">$Needed</span><span class="p">}</span> <span class="p">)</span> <span class="p">{</span>
            <span class="nv">$Errors</span><span class="p">{</span> <span class="nv">$Needed</span> <span class="o">.</span> <span class="s">&#39;ServerError&#39;</span> <span class="p">}</span>        <span class="o">=</span> <span class="s">&#39;ServerError&#39;</span><span class="p">;</span>
            <span class="nv">$Errors</span><span class="p">{</span> <span class="nv">$Needed</span> <span class="o">.</span> <span class="s">&#39;ServerErrorMessage&#39;</span> <span class="p">}</span> <span class="o">=</span> <span class="s">&#39;This field is required.&#39;</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span> <span class="nv">$GetParam</span><span class="p">{</span><span class="n">Name</span><span class="p">}</span> <span class="p">)</span> <span class="p">{</span>

        <span class="c1"># check if name is alphanumeric</span>
        <span class="k">if</span> <span class="p">(</span> <span class="nv">$GetParam</span><span class="p">{</span><span class="n">Name</span><span class="p">}</span> <span class="o">!~</span> <span class="sr">m{\A ( ?: [a-zA-Z] | \d )+ \z}xms</span> <span class="p">)</span> <span class="p">{</span>

            <span class="c1"># add server error error class</span>
            <span class="nv">$Errors</span><span class="p">{</span><span class="n">NameServerError</span><span class="p">}</span> <span class="o">=</span> <span class="s">&#39;ServerError&#39;</span><span class="p">;</span>
            <span class="nv">$Errors</span><span class="p">{</span><span class="n">NameServerErrorMessage</span><span class="p">}</span> <span class="o">=</span>
                <span class="s">&#39;The field does not contain only ASCII letters and numbers.&#39;</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1"># check if name is duplicated</span>
        <span class="k">my</span> <span class="nv">%DynamicFieldsList</span> <span class="o">=</span> <span class="nv">%</span><span class="p">{</span>
            <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">DynamicFieldObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">DynamicFieldList</span><span class="p">(</span>
                <span class="n">Valid</span>      <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">,</span>
                <span class="n">ResultType</span> <span class="o">=&gt;</span> <span class="s">&#39;HASH&#39;</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="p">};</span>

        <span class="nv">%DynamicFieldsList</span> <span class="o">=</span> <span class="nb">reverse</span> <span class="nv">%DynamicFieldsList</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span> <span class="nv">$DynamicFieldsList</span><span class="p">{</span> <span class="nv">$GetParam</span><span class="p">{</span><span class="n">Name</span><span class="p">}</span> <span class="p">}</span> <span class="p">)</span> <span class="p">{</span>

            <span class="c1"># add server error error class</span>
            <span class="nv">$Errors</span><span class="p">{</span><span class="n">NameServerError</span><span class="p">}</span>        <span class="o">=</span> <span class="s">&#39;ServerError&#39;</span><span class="p">;</span>
            <span class="nv">$Errors</span><span class="p">{</span><span class="n">NameServerErrorMessage</span><span class="p">}</span> <span class="o">=</span> <span class="s">&#39;There is another field with the same name.&#39;</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span> <span class="nv">$GetParam</span><span class="p">{</span><span class="n">FieldOrder</span><span class="p">}</span> <span class="p">)</span> <span class="p">{</span>

        <span class="c1"># check if field order is numeric and positive</span>
        <span class="k">if</span> <span class="p">(</span> <span class="nv">$GetParam</span><span class="p">{</span><span class="n">FieldOrder</span><span class="p">}</span> <span class="o">!~</span> <span class="sr">m{\A ( ?: \d )+ \z}xms</span> <span class="p">)</span> <span class="p">{</span>

            <span class="c1"># add server error error class</span>
            <span class="nv">$Errors</span><span class="p">{</span><span class="n">FieldOrderServerError</span><span class="p">}</span>        <span class="o">=</span> <span class="s">&#39;ServerError&#39;</span><span class="p">;</span>
            <span class="nv">$Errors</span><span class="p">{</span><span class="n">FieldOrderServerErrorMessage</span><span class="p">}</span> <span class="o">=</span> <span class="s">&#39;The field must be numeric.&#39;</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="k">my</span> <span class="nv">$ConfigParam</span> <span class="p">(</span>
        <span class="sx">qw(</span>
<span class="sx">        ObjectType ObjectTypeName FieldType FieldTypeName DefaultValue ValidID ShowValue</span>
<span class="sx">        ValueMask</span>
<span class="sx">        )</span>
        <span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$GetParam</span><span class="p">{</span><span class="nv">$ConfigParam</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">ParamObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">GetParam</span><span class="p">(</span> <span class="n">Param</span> <span class="o">=&gt;</span> <span class="nv">$ConfigParam</span> <span class="p">);</span>
    <span class="p">}</span>

    <span class="c1"># uncorrectable errors</span>
    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nv">$GetParam</span><span class="p">{</span><span class="n">ValidID</span><span class="p">}</span> <span class="p">)</span> <span class="p">{</span>

        <span class="k">return</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">LayoutObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">ErrorScreen</span><span class="p">(</span>
            <span class="n">Message</span> <span class="o">=&gt;</span> <span class="s">&quot;Need ValidID&quot;</span><span class="p">,</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="c1"># return to add screen if errors</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">%Errors</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">return</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="n">_ShowScreen</span><span class="p">(</span>
            <span class="nv">%Param</span><span class="p">,</span>
            <span class="nv">%Errors</span><span class="p">,</span>
            <span class="nv">%GetParam</span><span class="p">,</span>
            <span class="n">Mode</span> <span class="o">=&gt;</span> <span class="s">&#39;Add&#39;</span><span class="p">,</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="c1"># set specific config</span>
    <span class="k">my</span> <span class="nv">$FieldConfig</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">DefaultValue</span> <span class="o">=&gt;</span> <span class="nv">$GetParam</span><span class="p">{</span><span class="n">DefaultValue</span><span class="p">},</span>
        <span class="n">ShowValue</span>    <span class="o">=&gt;</span> <span class="nv">$GetParam</span><span class="p">{</span><span class="n">ShowValue</span><span class="p">},</span>
        <span class="n">ValueMask</span>    <span class="o">=&gt;</span> <span class="nv">$GetParam</span><span class="p">{</span><span class="n">ValueMask</span><span class="p">}</span> <span class="o">||</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">DefaultValueMask</span><span class="p">},</span>
    <span class="p">};</span>

    <span class="c1"># create a new field</span>
    <span class="k">my</span> <span class="nv">$FieldID</span> <span class="o">=</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">DynamicFieldObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">DynamicFieldAdd</span><span class="p">(</span>
        <span class="n">Name</span>       <span class="o">=&gt;</span> <span class="nv">$GetParam</span><span class="p">{</span><span class="n">Name</span><span class="p">},</span>
        <span class="n">Label</span>      <span class="o">=&gt;</span> <span class="nv">$GetParam</span><span class="p">{</span><span class="n">Label</span><span class="p">},</span>
        <span class="n">FieldOrder</span> <span class="o">=&gt;</span> <span class="nv">$GetParam</span><span class="p">{</span><span class="n">FieldOrder</span><span class="p">},</span>
        <span class="n">FieldType</span>  <span class="o">=&gt;</span> <span class="nv">$GetParam</span><span class="p">{</span><span class="n">FieldType</span><span class="p">},</span>
        <span class="n">ObjectType</span> <span class="o">=&gt;</span> <span class="nv">$GetParam</span><span class="p">{</span><span class="n">ObjectType</span><span class="p">},</span>
        <span class="n">Config</span>     <span class="o">=&gt;</span> <span class="nv">$FieldConfig</span><span class="p">,</span>
        <span class="n">ValidID</span>    <span class="o">=&gt;</span> <span class="nv">$GetParam</span><span class="p">{</span><span class="n">ValidID</span><span class="p">},</span>
        <span class="n">UserID</span>     <span class="o">=&gt;</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">UserID</span><span class="p">},</span>
    <span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nv">$FieldID</span> <span class="p">)</span> <span class="p">{</span>

        <span class="k">return</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">LayoutObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">ErrorScreen</span><span class="p">(</span>
            <span class="n">Message</span> <span class="o">=&gt;</span> <span class="s">&quot;Could not create the new field&quot;</span><span class="p">,</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">LayoutObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">Redirect</span><span class="p">(</span>
        <span class="n">OP</span> <span class="o">=&gt;</span> <span class="s">&quot;Action=AdminDynamicField&quot;</span><span class="p">,</span>
    <span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p><cite>_AddAction`</cite> 函数从新的动态字段中获取配置参数，并验证动态字段名称只包含字母和数字。 此函数可以验证任何其它参数。</p>
<p><code class="docutils literal notranslate"><span class="pre">Name</span></code>、<code class="docutils literal notranslate"><span class="pre">Label</span></code>、<code class="docutils literal notranslate"><span class="pre">FieldOrder</span></code>、<code class="docutils literal notranslate"><span class="pre">Validity</span></code> 是所有动态字段的通用参数，它们是必需的。 每个动态字段都有其特定的配置，必须至少包含 <code class="docutils literal notranslate"><span class="pre">DefaultValue</span></code> 参数。 在这种情况下，它还有密码字段的 <code class="docutils literal notranslate"><span class="pre">ShowValue</span></code> 和 <code class="docutils literal notranslate"><span class="pre">ValueMask</span></code> 参数。</p>
<p>如果该字段能够存储固定的值列表，则应将它们存储在特定配置哈希内的 <code class="docutils literal notranslate"><span class="pre">PossibleValues</span></code> 参数中。</p>
<p>与其它管理模块一样，如果参数无效，则此函数将返回添加屏幕，突出显示错误的表单字段。</p>
<p>如果所有参数都正确，则会创建一个新的动态字段。</p>
<div class="highlight-Perl notranslate"><div class="highlight"><pre><span></span><span class="k">sub</span> <span class="nf">_Change</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span> <span class="nv">$Self</span><span class="p">,</span> <span class="nv">%Param</span> <span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="k">my</span> <span class="nv">%GetParam</span><span class="p">;</span>
    <span class="k">for</span> <span class="k">my</span> <span class="nv">$Needed</span> <span class="p">(</span><span class="sx">qw(ObjectType FieldType)</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$GetParam</span><span class="p">{</span><span class="nv">$Needed</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">ParamObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">GetParam</span><span class="p">(</span> <span class="n">Param</span> <span class="o">=&gt;</span> <span class="nv">$Needed</span> <span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nv">$Needed</span> <span class="p">)</span> <span class="p">{</span>

            <span class="k">return</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">LayoutObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">ErrorScreen</span><span class="p">(</span>
                <span class="n">Message</span> <span class="o">=&gt;</span> <span class="s">&quot;Need $Needed&quot;</span><span class="p">,</span>
            <span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1"># get the object type and field type display name</span>
    <span class="k">my</span> <span class="nv">$ObjectTypeName</span> <span class="o">=</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">ObjectTypeConfig</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span> <span class="nv">$GetParam</span><span class="p">{</span><span class="n">ObjectType</span><span class="p">}</span> <span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">DisplayName</span><span class="p">}</span> <span class="o">||</span> <span class="s">&#39;&#39;</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$FieldTypeName</span>  <span class="o">=</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">FieldTypeConfig</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span> <span class="nv">$GetParam</span><span class="p">{</span><span class="n">FieldType</span><span class="p">}</span> <span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">DisplayName</span><span class="p">}</span>   <span class="o">||</span> <span class="s">&#39;&#39;</span><span class="p">;</span>

    <span class="k">my</span> <span class="nv">$FieldID</span> <span class="o">=</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">ParamObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">GetParam</span><span class="p">(</span> <span class="n">Param</span> <span class="o">=&gt;</span> <span class="s">&#39;ID&#39;</span> <span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nv">$FieldID</span> <span class="p">)</span> <span class="p">{</span>

        <span class="k">return</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">LayoutObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">ErrorScreen</span><span class="p">(</span>
            <span class="n">Message</span> <span class="o">=&gt;</span> <span class="s">&quot;Need ID&quot;</span><span class="p">,</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="c1"># get dynamic field data</span>
    <span class="k">my</span> <span class="nv">$DynamicFieldData</span> <span class="o">=</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">DynamicFieldObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">DynamicFieldGet</span><span class="p">(</span>
        <span class="n">ID</span> <span class="o">=&gt;</span> <span class="nv">$FieldID</span><span class="p">,</span>
    <span class="p">);</span>

    <span class="c1"># check for valid dynamic field configuration</span>
    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">IsHashRefWithData</span><span class="p">(</span><span class="nv">$DynamicFieldData</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>

        <span class="k">return</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">LayoutObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">ErrorScreen</span><span class="p">(</span>
            <span class="n">Message</span> <span class="o">=&gt;</span> <span class="s">&quot;Could not get data for dynamic field $FieldID&quot;</span><span class="p">,</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">my</span> <span class="nv">%Config</span> <span class="o">=</span> <span class="p">();</span>

    <span class="c1"># extract configuration</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">IsHashRefWithData</span><span class="p">(</span> <span class="nv">$DynamicFieldData</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">Config</span><span class="p">}</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nv">%Config</span> <span class="o">=</span> <span class="nv">%</span><span class="p">{</span> <span class="nv">$DynamicFieldData</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">Config</span><span class="p">}</span> <span class="p">};</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="n">_ShowScreen</span><span class="p">(</span>
        <span class="nv">%Param</span><span class="p">,</span>
        <span class="nv">%GetParam</span><span class="p">,</span>
        <span class="nv">%$</span><span class="p">{</span><span class="n">DynamicFieldData</span><span class="p">},</span>
        <span class="nv">%Config</span><span class="p">,</span>
        <span class="n">ID</span>             <span class="o">=&gt;</span> <span class="nv">$FieldID</span><span class="p">,</span>
        <span class="n">Mode</span>           <span class="o">=&gt;</span> <span class="s">&#39;Change&#39;</span><span class="p">,</span>
        <span class="n">ObjectTypeName</span> <span class="o">=&gt;</span> <span class="nv">$ObjectTypeName</span><span class="p">,</span>
        <span class="n">FieldTypeName</span>  <span class="o">=&gt;</span> <span class="nv">$FieldTypeName</span><span class="p">,</span>
    <span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">_Change</span></code> 函数与 <code class="docutils literal notranslate"><span class="pre">_Add</span></code> 函数非常相似，但由于此函数用于编辑现有字段，因此需要验证 <code class="docutils literal notranslate"><span class="pre">FieldID</span></code> 参数并收集当前动态字段数据。</p>
<div class="highlight-Perl notranslate"><div class="highlight"><pre><span></span><span class="k">sub</span> <span class="nf">_ChangeAction</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span> <span class="nv">$Self</span><span class="p">,</span> <span class="nv">%Param</span> <span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="k">my</span> <span class="nv">%Errors</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">%GetParam</span><span class="p">;</span>

    <span class="k">for</span> <span class="k">my</span> <span class="nv">$Needed</span> <span class="p">(</span><span class="sx">qw(Name Label FieldOrder)</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$GetParam</span><span class="p">{</span><span class="nv">$Needed</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">ParamObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">GetParam</span><span class="p">(</span> <span class="n">Param</span> <span class="o">=&gt;</span> <span class="nv">$Needed</span> <span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nv">$GetParam</span><span class="p">{</span><span class="nv">$Needed</span><span class="p">}</span> <span class="p">)</span> <span class="p">{</span>
            <span class="nv">$Errors</span><span class="p">{</span> <span class="nv">$Needed</span> <span class="o">.</span> <span class="s">&#39;ServerError&#39;</span> <span class="p">}</span>        <span class="o">=</span> <span class="s">&#39;ServerError&#39;</span><span class="p">;</span>
            <span class="nv">$Errors</span><span class="p">{</span> <span class="nv">$Needed</span> <span class="o">.</span> <span class="s">&#39;ServerErrorMessage&#39;</span> <span class="p">}</span> <span class="o">=</span> <span class="s">&#39;This field is required.&#39;</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">my</span> <span class="nv">$FieldID</span> <span class="o">=</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">ParamObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">GetParam</span><span class="p">(</span> <span class="n">Param</span> <span class="o">=&gt;</span> <span class="s">&#39;ID&#39;</span> <span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nv">$FieldID</span> <span class="p">)</span> <span class="p">{</span>

        <span class="k">return</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">LayoutObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">ErrorScreen</span><span class="p">(</span>
            <span class="n">Message</span> <span class="o">=&gt;</span> <span class="s">&quot;Need ID&quot;</span><span class="p">,</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span> <span class="nv">$GetParam</span><span class="p">{</span><span class="n">Name</span><span class="p">}</span> <span class="p">)</span> <span class="p">{</span>

        <span class="c1"># check if name is lowercase</span>
        <span class="k">if</span> <span class="p">(</span> <span class="nv">$GetParam</span><span class="p">{</span><span class="n">Name</span><span class="p">}</span> <span class="o">!~</span> <span class="sr">m{\A ( ?: [a-zA-Z] | \d )+ \z}xms</span> <span class="p">)</span> <span class="p">{</span>

            <span class="c1"># add server error error class</span>
            <span class="nv">$Errors</span><span class="p">{</span><span class="n">NameServerError</span><span class="p">}</span> <span class="o">=</span> <span class="s">&#39;ServerError&#39;</span><span class="p">;</span>
            <span class="nv">$Errors</span><span class="p">{</span><span class="n">NameServerErrorMessage</span><span class="p">}</span> <span class="o">=</span>
                <span class="s">&#39;The field does not contain only ASCII letters and numbers.&#39;</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1"># check if name is duplicated</span>
        <span class="k">my</span> <span class="nv">%DynamicFieldsList</span> <span class="o">=</span> <span class="nv">%</span><span class="p">{</span>
            <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">DynamicFieldObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">DynamicFieldList</span><span class="p">(</span>
                <span class="n">Valid</span>      <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">,</span>
                <span class="n">ResultType</span> <span class="o">=&gt;</span> <span class="s">&#39;HASH&#39;</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="p">};</span>

        <span class="nv">%DynamicFieldsList</span> <span class="o">=</span> <span class="nb">reverse</span> <span class="nv">%DynamicFieldsList</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="nv">$DynamicFieldsList</span><span class="p">{</span> <span class="nv">$GetParam</span><span class="p">{</span><span class="n">Name</span><span class="p">}</span> <span class="p">}</span> <span class="o">&amp;&amp;</span>
            <span class="nv">$DynamicFieldsList</span><span class="p">{</span> <span class="nv">$GetParam</span><span class="p">{</span><span class="n">Name</span><span class="p">}</span> <span class="p">}</span> <span class="ow">ne</span> <span class="nv">$FieldID</span>
            <span class="p">)</span>
        <span class="p">{</span>

            <span class="c1"># add server error class</span>
            <span class="nv">$Errors</span><span class="p">{</span><span class="n">NameServerError</span><span class="p">}</span>        <span class="o">=</span> <span class="s">&#39;ServerError&#39;</span><span class="p">;</span>
            <span class="nv">$Errors</span><span class="p">{</span><span class="n">NameServerErrorMessage</span><span class="p">}</span> <span class="o">=</span> <span class="s">&#39;There is another field with the same name.&#39;</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span> <span class="nv">$GetParam</span><span class="p">{</span><span class="n">FieldOrder</span><span class="p">}</span> <span class="p">)</span> <span class="p">{</span>

        <span class="c1"># check if field order is numeric and positive</span>
        <span class="k">if</span> <span class="p">(</span> <span class="nv">$GetParam</span><span class="p">{</span><span class="n">FieldOrder</span><span class="p">}</span> <span class="o">!~</span> <span class="sr">m{\A ( ?: \d )+ \z}xms</span> <span class="p">)</span> <span class="p">{</span>

            <span class="c1"># add server error error class</span>
            <span class="nv">$Errors</span><span class="p">{</span><span class="n">FieldOrderServerError</span><span class="p">}</span>        <span class="o">=</span> <span class="s">&#39;ServerError&#39;</span><span class="p">;</span>
            <span class="nv">$Errors</span><span class="p">{</span><span class="n">FieldOrderServerErrorMessage</span><span class="p">}</span> <span class="o">=</span> <span class="s">&#39;The field must be numeric.&#39;</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="k">my</span> <span class="nv">$ConfigParam</span> <span class="p">(</span>
        <span class="sx">qw(</span>
<span class="sx">        ObjectType ObjectTypeName FieldType FieldTypeName DefaultValue ValidID ShowValue</span>
<span class="sx">        ValueMask</span>
<span class="sx">        )</span>
        <span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$GetParam</span><span class="p">{</span><span class="nv">$ConfigParam</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">ParamObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">GetParam</span><span class="p">(</span> <span class="n">Param</span> <span class="o">=&gt;</span> <span class="nv">$ConfigParam</span> <span class="p">);</span>
    <span class="p">}</span>

    <span class="c1"># uncorrectable errors</span>
    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nv">$GetParam</span><span class="p">{</span><span class="n">ValidID</span><span class="p">}</span> <span class="p">)</span> <span class="p">{</span>

        <span class="k">return</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">LayoutObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">ErrorScreen</span><span class="p">(</span>
            <span class="n">Message</span> <span class="o">=&gt;</span> <span class="s">&quot;Need ValidID&quot;</span><span class="p">,</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="c1"># get dynamic field data</span>
    <span class="k">my</span> <span class="nv">$DynamicFieldData</span> <span class="o">=</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">DynamicFieldObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">DynamicFieldGet</span><span class="p">(</span>
        <span class="n">ID</span> <span class="o">=&gt;</span> <span class="nv">$FieldID</span><span class="p">,</span>
    <span class="p">);</span>

    <span class="c1"># check for valid dynamic field configuration</span>
    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">IsHashRefWithData</span><span class="p">(</span><span class="nv">$DynamicFieldData</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>

        <span class="k">return</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">LayoutObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">ErrorScreen</span><span class="p">(</span>
            <span class="n">Message</span> <span class="o">=&gt;</span> <span class="s">&quot;Could not get data for dynamic field $FieldID&quot;</span><span class="p">,</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="c1"># return to change screen if errors</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">%Errors</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">return</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="n">_ShowScreen</span><span class="p">(</span>
            <span class="nv">%Param</span><span class="p">,</span>
            <span class="nv">%Errors</span><span class="p">,</span>
            <span class="nv">%GetParam</span><span class="p">,</span>
            <span class="n">ID</span>   <span class="o">=&gt;</span> <span class="nv">$FieldID</span><span class="p">,</span>
            <span class="n">Mode</span> <span class="o">=&gt;</span> <span class="s">&#39;Change&#39;</span><span class="p">,</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="c1"># set specific config</span>
    <span class="k">my</span> <span class="nv">$FieldConfig</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">DefaultValue</span> <span class="o">=&gt;</span> <span class="nv">$GetParam</span><span class="p">{</span><span class="n">DefaultValue</span><span class="p">},</span>
        <span class="n">ShowValue</span>    <span class="o">=&gt;</span> <span class="nv">$GetParam</span><span class="p">{</span><span class="n">ShowValue</span><span class="p">},</span>
        <span class="n">ValueMask</span>    <span class="o">=&gt;</span> <span class="nv">$GetParam</span><span class="p">{</span><span class="n">ValueMask</span><span class="p">},</span>
    <span class="p">};</span>

    <span class="c1"># update dynamic field (FieldType and ObjectType cannot be changed; use old values)</span>
    <span class="k">my</span> <span class="nv">$UpdateSuccess</span> <span class="o">=</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">DynamicFieldObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">DynamicFieldUpdate</span><span class="p">(</span>
        <span class="n">ID</span>         <span class="o">=&gt;</span> <span class="nv">$FieldID</span><span class="p">,</span>
        <span class="n">Name</span>       <span class="o">=&gt;</span> <span class="nv">$GetParam</span><span class="p">{</span><span class="n">Name</span><span class="p">},</span>
        <span class="n">Label</span>      <span class="o">=&gt;</span> <span class="nv">$GetParam</span><span class="p">{</span><span class="n">Label</span><span class="p">},</span>
        <span class="n">FieldOrder</span> <span class="o">=&gt;</span> <span class="nv">$GetParam</span><span class="p">{</span><span class="n">FieldOrder</span><span class="p">},</span>
        <span class="n">FieldType</span>  <span class="o">=&gt;</span> <span class="nv">$DynamicFieldData</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">FieldType</span><span class="p">},</span>
        <span class="n">ObjectType</span> <span class="o">=&gt;</span> <span class="nv">$DynamicFieldData</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">ObjectType</span><span class="p">},</span>
        <span class="n">Config</span>     <span class="o">=&gt;</span> <span class="nv">$FieldConfig</span><span class="p">,</span>
        <span class="n">ValidID</span>    <span class="o">=&gt;</span> <span class="nv">$GetParam</span><span class="p">{</span><span class="n">ValidID</span><span class="p">},</span>
        <span class="n">UserID</span>     <span class="o">=&gt;</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">UserID</span><span class="p">},</span>
    <span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nv">$UpdateSuccess</span> <span class="p">)</span> <span class="p">{</span>

        <span class="k">return</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">LayoutObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">ErrorScreen</span><span class="p">(</span>
            <span class="n">Message</span> <span class="o">=&gt;</span> <span class="s">&quot;Could not update the field $GetParam{Name}&quot;</span><span class="p">,</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">LayoutObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">Redirect</span><span class="p">(</span>
        <span class="n">OP</span> <span class="o">=&gt;</span> <span class="s">&quot;Action=AdminDynamicField&quot;</span><span class="p">,</span>
    <span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">_ChangeAction()</span></code> 与 <code class="docutils literal notranslate"><span class="pre">_AddAction()</span></code> 非常相似，但适用于更新现有字段而不是创建新字段。</p>
<div class="highlight-Perl notranslate"><div class="highlight"><pre><span></span><span class="k">sub</span> <span class="nf">_ShowScreen</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span> <span class="nv">$Self</span><span class="p">,</span> <span class="nv">%Param</span> <span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="nv">$Param</span><span class="p">{</span><span class="n">DisplayFieldName</span><span class="p">}</span> <span class="o">=</span> <span class="s">&#39;New&#39;</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">Mode</span><span class="p">}</span> <span class="ow">eq</span> <span class="s">&#39;Change&#39;</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nv">$Param</span><span class="p">{</span><span class="n">ShowWarning</span><span class="p">}</span>      <span class="o">=</span> <span class="s">&#39;ShowWarning&#39;</span><span class="p">;</span>
        <span class="nv">$Param</span><span class="p">{</span><span class="n">DisplayFieldName</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">Name</span><span class="p">};</span>
    <span class="p">}</span>

    <span class="c1"># header</span>
    <span class="k">my</span> <span class="nv">$Output</span> <span class="o">=</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">LayoutObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">Header</span><span class="p">();</span>
    <span class="nv">$Output</span> <span class="o">.=</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">LayoutObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">NavigationBar</span><span class="p">();</span>

    <span class="c1"># get all fields</span>
    <span class="k">my</span> <span class="nv">$DynamicFieldList</span> <span class="o">=</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">DynamicFieldObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">DynamicFieldListGet</span><span class="p">(</span>
        <span class="n">Valid</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">);</span>

    <span class="c1"># get the list of order numbers (is already sorted).</span>
    <span class="k">my</span> <span class="nv">@DynamicfieldOrderList</span><span class="p">;</span>
    <span class="k">for</span> <span class="k">my</span> <span class="nv">$Dynamicfield</span> <span class="p">(</span> <span class="nv">@</span><span class="p">{</span><span class="nv">$DynamicFieldList</span><span class="p">}</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nb">push</span> <span class="nv">@DynamicfieldOrderList</span><span class="p">,</span> <span class="nv">$Dynamicfield</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">FieldOrder</span><span class="p">};</span>
    <span class="p">}</span>

    <span class="c1"># when adding we need to create an extra order number for the new field</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">Mode</span><span class="p">}</span> <span class="ow">eq</span> <span class="s">&#39;Add&#39;</span> <span class="p">)</span> <span class="p">{</span>

        <span class="c1"># get the last element from the order list and add 1</span>
        <span class="k">my</span> <span class="nv">$LastOrderNumber</span> <span class="o">=</span> <span class="nv">$DynamicfieldOrderList</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
        <span class="nv">$LastOrderNumber</span><span class="o">++</span><span class="p">;</span>

        <span class="c1"># add this new order number to the end of the list</span>
        <span class="nb">push</span> <span class="nv">@DynamicfieldOrderList</span><span class="p">,</span> <span class="nv">$LastOrderNumber</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">my</span> <span class="nv">$DynamicFieldOrderSrtg</span> <span class="o">=</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">LayoutObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">BuildSelection</span><span class="p">(</span>
        <span class="n">Data</span>          <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">@DynamicfieldOrderList</span><span class="p">,</span>
        <span class="n">Name</span>          <span class="o">=&gt;</span> <span class="s">&#39;FieldOrder&#39;</span><span class="p">,</span>
        <span class="n">SelectedValue</span> <span class="o">=&gt;</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">FieldOrder</span><span class="p">}</span> <span class="o">||</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">PossibleNone</span>  <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">Class</span>         <span class="o">=&gt;</span> <span class="s">&#39;W50pc Validate_Number&#39;</span><span class="p">,</span>
    <span class="p">);</span>

    <span class="k">my</span> <span class="nv">%ValidList</span> <span class="o">=</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">ValidObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">ValidList</span><span class="p">();</span>

    <span class="c1"># create the Validity select</span>
    <span class="k">my</span> <span class="nv">$ValidityStrg</span> <span class="o">=</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">LayoutObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">BuildSelection</span><span class="p">(</span>
        <span class="n">Data</span>         <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">%ValidList</span><span class="p">,</span>
        <span class="n">Name</span>         <span class="o">=&gt;</span> <span class="s">&#39;ValidID&#39;</span><span class="p">,</span>
        <span class="n">SelectedID</span>   <span class="o">=&gt;</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">ValidID</span><span class="p">}</span> <span class="o">||</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">PossibleNone</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">Translation</span>  <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">Class</span>        <span class="o">=&gt;</span> <span class="s">&#39;W50pc&#39;</span><span class="p">,</span>
    <span class="p">);</span>

    <span class="c1"># define config field specific settings</span>
    <span class="k">my</span> <span class="nv">$DefaultValue</span> <span class="o">=</span> <span class="p">(</span> <span class="nb">defined</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">DefaultValue</span><span class="p">}</span> <span class="p">?</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">DefaultValue</span><span class="p">}</span> <span class="p">:</span> <span class="s">&#39;&#39;</span> <span class="p">);</span>

    <span class="c1"># create the Show value select</span>
    <span class="k">my</span> <span class="nv">$ShowValueStrg</span> <span class="o">=</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">LayoutObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">BuildSelection</span><span class="p">(</span>
        <span class="n">Data</span> <span class="o">=&gt;</span> <span class="p">[</span> <span class="s">&#39;No&#39;</span><span class="p">,</span> <span class="s">&#39;Yes&#39;</span> <span class="p">],</span>
        <span class="n">Name</span> <span class="o">=&gt;</span> <span class="s">&#39;ShowValue&#39;</span><span class="p">,</span>
        <span class="n">SelectedValue</span> <span class="o">=&gt;</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">ShowValue</span><span class="p">}</span> <span class="o">||</span> <span class="s">&#39;No&#39;</span><span class="p">,</span>
        <span class="n">PossibleNone</span>  <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">Translation</span>   <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">Class</span>         <span class="o">=&gt;</span> <span class="s">&#39;W50pc&#39;</span><span class="p">,</span>
    <span class="p">);</span>

    <span class="c1"># generate output</span>
    <span class="nv">$Output</span> <span class="o">.=</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">LayoutObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">Output</span><span class="p">(</span>
        <span class="n">TemplateFile</span> <span class="o">=&gt;</span> <span class="s">&#39;AdminDynamicFieldPassword&#39;</span><span class="p">,</span>
        <span class="n">Data</span>         <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nv">%Param</span><span class="p">,</span>
            <span class="n">ValidityStrg</span>          <span class="o">=&gt;</span> <span class="nv">$ValidityStrg</span><span class="p">,</span>
            <span class="n">DynamicFieldOrderSrtg</span> <span class="o">=&gt;</span> <span class="nv">$DynamicFieldOrderSrtg</span><span class="p">,</span>
            <span class="n">DefaultValue</span>          <span class="o">=&gt;</span> <span class="nv">$DefaultValue</span><span class="p">,</span>
            <span class="n">ShowValueStrg</span>         <span class="o">=&gt;</span> <span class="nv">$ShowValueStrg</span><span class="p">,</span>
            <span class="n">ValueMask</span>             <span class="o">=&gt;</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">ValueMask</span><span class="p">}</span> <span class="o">||</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">DefaultValueMask</span><span class="p">},</span>
        <span class="p">},</span>
    <span class="p">);</span>

    <span class="nv">$Output</span> <span class="o">.=</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">LayoutObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">Footer</span><span class="p">();</span>

    <span class="k">return</span> <span class="nv">$Output</span><span class="p">;</span>
<span class="p">}</span>

<span class="mi">1</span><span class="p">;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">_ShowScreen</span></code> 函数用于设置和定义模板中的HTML元素和块，以生成管理对话框HTML代码。</p>
</div>
<div class="section" id="dynamic-field-template-for-admin-dialog-example">
<h3>用于管理对话框的动态字段模块示例<a class="headerlink" href="#dynamic-field-template-for-admin-dialog-example" title="永久链接至标题">¶</a></h3>
<p>模板是存储对话框的HTML代码的位置。</p>
<p>在本节中，将显示和解释password动态字段的管理对话框模板。</p>
<div class="highlight-Perl notranslate"><div class="highlight"><pre><span></span><span class="c1"># --</span>
<span class="c1"># Copyright (C) 2001-2020 OTRS AG, https://otrs.com/</span>
<span class="c1"># --</span>
<span class="c1"># This software comes with ABSOLUTELY NO WARRANTY. For details, see</span>
<span class="c1"># the enclosed file COPYING for license information (GPL). If you</span>
<span class="c1"># did not receive this file, see https://www.gnu.org/licenses/gpl-3.0.txt.</span>
<span class="c1"># --</span>
</pre></div>
</div>
<p>这是可在常见OTRS模块中找到的通用标头。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;div class=&quot;MainBox ARIARoleMain LayoutFixedSidebar SidebarFirst&quot;&gt;
    &lt;h1&gt;[% Translate(&quot;Dynamic Fields&quot;) | html %] - [% Translate(Data.ObjectTypeName) | html %]: [% Translate(Data.Mode) | html %] [% Translate(Data.FieldTypeName) | html %] [% Translate(&quot;Field&quot;) | html %]&lt;/h1&gt;

    &lt;div class=&quot;Clear&quot;&gt;&lt;/div&gt;

    &lt;div class=&quot;SidebarColumn&quot;&gt;
        &lt;div class=&quot;WidgetSimple&quot;&gt;
            &lt;div class=&quot;Header&quot;&gt;
                &lt;h2&gt;[% Translate(&quot;Actions&quot;) | html %]&lt;/h2&gt;
            &lt;/div&gt;
            &lt;div class=&quot;Content&quot;&gt;
                &lt;ul class=&quot;ActionList&quot;&gt;
                    &lt;li&gt;
                        &lt;a href=&quot;[% Env(&quot;Baselink&quot;) %]Action=AdminDynamicField&quot; class=&quot;CallForAction&quot;&gt;&lt;span&gt;[% Translate(&quot;Go back to overview&quot;) | html %]&lt;/span&gt;&lt;/a&gt;
                    &lt;/li&gt;
                &lt;/ul&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
</pre></div>
</div>
<p>这部分代码有主框和动作侧栏。 本部分不需要修改。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;div class=&quot;ContentColumn&quot;&gt;
    &lt;form action=&quot;[% Env(&quot;CGIHandle&quot;) %]&quot; method=&quot;post&quot; class=&quot;Validate PreventMultipleSubmits&quot;&gt;
        &lt;input type=&quot;hidden&quot; name=&quot;Action&quot; value=&quot;AdminDynamicFieldPassword&quot; /&gt;
        &lt;input type=&quot;hidden&quot; name=&quot;Subaction&quot; value=&quot;[% Data.Mode | html %]Action&quot; /&gt;
        &lt;input type=&quot;hidden&quot; name=&quot;ObjectType&quot; value=&quot;[% Data.ObjectType | html %]&quot; /&gt;
        &lt;input type=&quot;hidden&quot; name=&quot;FieldType&quot; value=&quot;[% Data.FieldType | html %]&quot; /&gt;
        &lt;input type=&quot;hidden&quot; name=&quot;ID&quot; value=&quot;[% Data.ID | html %]&quot; /&gt;
</pre></div>
</div>
<p>在这部分代码中定义了对话框的右侧部分。 请注意，<code class="docutils literal notranslate"><span class="pre">Action</span></code> 隐藏输入的值必须与管理对话框的名称匹配。</p>
<div class="highlight-HTML notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;WidgetSimple&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;Header&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>[% Translate(&quot;General&quot;) | html %]<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;Content&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;LayoutGrid ColumnsWithSpacing&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;Size1of2&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">fieldset</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;TableLike&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">label</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;Mandatory&quot;</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;Name&quot;</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;Marker&quot;</span><span class="p">&gt;</span>*<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span> [% Translate(&quot;Name&quot;) | html %]:<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;Field&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;Name&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;W50pc [% Data.NameServerError | html %] [% Data.ShowWarning | html %]  Validate_Alphanumeric&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">maxlength</span><span class="o">=</span><span class="s">&quot;200&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;[% Data.Name | html %]&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;Name&quot;</span><span class="p">/&gt;</span>
                        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;NameError&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;TooltipErrorMessage&quot;</span><span class="p">&gt;&lt;</span><span class="nt">p</span><span class="p">&gt;</span>[% Translate(&quot;This field is required, and the value should be alphabetic and numeric characters only.&quot;) | html %]<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;NameServerError&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;TooltipErrorMessage&quot;</span><span class="p">&gt;&lt;</span><span class="nt">p</span><span class="p">&gt;</span>[% Translate(Data.NameServerErrorMessage) | html %]<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;FieldExplanation&quot;</span><span class="p">&gt;</span>[% Translate(&quot;Must be unique and only accept alphabetic and numeric characters.&quot;) | html %]<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;Warning Hidden&quot;</span><span class="p">&gt;</span>[% Translate(&quot;Changing this value will require manual changes in the system.&quot;) | html %]<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;Clear&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

                    <span class="p">&lt;</span><span class="nt">label</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;Mandatory&quot;</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;Label&quot;</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;Marker&quot;</span><span class="p">&gt;</span>*<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span> [% Translate(&quot;Label&quot;) | html %]:<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;Field&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;Label&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;W50pc [% Data.LabelServerError | html %] Validate_Required&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">maxlength</span><span class="o">=</span><span class="s">&quot;200&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;[% Data.Label | html %]&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;Label&quot;</span><span class="p">/&gt;</span>
                        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;LabelError&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;TooltipErrorMessage&quot;</span><span class="p">&gt;&lt;</span><span class="nt">p</span><span class="p">&gt;</span>[% Translate(&quot;This field is required.&quot;) | html %]<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;LabelServerError&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;TooltipErrorMessage&quot;</span><span class="p">&gt;&lt;</span><span class="nt">p</span><span class="p">&gt;</span>[% Translate(Data.LabelServerErrorMessage) | html %]<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;FieldExplanation&quot;</span><span class="p">&gt;</span>[% Translate(&quot;This is the name to be shown on the screens where the field is active.&quot;) | html %]<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;Clear&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

                    <span class="p">&lt;</span><span class="nt">label</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;Mandatory&quot;</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;FieldOrder&quot;</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;Marker&quot;</span><span class="p">&gt;</span>*<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span> [% Translate(&quot;Field order&quot;) | html %]:<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;Field&quot;</span><span class="p">&gt;</span>
                        [% Data.DynamicFieldOrderSrtg %]
                        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;FieldOrderError&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;TooltipErrorMessage&quot;</span><span class="p">&gt;&lt;</span><span class="nt">p</span><span class="p">&gt;</span>[% Translate(&quot;This field is required and must be numeric.&quot;) | html %]<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;FieldOrderServerError&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;TooltipErrorMessage&quot;</span><span class="p">&gt;&lt;</span><span class="nt">p</span><span class="p">&gt;</span>[% Translate(Data.FieldOrderServerErrorMessage) | html %]<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;FieldExplanation&quot;</span><span class="p">&gt;</span>[% Translate(&quot;This is the order in which this field will be shown on the screens where is active.&quot;) | html %]<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;Clear&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">fieldset</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;Size1of2&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">fieldset</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;TableLike&quot;</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;ValidID&quot;</span><span class="p">&gt;</span>[% Translate(&quot;Validity&quot;) | html %]:<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;Field&quot;</span><span class="p">&gt;</span>
                        [% Data.ValidityStrg %]
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;Clear&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;SpacingTop&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;FieldTypeName&quot;</span><span class="p">&gt;</span>[% Translate(&quot;Field type&quot;) | html %]:<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;Field&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;FieldTypeName&quot;</span> <span class="na">readonly</span><span class="o">=</span><span class="s">&quot;readonly&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;W50pc&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">maxlength</span><span class="o">=</span><span class="s">&quot;200&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;[% Data.FieldTypeName | html %]&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;FieldTypeName&quot;</span><span class="p">/&gt;</span>
                        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;Clear&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;SpacingTop&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;ObjectTypeName&quot;</span><span class="p">&gt;</span>[% Translate(&quot;Object type&quot;) | html %]:<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;Field&quot;</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;ObjectTypeName&quot;</span> <span class="na">readonly</span><span class="o">=</span><span class="s">&quot;readonly&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;W50pc&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">maxlength</span><span class="o">=</span><span class="s">&quot;200&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;[% Data.ObjectTypeName | html %]&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;ObjectTypeName&quot;</span><span class="p">/&gt;</span>
                        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;Clear&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">fieldset</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>第一个小部件包含动态字段的通用表单属性。为了与其它动态字段保持一致，建议保持代码的这部分不变。</p>
<div class="highlight-HTML notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;WidgetSimple&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;Header&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>[% Translate(Data.FieldTypeName) | html %] [% Translate(&quot;Field Settings&quot;) | html %]<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;Content&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">fieldset</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;TableLike&quot;</span><span class="p">&gt;</span>

            <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;DefaultValue&quot;</span><span class="p">&gt;</span>[% Translate(&quot;Default value&quot;) | html %]:<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;Field&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">input</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;DefaultValue&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;W50pc&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">maxlength</span><span class="o">=</span><span class="s">&quot;200&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;[% Data.DefaultValue | html %]&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;DefaultValue&quot;</span><span class="p">/&gt;</span>
                <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;FieldExplanation&quot;</span><span class="p">&gt;</span>[% Translate(&quot;This is the default value for this field.&quot;) | html %]<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;Clear&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

            <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;ShowValue&quot;</span><span class="p">&gt;</span>[% Translate(&quot;Show value&quot;) | html %]:<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;Field&quot;</span><span class="p">&gt;</span>
                [% Data.ShowValueStrg %]
                <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;FieldExplanation&quot;</span><span class="p">&gt;</span>
                    [% Translate(&quot;To reveal the field value in non edit screens ( e.g. Ticket Zoom Screen )&quot;) | html %]
                <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;Clear&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

            <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;ValueMask&quot;</span><span class="p">&gt;</span>[% Translate(&quot;Hidden value mask&quot;) | html %]:<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;Field&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">input</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;ValueMask&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;W50pc&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">maxlength</span><span class="o">=</span><span class="s">&quot;200&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;[% Data.ValueMask | html %]&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;ValueMask&quot;</span><span class="p">/&gt;</span>
                <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;FieldExplanation&quot;</span><span class="p">&gt;</span>
                    [% Translate(&quot;This is the alternate value to show if Show value is set to \&quot;No\&quot; ( Default: **** ).&quot;) | html %]
                <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;Clear&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

        <span class="p">&lt;/</span><span class="nt">fieldset</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>第二个小部件具有特定于动态字段的表单属性。这是可以设置新属性的地方，它可以使用Javascript和AJAX技术使最终用户更容易或更友好。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>            &lt;fieldset class=&quot;TableLike&quot;&gt;
                &lt;div class=&quot;Field SpacingTop&quot;&gt;
                    &lt;button type=&quot;submit&quot; class=&quot;Primary&quot; value=&quot;[% Translate(&quot;Save&quot;) | html %]&quot;&gt;[% Translate(&quot;Save&quot;) | html %]&lt;/button&gt;
                    [% Translate(&quot;or&quot;) | html %]
                    &lt;a href=&quot;[% Env(&quot;Baselink&quot;) %]Action=AdminDynamicField&quot;&gt;[% Translate(&quot;Cancel&quot;) | html %]&lt;/a&gt;
                &lt;/div&gt;
                &lt;div class=&quot;Clear&quot;&gt;&lt;/div&gt;
            &lt;/fieldset&gt;
        &lt;/form&gt;
    &lt;/div&gt;
&lt;/div&gt;
[% WRAPPER JSOnDocumentComplete %]
&lt;script type=&quot;text/javascript&quot;&gt;//&lt;![CDATA[
$(&#39;.ShowWarning&#39;).bind(&#39;change keyup&#39;, function (Event) {
    $(&#39;p.Warning&#39;).removeClass(&#39;Hidden&#39;);
});

Core.Agent.Admin.DynamicField.ValidationInit();
//]]&gt;&lt;/script&gt;
[% END %]
</pre></div>
</div>
<p>文件的最后一部分包含 <em>保存</em> 按钮和 <em>取消</em> 链接，以及其它需要的JavaScript代码。</p>
</div>
<div class="section" id="dynamic-field-driver-example">
<h3>动态字段驱动程序示例<a class="headerlink" href="#dynamic-field-driver-example" title="永久链接至标题">¶</a></h3>
<p>驱动程序 <em>即是</em> 动态字段。 它包含在OTRS框架中广泛使用的几个函数。 驱动程序可以从基类继承一些函数，例如 <code class="docutils literal notranslate"><span class="pre">TextArea</span></code> 驱动程序从 <code class="docutils literal notranslate"><span class="pre">Base.pm</span></code> 和 <code class="docutils literal notranslate"><span class="pre">BaseText.pm</span></code> 继承大多数函数，它只实现需要不同逻辑的函数或结果。 复选框字段驱动程序仅继承自 <code class="docutils literal notranslate"><span class="pre">Base.pm</span></code>，因为所有其它函数与任何其它基本驱动程序非常不同。</p>
<div class="admonition seealso">
<p class="first admonition-title">参见</p>
<p class="last">请参阅模块 <code class="docutils literal notranslate"><span class="pre">/Kernel/System/DynmicField/Backend.pm</span></code> 的Perl在线文档（POD），以获得每个函数的所有属性和可能的返回数据的列表。</p>
</div>
<p>在本节中，将显示和解释password动态字段驱动程序。 这个驱动程序继承了 <code class="docutils literal notranslate"><span class="pre">Base.pm</span></code> 和 <code class="docutils literal notranslate"><span class="pre">BaseText.pm</span></code> 中的一些函数，只实现了需要不同结果的函数。</p>
<div class="highlight-Perl notranslate"><div class="highlight"><pre><span></span><span class="c1"># --</span>
<span class="c1"># Copyright (C) 2001-2020 OTRS AG, https://otrs.com/</span>
<span class="c1"># --</span>
<span class="c1"># This software comes with ABSOLUTELY NO WARRANTY. For details, see</span>
<span class="c1"># the enclosed file COPYING for license information (GPL). If you</span>
<span class="c1"># did not receive this file, see https://www.gnu.org/licenses/gpl-3.0.txt.</span>
<span class="c1"># --</span>

<span class="k">package</span> <span class="nn">Kernel::System::DynamicField::Driver::Password</span><span class="p">;</span>

<span class="k">use</span> <span class="nn">strict</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">warnings</span><span class="p">;</span>

<span class="k">use</span> <span class="nn">Kernel::System::VariableCheck</span> <span class="sx">qw(:all)</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">Kernel::System::DynamicFieldValue</span><span class="p">;</span>

<span class="k">use</span> <span class="nn">base</span> <span class="sx">qw(Kernel::System::DynamicField::Driver::BaseText)</span><span class="p">;</span>

<span class="k">our</span> <span class="nv">@ObjectDependencies</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s">&#39;Kernel::Config&#39;</span><span class="p">,</span>
    <span class="s">&#39;Kernel::System::DynamicFieldValue&#39;</span><span class="p">,</span>
    <span class="s">&#39;Kernel::System::Main&#39;</span><span class="p">,</span>
<span class="p">);</span>
</pre></div>
</div>
<p>这是可在常见OTRS模块中找到的通用标头。 类/包名称通过 <code class="docutils literal notranslate"><span class="pre">package</span></code> 关键字声明。 请注意，<code class="docutils literal notranslate"><span class="pre">BaseText</span></code> 用作基类。</p>
<div class="highlight-Perl notranslate"><div class="highlight"><pre><span></span><span class="k">sub</span> <span class="nf">new</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span> <span class="nv">$Type</span><span class="p">,</span> <span class="nv">%Param</span> <span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="c1"># allocate new hash for object</span>
    <span class="k">my</span> <span class="nv">$Self</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="nb">bless</span><span class="p">(</span> <span class="nv">$Self</span><span class="p">,</span> <span class="nv">$Type</span> <span class="p">);</span>

    <span class="c1"># set field behaviors</span>
    <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">Behaviors</span><span class="p">}</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;IsACLReducible&#39;</span>               <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s">&#39;IsNotificationEventCondition&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s">&#39;IsSortable&#39;</span>                   <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s">&#39;IsFiltrable&#39;</span>                  <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s">&#39;IsStatsCondition&#39;</span>             <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s">&#39;IsCustomerInterfaceCapable&#39;</span>   <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">};</span>

    <span class="c1"># get the Dynamic Field Backend custom extensions</span>
    <span class="k">my</span> <span class="nv">$DynamicFieldDriverExtensions</span>
        <span class="o">=</span> <span class="nv">$</span><span class="nn">Kernel::</span><span class="nv">OM</span><span class="o">-&gt;</span><span class="n">Get</span><span class="p">(</span><span class="s">&#39;Kernel::Config&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">Get</span><span class="p">(</span><span class="s">&#39;DynamicFields::Extension::Driver::Password&#39;</span><span class="p">);</span>

    <span class="n">EXTENSION:</span>
    <span class="k">for</span> <span class="k">my</span> <span class="nv">$ExtensionKey</span> <span class="p">(</span> <span class="nb">sort</span> <span class="nb">keys</span> <span class="nv">%</span><span class="p">{</span><span class="nv">$DynamicFieldDriverExtensions</span><span class="p">}</span> <span class="p">)</span> <span class="p">{</span>

        <span class="c1"># skip invalid extensions</span>
        <span class="k">next</span> <span class="n">EXTENSION</span> <span class="k">if</span> <span class="o">!</span><span class="n">IsHashRefWithData</span><span class="p">(</span> <span class="nv">$DynamicFieldDriverExtensions</span><span class="o">-&gt;</span><span class="p">{</span><span class="nv">$ExtensionKey</span><span class="p">}</span> <span class="p">);</span>

        <span class="c1"># create a extension config shortcut</span>
        <span class="k">my</span> <span class="nv">$Extension</span> <span class="o">=</span> <span class="nv">$DynamicFieldDriverExtensions</span><span class="o">-&gt;</span><span class="p">{</span><span class="nv">$ExtensionKey</span><span class="p">};</span>

        <span class="c1"># check if extension has a new module</span>
        <span class="k">if</span> <span class="p">(</span> <span class="nv">$Extension</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">Module</span><span class="p">}</span> <span class="p">)</span> <span class="p">{</span>

            <span class="c1"># check if module can be loaded</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="o">!</span><span class="nv">$</span><span class="nn">Kernel::</span><span class="nv">OM</span><span class="o">-&gt;</span><span class="n">Get</span><span class="p">(</span><span class="s">&#39;Kernel::System::Main&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">RequireBaseClass</span><span class="p">(</span> <span class="nv">$Extension</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">Module</span><span class="p">}</span> <span class="p">)</span>
                <span class="p">)</span>
            <span class="p">{</span>
                <span class="nb">die</span> <span class="s">&quot;Can&#39;t load dynamic fields backend module&quot;</span>
                    <span class="o">.</span> <span class="s">&quot; $Extension-&gt;{Module}! $@&quot;</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1"># check if extension contains more behaviors</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">IsHashRefWithData</span><span class="p">(</span> <span class="nv">$Extension</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">Behaviors</span><span class="p">}</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>

            <span class="nv">%</span><span class="p">{</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">Behaviors</span><span class="p">}</span> <span class="p">}</span> <span class="o">=</span> <span class="p">(</span>
                <span class="nv">%</span><span class="p">{</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">Behaviors</span><span class="p">}</span> <span class="p">},</span>
                <span class="nv">%</span><span class="p">{</span> <span class="nv">$Extension</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">Behaviors</span><span class="p">}</span> <span class="p">}</span>
            <span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">$Self</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>构造函数 <code class="docutils literal notranslate"><span class="pre">new</span></code> 创建了一个新的类实例。 根据编码指南，必须在 <code class="docutils literal notranslate"><span class="pre">new</span></code> 中创建此模块中所需的其它类的对象。</p>
<p>正确定义行为非常重要，因为在某些屏幕中可能会或可能不会使用该字段，可能不需要实现依赖于对该特定字段不活动的行为的函数。</p>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">驱动程序仅由 <code class="docutils literal notranslate"><span class="pre">BackendObject</span></code> 创建，而不是直接从任何其它模块创建。</p>
</div>
<div class="highlight-Perl notranslate"><div class="highlight"><pre><span></span><span class="k">sub</span> <span class="nf">EditFieldRender</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span> <span class="nv">$Self</span><span class="p">,</span> <span class="nv">%Param</span> <span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="c1"># take config from field config</span>
    <span class="k">my</span> <span class="nv">$FieldConfig</span> <span class="o">=</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">DynamicFieldConfig</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">Config</span><span class="p">};</span>
    <span class="k">my</span> <span class="nv">$FieldName</span>   <span class="o">=</span> <span class="s">&#39;DynamicField_&#39;</span> <span class="o">.</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">DynamicFieldConfig</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">Name</span><span class="p">};</span>
    <span class="k">my</span> <span class="nv">$FieldLabel</span>  <span class="o">=</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">DynamicFieldConfig</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">Label</span><span class="p">};</span>

    <span class="k">my</span> <span class="nv">$Value</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">;</span>

    <span class="c1"># set the field value or default</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">UseDefaultValue</span><span class="p">}</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nv">$Value</span> <span class="o">=</span> <span class="p">(</span> <span class="nb">defined</span> <span class="nv">$FieldConfig</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">DefaultValue</span><span class="p">}</span> <span class="p">?</span> <span class="nv">$FieldConfig</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">DefaultValue</span><span class="p">}</span> <span class="p">:</span> <span class="s">&#39;&#39;</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="nv">$Value</span> <span class="o">=</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">Value</span><span class="p">}</span> <span class="k">if</span> <span class="nb">defined</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">Value</span><span class="p">};</span>

    <span class="c1"># extract the dynamic field value from the web request</span>
    <span class="k">my</span> <span class="nv">$FieldValue</span> <span class="o">=</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="n">EditFieldValueGet</span><span class="p">(</span>
        <span class="nv">%Param</span><span class="p">,</span>
    <span class="p">);</span>

    <span class="c1"># set values from ParamObject if present</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nb">defined</span> <span class="nv">$FieldValue</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nv">$Value</span> <span class="o">=</span> <span class="nv">$FieldValue</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1"># check and set class if necessary</span>
    <span class="k">my</span> <span class="nv">$FieldClass</span> <span class="o">=</span> <span class="s">&#39;DynamicFieldText W50pc&#39;</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nb">defined</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">Class</span><span class="p">}</span> <span class="o">&amp;&amp;</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">Class</span><span class="p">}</span> <span class="ow">ne</span> <span class="s">&#39;&#39;</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nv">$FieldClass</span> <span class="o">.=</span> <span class="s">&#39; &#39;</span> <span class="o">.</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">Class</span><span class="p">};</span>
    <span class="p">}</span>

    <span class="c1"># set field as mandatory</span>
    <span class="nv">$FieldClass</span> <span class="o">.=</span> <span class="s">&#39; Validate_Required&#39;</span> <span class="k">if</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">Mandatory</span><span class="p">};</span>

    <span class="c1"># set error css class</span>
    <span class="nv">$FieldClass</span> <span class="o">.=</span> <span class="s">&#39; ServerError&#39;</span> <span class="k">if</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">ServerError</span><span class="p">};</span>

    <span class="k">my</span> <span class="nv">$HTMLString</span> <span class="o">=</span> <span class="s">&lt;&lt;&quot;</span><span class="dl">EOF</span><span class="s">&quot;;</span>
<span class="s">&lt;input type=&quot;password&quot; class=&quot;$FieldClass&quot; id=&quot;$FieldName&quot; name=&quot;$FieldName&quot; title=&quot;$FieldLabel&quot; value=&quot;$Value&quot; /&gt;</span>
<span class="dl">EOF</span>

    <span class="k">if</span> <span class="p">(</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">Mandatory</span><span class="p">}</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">my</span> <span class="nv">$DivID</span> <span class="o">=</span> <span class="nv">$FieldName</span> <span class="o">.</span> <span class="s">&#39;Error&#39;</span><span class="p">;</span>

        <span class="c1"># for client side validation</span>
        <span class="nv">$HTMLString</span> <span class="o">.=</span> <span class="s">&lt;&lt;&quot;</span><span class="dl">EOF</span><span class="s">&quot;;</span>
<span class="s">    &lt;div id=&quot;$DivID&quot; class=&quot;TooltipErrorMessage&quot;&gt;</span>
<span class="s">        &lt;p&gt;</span>
<span class="s">            \$Text{&quot;This field is required.&quot;}</span>
<span class="s">        &lt;/p&gt;</span>
<span class="s">    &lt;/div&gt;</span>
<span class="dl">EOF</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">ServerError</span><span class="p">}</span> <span class="p">)</span> <span class="p">{</span>

        <span class="k">my</span> <span class="nv">$ErrorMessage</span> <span class="o">=</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">ErrorMessage</span><span class="p">}</span> <span class="o">||</span> <span class="s">&#39;This field is required.&#39;</span><span class="p">;</span>
        <span class="k">my</span> <span class="nv">$DivID</span> <span class="o">=</span> <span class="nv">$FieldName</span> <span class="o">.</span> <span class="s">&#39;ServerError&#39;</span><span class="p">;</span>

        <span class="c1"># for server side validation</span>
        <span class="nv">$HTMLString</span> <span class="o">.=</span> <span class="s">&lt;&lt;&quot;</span><span class="dl">EOF</span><span class="s">&quot;;</span>
<span class="s">    &lt;div id=&quot;$DivID&quot; class=&quot;TooltipErrorMessage&quot;&gt;</span>
<span class="s">        &lt;p&gt;</span>
<span class="s">            \$Text{&quot;$ErrorMessage&quot;}</span>
<span class="s">        &lt;/p&gt;</span>
<span class="s">    &lt;/div&gt;</span>
<span class="dl">EOF</span>
    <span class="p">}</span>

    <span class="c1"># call EditLabelRender on the common Driver</span>
    <span class="k">my</span> <span class="nv">$LabelString</span> <span class="o">=</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="n">EditLabelRender</span><span class="p">(</span>
        <span class="nv">%Param</span><span class="p">,</span>
        <span class="n">DynamicFieldConfig</span> <span class="o">=&gt;</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">DynamicFieldConfig</span><span class="p">},</span>
        <span class="n">Mandatory</span>          <span class="o">=&gt;</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">Mandatory</span><span class="p">}</span> <span class="o">||</span> <span class="s">&#39;0&#39;</span><span class="p">,</span>
        <span class="n">FieldName</span>          <span class="o">=&gt;</span> <span class="nv">$FieldName</span><span class="p">,</span>
    <span class="p">);</span>

    <span class="k">my</span> <span class="nv">$Data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">Field</span> <span class="o">=&gt;</span> <span class="nv">$HTMLString</span><span class="p">,</span>
        <span class="n">Label</span> <span class="o">=&gt;</span> <span class="nv">$LabelString</span><span class="p">,</span>
    <span class="p">};</span>

    <span class="k">return</span> <span class="nv">$Data</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>此函数负责创建字段及其标签的HTML呈现，并在编辑屏幕（如 <code class="docutils literal notranslate"><span class="pre">AgentTicketPhone</span></code>、<code class="docutils literal notranslate"><span class="pre">AgentTicketNote</span></code> 等）中使用。</p>
<div class="highlight-Perl notranslate"><div class="highlight"><pre><span></span><span class="k">sub</span> <span class="nf">DisplayValueRender</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span> <span class="nv">$Self</span><span class="p">,</span> <span class="nv">%Param</span> <span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="c1"># set HTMLOutput as default if not specified</span>
    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nb">defined</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">HTMLOutput</span><span class="p">}</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nv">$Param</span><span class="p">{</span><span class="n">HTMLOutput</span><span class="p">}</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">my</span> <span class="nv">$Value</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$Title</span><span class="p">;</span>

    <span class="c1"># check if field is set to show password or not</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="nb">defined</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">DynamicFieldConfig</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">Config</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">ShowValue</span><span class="p">}</span>
        <span class="o">&amp;&amp;</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">DynamicFieldConfig</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">Config</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">ShowValue</span><span class="p">}</span> <span class="ow">eq</span> <span class="s">&#39;Yes&#39;</span>
        <span class="p">)</span>
    <span class="p">{</span>

        <span class="c1"># get raw Title and Value strings from field value</span>
        <span class="nv">$Value</span> <span class="o">=</span> <span class="nb">defined</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">Value</span><span class="p">}</span> <span class="p">?</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">Value</span><span class="p">}</span> <span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">;</span>
        <span class="nv">$Title</span> <span class="o">=</span> <span class="nv">$Value</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>

        <span class="c1"># show the mask and not the value</span>
        <span class="nv">$Value</span> <span class="o">=</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">DynamicFieldConfig</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">Config</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">ValueMask</span><span class="p">}</span> <span class="o">||</span> <span class="s">&#39;&#39;</span><span class="p">;</span>
        <span class="nv">$Title</span> <span class="o">=</span> <span class="s">&#39;The value of this field is hidden.&#39;</span>
    <span class="p">}</span>

    <span class="c1"># HTMLOutput transformations</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">HTMLOutput</span><span class="p">}</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nv">$Value</span> <span class="o">=</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">LayoutObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">Ascii2Html</span><span class="p">(</span>
            <span class="n">Text</span> <span class="o">=&gt;</span> <span class="nv">$Value</span><span class="p">,</span>
            <span class="n">Max</span> <span class="o">=&gt;</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">ValueMaxChars</span><span class="p">}</span> <span class="o">||</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
        <span class="p">);</span>

        <span class="nv">$Title</span> <span class="o">=</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">LayoutObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">Ascii2Html</span><span class="p">(</span>
            <span class="n">Text</span> <span class="o">=&gt;</span> <span class="nv">$Title</span><span class="p">,</span>
            <span class="n">Max</span> <span class="o">=&gt;</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">TitleMaxChars</span><span class="p">}</span> <span class="o">||</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
        <span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">ValueMaxChars</span><span class="p">}</span> <span class="o">&amp;&amp;</span> <span class="nb">length</span><span class="p">(</span><span class="nv">$Value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">ValueMaxChars</span><span class="p">}</span> <span class="p">)</span> <span class="p">{</span>
            <span class="nv">$Value</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span> <span class="nv">$Value</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">ValueMaxChars</span><span class="p">}</span> <span class="p">)</span> <span class="o">.</span> <span class="s">&#39;...&#39;</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">TitleMaxChars</span><span class="p">}</span> <span class="o">&amp;&amp;</span> <span class="nb">length</span><span class="p">(</span><span class="nv">$Title</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">TitleMaxChars</span><span class="p">}</span> <span class="p">)</span> <span class="p">{</span>
            <span class="nv">$Title</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span> <span class="nv">$Title</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">TitleMaxChars</span><span class="p">}</span> <span class="p">)</span> <span class="o">.</span> <span class="s">&#39;...&#39;</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1"># create return structure</span>
    <span class="k">my</span> <span class="nv">$Data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">Value</span> <span class="o">=&gt;</span> <span class="nv">$Value</span><span class="p">,</span>
        <span class="n">Title</span> <span class="o">=&gt;</span> <span class="nv">$Title</span><span class="p">,</span>
    <span class="p">};</span>

    <span class="k">return</span> <span class="nv">$Data</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">DisplayValueRender()</span></code> 函数返回字段值作为纯文本及其标题（两者都可以翻译）。 对于此特定示例，我们检查是否应显示密码或通过动态字段中的配置参数显示预定义的掩码。</p>
<div class="highlight-Perl notranslate"><div class="highlight"><pre><span></span><span class="k">sub</span> <span class="nf">ReadableValueRender</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span> <span class="nv">$Self</span><span class="p">,</span> <span class="nv">%Param</span> <span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="k">my</span> <span class="nv">$Value</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$Title</span><span class="p">;</span>

    <span class="c1"># check if field is set to show password or not</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="nb">defined</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">DynamicFieldConfig</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">Config</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">ShowValue</span><span class="p">}</span>
        <span class="o">&amp;&amp;</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">DynamicFieldConfig</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">Config</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">ShowValue</span><span class="p">}</span> <span class="ow">eq</span> <span class="s">&#39;Yes&#39;</span>
        <span class="p">)</span>
    <span class="p">{</span>

        <span class="c1"># get raw Title and Value strings from field value</span>
        <span class="nv">$Value</span> <span class="o">=</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">Value</span><span class="p">}</span> <span class="sr">//</span> <span class="s">&#39;&#39;</span><span class="p">;</span>
        <span class="nv">$Title</span> <span class="o">=</span> <span class="nv">$Value</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>

        <span class="c1"># show the mask and not the value</span>
        <span class="nv">$Value</span> <span class="o">=</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">DynamicFieldConfig</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">Config</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">ValueMask</span><span class="p">}</span> <span class="o">||</span> <span class="s">&#39;&#39;</span><span class="p">;</span>
        <span class="nv">$Title</span> <span class="o">=</span> <span class="s">&#39;The value of this field is hidden.&#39;</span>
    <span class="p">}</span>

    <span class="c1"># cut strings if needed</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">ValueMaxChars</span><span class="p">}</span> <span class="o">&amp;&amp;</span> <span class="nb">length</span><span class="p">(</span><span class="nv">$Value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">ValueMaxChars</span><span class="p">}</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nv">$Value</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span> <span class="nv">$Value</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">ValueMaxChars</span><span class="p">}</span> <span class="p">)</span> <span class="o">.</span> <span class="s">&#39;...&#39;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">TitleMaxChars</span><span class="p">}</span> <span class="o">&amp;&amp;</span> <span class="nb">length</span><span class="p">(</span><span class="nv">$Title</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">TitleMaxChars</span><span class="p">}</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nv">$Title</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span> <span class="nv">$Title</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">TitleMaxChars</span><span class="p">}</span> <span class="p">)</span> <span class="o">.</span> <span class="s">&#39;...&#39;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1"># create return structure</span>
    <span class="k">my</span> <span class="nv">$Data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">Value</span> <span class="o">=&gt;</span> <span class="nv">$Value</span><span class="p">,</span>
        <span class="n">Title</span> <span class="o">=&gt;</span> <span class="nv">$Title</span><span class="p">,</span>
    <span class="p">};</span>

    <span class="k">return</span> <span class="nv">$Data</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>此函数类似于 <code class="docutils literal notranslate"><span class="pre">DisplayValueRender()</span></code> 但是用于没有 <code class="docutils literal notranslate"><span class="pre">LayoutObject</span></code> 的地方。</p>
</div>
<div class="section" id="other-functions">
<h3>其它函数<a class="headerlink" href="#other-functions" title="永久链接至标题">¶</a></h3>
<p>The following are other functions that are might needed if the new dynamic field does not inherit from other classes. To see the complete code of this functions please take a look directly into the files <code class="docutils literal notranslate"><span class="pre">Kernel/System/DynamicField/Driver/Base.pm</span></code> and <code class="docutils literal notranslate"><span class="pre">Kernel/System/DynamicField/Driver/BaseText.pm</span></code>.</p>
<div class="highlight-Perl notranslate"><div class="highlight"><pre><span></span><span class="k">sub</span> <span class="nf">ValueGet</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</pre></div>
</div>
<p>此函数从指定对象上的字段中检索值。 在这种情况下，我们返回第一个文本值，因为该字段仅存储一个文本值。</p>
<div class="highlight-Perl notranslate"><div class="highlight"><pre><span></span><span class="k">sub</span> <span class="nf">ValueSet</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</pre></div>
</div>
<p>此函数用于存储动态字段值。 在这种情况下，该字段仅存储一个文本类型值。 其它字段可以用 <code class="docutils literal notranslate"><span class="pre">ValueText</span></code>、<code class="docutils literal notranslate"><span class="pre">ValueDateTime</span></code> 或 <code class="docutils literal notranslate"><span class="pre">ValueInt</span></code> 格式存储多个值。</p>
<div class="highlight-Perl notranslate"><div class="highlight"><pre><span></span><span class="k">sub</span> <span class="nf">ValueDelete</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</pre></div>
</div>
<p>此函数用于删除附加到特定对象ID的一个字段值。 例如，如果要删除对象的实例，则没有理由将该字段值存储在该特定对象实例的数据库中。</p>
<div class="highlight-Perl notranslate"><div class="highlight"><pre><span></span><span class="k">sub</span> <span class="nf">AllValuesDelete</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</pre></div>
</div>
<p>此函数用于删除某个动态字段中的所有值。 要删除动态字段时，此功能非常有用。</p>
<div class="highlight-Perl notranslate"><div class="highlight"><pre><span></span><span class="k">sub</span> <span class="nf">ValueValidate</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</pre></div>
</div>
<p>此函数用于检查值是否与其类型一致。</p>
<div class="highlight-Perl notranslate"><div class="highlight"><pre><span></span><span class="k">sub</span> <span class="nf">SearchSQLGet</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">TicketSearch</span></code> 核心模块使用此函数构建内部查询，以基于此字段作为搜索参数搜索工单。</p>
<div class="highlight-Perl notranslate"><div class="highlight"><pre><span></span><span class="k">sub</span> <span class="nf">SearchSQLOrderFieldGet</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</pre></div>
</div>
<p>此函数也是 <code class="docutils literal notranslate"><span class="pre">TicketSearch</span></code> 模块的一个helper。 <code class="docutils literal notranslate"><span class="pre">$Param{TableAlias}</span></code> 应该保留，<code class="docutils literal notranslate"><span class="pre">value_text</span></code> 可以用 <code class="docutils literal notranslate"><span class="pre">value_date</span></code> 或 <code class="docutils literal notranslate"><span class="pre">value_int</span></code> 替换，具体取决于字段。</p>
<div class="highlight-Perl notranslate"><div class="highlight"><pre><span></span><span class="k">sub</span> <span class="nf">EditFieldValueGet</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</pre></div>
</div>
<p>此函数用于OTRS的编辑屏幕，其目的是从自动任务配置文件或Web请求等模板获取字段的值。 此函数在 <code class="docutils literal notranslate"><span class="pre">$Param{ParamObject}</span></code> 中获取Web请求，它是前端模块或屏幕的 <code class="docutils literal notranslate"><span class="pre">ParamObject</span></code> 的副本。</p>
<p>此函数有两种返回格式。 通常只是 字段名称=&gt;字段值 对的原始值或结构。 例如，日期动态字段通常将日期作为字符串返回，如果它应返回结构，则它会为散列中的日期的每个部分返回一对。</p>
<p>如果结果应该是结构，那么通常这用于将其值存储在模板中，如自动任务配置文件。 例如，日期字段使用多个HTML组件来构建字段，如使用的复选框，并选择年、月、日等。</p>
<div class="highlight-Perl notranslate"><div class="highlight"><pre><span></span><span class="k">sub</span> <span class="nf">EditFieldValueValidate</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</pre></div>
</div>
<p>此函数应至少提供一种方法来验证字段是否为空，如果字段为空且是必需的，则返回错误，但它也可以对其它类型的字段执行更多验证，例如，如果选择的选项有效，或者日期是否应仅在过去等。它也可以提供自定义错误消息。</p>
<div class="highlight-Perl notranslate"><div class="highlight"><pre><span></span><span class="k">sub</span> <span class="nf">SearchFieldRender</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</pre></div>
</div>
<p>工单搜索对话框使用此函数，它类似于 <code class="docutils literal notranslate"><span class="pre">EditFieldRander()</span></code>，但通常在搜索屏幕上，必须对所有字段进行小的更改。 对于此示例，我们使用HTML文本输入而不是密码输入。 在其它字段中，下拉字段显示为多选，以便让用户一次搜索多个值。</p>
<div class="highlight-Perl notranslate"><div class="highlight"><pre><span></span><span class="k">sub</span> <span class="nf">SearchFieldValueGet</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</pre></div>
</div>
<p>非常类似于 <code class="docutils literal notranslate"><span class="pre">EditFieldValueGet()</span></code>，但使用了不同的名称前缀，适用于搜索对话框屏幕。</p>
<div class="highlight-Perl notranslate"><div class="highlight"><pre><span></span><span class="k">sub</span> <span class="nf">SearchFieldParameterBuild</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</pre></div>
</div>
<p>工单搜索对话框也使用此函数来设置正确的运算符和值，以便在此字段上进行搜索。 它还返回值应在结果页面中使用的搜索属性中显示的方式。</p>
<div class="highlight-Perl notranslate"><div class="highlight"><pre><span></span><span class="k">sub</span> <span class="nf">StatsFieldParameterBuild</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</pre></div>
</div>
<p>统计模块使用此函数。 它包括统计信息格式的字段定义。 对于具有固定值的字段，它还包括所有这些可能的值，如果它们可以被转换，请查看 <code class="docutils literal notranslate"><span class="pre">BaseSelect</span></code> 驱动程序代码，以获取如何实现它们的示例。</p>
<div class="highlight-Perl notranslate"><div class="highlight"><pre><span></span><span class="k">sub</span> <span class="nf">StatsSearchFieldParameterBuild</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</pre></div>
</div>
<p>这个函数非常类似于 <code class="docutils literal notranslate"><span class="pre">SearchFieldParameterBuild()</span></code>。 不同之处在于后者从搜索配置文件中获取值，并且此值直接从其参数中获取值。</p>
<p>此函数用于统计模块。</p>
<div class="highlight-Perl notranslate"><div class="highlight"><pre><span></span><span class="k">sub</span> <span class="nf">TemplateValueTypeGet</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</pre></div>
</div>
<p>此函数用于了解如何检索存储在配置文件中的动态字段值，如标量或数组，还可以定义配置文件中字段的正确名称。</p>
<div class="highlight-Perl notranslate"><div class="highlight"><pre><span></span><span class="k">sub</span> <span class="nf">RandomValueSet</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">otrs.FillDB.pl</span></code> 脚本使用此函数用一些测试和随机数据填充数据库。 此函数插入的值并不真实相关。 唯一的限制是该值必须与字段值类型兼容。</p>
<div class="highlight-Perl notranslate"><div class="highlight"><pre><span></span><span class="k">sub</span> <span class="nf">ObjectMatch</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</pre></div>
</div>
<p>由通知模块使用。 如果字段出现在 <code class="docutils literal notranslate"><span class="pre">$Param{ObjectAttributes}</span></code> 参数中并且它与给定值匹配，则此函数返回1。</p>
</div>
</div>
</div>


           </div>
           
          </div>
          

<script>
// Start Google Analytics Tracking
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-28118796-2', 'auto');
ga('send', 'pageview');
// End Google Analytics Tracking
</script>

<footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="dynamic-fields-extend.html" class="btn btn-neutral float-right" title="创建一个动态字段功能扩展" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="dynamic-fields-extend-options.html" class="btn btn-neutral" title="如何扩展动态字段" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2001-2020 OTRS AG, https://otrs.com/

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../../_static/translations.js"></script>
    

  

  <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>