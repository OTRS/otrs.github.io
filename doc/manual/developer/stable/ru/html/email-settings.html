<html><head>
<!-- otrs.github.io -->
<link href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="../../../../../documentation.css">
<script src="https://code.jquery.com/jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="../../../../../documentation.js"></script>
<!-- otrs.github.io -->
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Настройки электронной почты</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="OTRS 3.3 - Admin Manual"><link rel="up" href="administration.html" title="Глава 4. Администрирование"><link rel="prev" href="backup-and-restore.html" title="Резервное копирование системы"><link rel="next" href="external-backends.html" title="Использование внешних хранилищ данных"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Настройки электронной почты</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="backup-and-restore.html">Пред.</a> </td><th width="60%" align="center">Глава 4. Администрирование</th><td width="20%" align="right"> <a accesskey="n" href="external-backends.html">След.</a></td></tr></table><hr></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a name="email-settings"></a>Настройки электронной почты</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="email-settings.html#email">Отправка / получение электронной почты</a></span></dt><dd><dl><dt><span class="section"><a href="email-settings.html#email-sending">Отправка почты</a></span></dt><dd><dl><dt><span class="section"><a href="email-settings.html#email-sending-sendmail">через Sendmail (по умолчанию)</a></span></dt><dt><span class="section"><a href="email-settings.html#email-sending-smtp">Через SMTP-сервер или smarthost</a></span></dt></dl></dd><dt><span class="section"><a href="email-settings.html#email-receiving">Получение сообщений электронной почты</a></span></dt><dd><dl><dt><span class="section"><a href="email-settings.html#email-receiving-pop3">Учетные записи электронной почты настраиваемые через графический
пользовательский интерфейс OTRS</a></span></dt><dt><span class="section"><a href="email-settings.html#email-receiving-cmd">Через командную строку программы и например, procmail (otrs.PostMaster.pl)</a></span></dt><dt><span class="section"><a href="email-settings.html#email-receiving-fetchmail">Получение электронной почты по протоколу POP3 или IMAP и обработка для
otrs.PostMaster.pl</a></span></dt><dt><span class="section"><a href="email-settings.html#email-receiving-filter">Фильтрация/рассылка модулями OTRS/PostMaster (для более сложной
диспетчеризации)</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="email-settings.html#configure-pgp">Безопасность электронной почты с PGP</a></span></dt><dt><span class="section"><a href="email-settings.html#smime">Безопасность электронной почты с S/MIME</a></span></dt></dl></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="email"></a>Отправка / получение электронной почты</h3></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="email-sending"></a>Отправка почты</h4></div></div></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="email-sending-sendmail"></a>через Sendmail (по умолчанию)</h5></div></div></div><p>
OTRS может отправлять сообщения электронной почты через <a class="ulink" href="http://www.sendmail.org/" target="_top">Sendmail</a>, <a class="ulink" href="http://www.postfix.org/" target="_top">Postfix</a>, <a class="ulink" href="http://www.qmail.org" target="_top">Qmail</a> or <a class="ulink" href="http://www.exim.org" target="_top">Exim</a>). По умолчанию используется Sendmail,
он должен работать при установки системы "из коробки".
</p><p>
Параметры sendmail можно настроить через графический веб-интерфейс для
конфигурации (Framework::Core::Sendmail)
</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="email-sending-smtp"></a>Через SMTP-сервер или smarthost</h5></div></div></div><p>
OTRS может отсылать сообщения электронной почты через SMTP ( <a class="ulink" href="http://www.ietf.org/rfc/rfc821.txt" target="_top">Simple Mail Transfer Protocol / RFC
821</a>) или Secure SMTP. Возможно вы захотите использовать эту опцию на
не-unix-системах (например на Windows).
</p><p>
Параметры настройки SMTP-сервера могут быть сконфигурированны через
SysConfig (Framework::Core::Sendmail). Если у вас нету SMTPS в качестве
опции, значит вы пропустили установку соответствующих Perl-модулей. В таком
случае, обратитесь пожалуйста к этой <a class="link" href="manual-installation-of-otrs.html#installation-of-perl-modules" title="Установка Perl-модулей">"Установка Perl-модулей необходимых
для работы OTRS"</a> инструкции.
</p></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="email-receiving"></a>Получение сообщений электронной почты</h4></div></div></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="email-receiving-pop3"></a>Учетные записи электронной почты настраиваемые через графический
пользовательский интерфейс OTRS</h5></div></div></div><p>
OTRS позволяет получать сообщения электронной почты через почтовые аккаунты
POP3, POP3S, IMAP, и IMAPS.
</p><p>
Для настройки почтовых аккаунтов воспользуйтесь ссылкой "Почтовые Аккаунты
PostMaster" на странице администрирования.
</p><p>
If a new mail account is to be created (see Figure below), then its mail
server name, login name and password must be specified. Also, you need to
select the mail server type, which can be POP3, POP3S, IMAP or IMAPS. If you
don't see your server type available as an option, the required Perl modules
are missing on your system. In that case, please refer to <a class="link" href="manual-installation-of-otrs.html#installation-of-perl-modules" title="Установка Perl-модулей"> "Installation of Perl modules
required for OTRS"</a> for instructions.</p><p>
</p><div class="screenshot"><div><img src="screenshots/add-mailaccount.png"></div></div><p>
</p><p>
<span class="emphasis"><em>Рисунок Добавление учетной записи электронной почты.</em></span>
</p><p>Если для опции "Trusted" выбрано значение "Да", будут оцениваться и
выполнятся любые X-OTRS-заголовки, присоединенные к входящему
сообщению. Поскольку X-OTRS-заголовок может выполнять некоторые действия в
системе обработки заявок, то для извесных отправителей опцию Trusted нужно
установить только в значение Да. X-OTRS-заголовки используюся в OTRS <a class="link" href="administration.html#adminarea-postmasterfilter" title="Filtering incoming email messages"> модулем фильтрации </a>. Более
подробно X-OTRS заголовки рассматриваются в <a class="link" href="administration.html#table-of-x-otrs-headers" title="Таблица 4.5. Функции различных X-OTRS-заголовков">этой таблице</a>. Любые созданные и
выполненные правила фильтрации независимы от параметров настроки Trusted.
</p><p>
Можно контролировать распределением входящих сообщений, если они должны
сортироватся по очередях или содержимому поля "Кому". Если для
Диспетчеризации выбрана опция "Диспетчеризация по выбранной очереди", то все
входящие сообщения будут отсортированы в указанной очереди. В таком случае
адресс, с которого отправили сообщение не учитывается. Если для
диспетчеризации выбрана опция "Диспетчеризация емейлов по полю Кому",
система для входящих емейлов проверяет, связана ли эта очередь с адресом
электронной почты в поле Кому. Перейдя по ссылке <a class="link" href="administration.html#adminarea-emailaddresses" title="Адреса электронной почты">Управление E-mail-адресами</a> в
Панели Администрирования, можно связать определенный адресс с очередью. Если
не найдено никакой связи между адресом в поле "Кому" то сообщение будет
сохранятся в системе в "Raw" очереди, которая есть <a class="link" href="ConfigReference_Ticket.html#Ticket:Core::PostMaster:PostmasterDefaultQueue" title="PostmasterDefaultQueue">
PostmasterDefaultQueue </a> по умолчанию после установки системы.
</p><p>
Все данные для учетных записей электронной почты сохраняются в базе данных
OTRS. Скрипт <code class="filename">otrs.PostMasterMailbox.pl</code>, который
находится в директории <code class="filename">bin</code> вашей системы OTRS,
использует настройки в базе данных и получает почту. Вы можете выполнить
файл <code class="filename">./bin/otrs.PostMasterMailbox.pl</code> вручную чтобы
проверить что все ваши настройки почты работают правильно.
</p><p>
Для обычной установки, с помощью файла заданий cron job
<code class="filename">postmaster_mailbox</code> выборка емейлов будет выполнятся
каждые 10 минут. Для получения дополнительной информации об изменении
заданий планировщика задач cron jobs, обратитесь к главе <a class="link" href="manual-installation-of-otrs.html#cronjobs" title="Настрой планировщика задач (cron jobs) для OTRS">"Настройка пралировщика задач cron jobs для OTRS"</a>.
</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Примечание</h3><p>
При получении почты OTRS удаляет почту с POP или IMAP сервера. Нету такой
опции,  которая бы позволяла хранить копию сообщения на сервере. Если вы все
же хотите чтобы такая возможность присутствовала, скорей всего нужно
воспользоваться правилами переадресации на почтовый сервер. Оратитесь
пожалуйста к документации по вашему почтовому серверу.
</p></div></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="email-receiving-cmd"></a>Через командную строку программы и например, procmail (otrs.PostMaster.pl)</h5></div></div></div><p>
Если для получения электронной почты в OTRS нету возможности использовать
учетные записи, то эту проблему можно решить с помощью программы командной
строки <code class="filename">bin/otrs.PostMaster.pl</code>Она принимает сообщения
электронной почты через STDIN и направляет их непосредственно в OTRS. Это
значит что емейлы будут доступны в OTRS когда MDA (Mail Delivery Agent -
Агент доставки почты) выполняет эту программу.
</p><p>
Для тестирования <code class="filename">bin/otrs.PostMaster.pl</code> без MDA,
выполните команду приведенную в листинге нижеприведенного сценария.
</p><p>
</p><pre class="screen">
linux:/opt/otrs# cd bin
linux:/opt/otrs/bin# cat ../doc/sample_mails/test-email-1.box | ./otrs.PostMaster.pl
linux:/opt/otrs/bin#
</pre><p>
</p><p>
<span class="emphasis"><em>Сценарий: Тестирование PostMaster без MDA.</em></span>
</p><p>
Если сообщения электронной почты отображаются в QueueView, значит вашы
настройки работают.
</p><p>
Procmail - это очень распостраненный фильтр электронной почты в среде
Linux.  Он устанавливается на большинстве систем. Если нет, перейдите по
ссылке <a class="ulink" href="http://www.procmail.org/" target="_top"><em class="citetitle">procmail
homepage</em></a>.
</p><p>
Для настройки procmail для OTRS (требуется сконфигурированный транспортный
агент MTA, например sendmail, postfix, exim or qmail), используйте файл
<code class="filename">~otrs/.procmailrc.dist</code>, скопируйте его в
<code class="filename">.procmailrc</code> а затем добавьте строки из нижеприведенного
сценария.
</p><p>
</p><pre class="programlisting">
SYS_HOME=$HOME
PATH=/bin:/usr/bin:/usr/local/bin
# --
# Pipe all email into the PostMaster process.
# --
:0 :
| $SYS_HOME/bin/otrs.PostMaster.pl
</pre><p>
</p><p>
<span class="emphasis"><em>Сценарий: Настройка procmail для OTRS.</em></span>
</p><p>
Все емейлы отсылаемые локальному OTRS-пользователю будут обрабатываться
<code class="filename">bin/otrs.PostMaster.pl</code> и потом отображаться в
QueueView.
</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="email-receiving-fetchmail"></a>Получение электронной почты по протоколу POP3 или IMAP и обработка для
otrs.PostMaster.pl</h5></div></div></div><p>
Для того чтобы получить электронную почту с вашего почтового сервера через
POP3 или IMAP и сохранить ее на компьютере на котором установлен OTRS, для
локального аккаунта или в procmail, перейдите по ссылке <a class="ulink" href="http://fetchmail.berlios.de/" target="_top">fetchmail</a>.
</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Примечание</h3><p>
Работающий и сконфигурированный SMTP необходим для работы OTRS.
</p></div><p>
Можно использовать файл <code class="filename">.fetchmailrc.dist</code> в домашней
директории OTRS и скопировать его в
<code class="filename">.fetchmailrc</code>. Изменить его в соответствии с вашими
требованиями (см. ниже Пример 7-1).
</p><div class="example"><a name="fetchmailrc"></a><p class="title"><b>Пример 4.2. .fetchmailrc</b></p><div class="example-contents"><p>
</p><pre class="programlisting">
#poll (mailserver) protocol POP3 user (user) password (password) is (localuser)
poll mail.example.com protocol POP3 user joe password mama is otrs
</pre><p>
</p></div></div><br class="example-break"><p>
Не забудьте установить.fetchmailrc to 710 ("chmod 710 .fetchmailrc")!
</p><p>
Из Листинга 7-1 выше, <code class="filename">.fetchmailrc</code> , все емейлы будут
перенаправлены в локальный OTRS-аккаунт, если выполнена команда
<span class="command"><strong>fetchmail -a</strong></span>. Установите эту команду в планировщике задач
cronjob если хотите извлекать емейлы постоянно.
</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="email-receiving-filter"></a>Фильтрация/рассылка модулями OTRS/PostMaster (для более сложной
диспетчеризации)</h5></div></div></div><p>
Если вы используете метод bin/otrs.PostMaster.pl или
bin/otrs.PostMasterMailbox.pl, то с модулем фильтрации PostMaster можно
вставить или модифицировать X-OTRS заголовок. С помощью X-OTRS-заголовков,
система обработки заявок может вызывать некоторые действия для входящих
сообщений, сортировать их в определенные очереди, или, например, изменять
приоритет или ID-клиента. Более подробную информацию о X-OTRS-заголовках
можно найти в главе <a class="link" href="administration.html#adminarea-postmasterpop3-account" title="Использование почтовый ящиков">
добавление аккаунтов электронной почты </a> в Панели Администрирования.
</p><p>
Есть некоторые предустановленные модули фильтрации:
</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Примечание</h3><p>
Название задания (например
$Self-&gt;{'PostMaster::PreFilterModule'}-&gt;{'JobName'}) должно быть
уникальным!
</p></div><p>
Kernel::System::PostMaster::Filter::Match модуль по умолчанию для проверки
совпадения заголовков определенных емейлов (например "От", "Кому", "Тема",
...). Он может устанавливать новые заголовки email (например X-OTRS-Ignore:
да или X-OTRS-Queue: spam) если совпадают правила совпадения. Задания из
Примера 7-2 могут быть прописаны в <code class="filename">Kernel/Config.pm</code>
</p><div class="example"><a name="filter-module-match-example"></a><p class="title"><b>Пример 4.3. Пример задания для модуля фильтрации
Kernel::System::PostMaster::Filter::Match</b></p><div class="example-contents"><p>
</p><pre class="programlisting">
    # Job Name: 1-Match
    # (block/ignore all spam email with From: noreply@)
    $Self-&gt;{'PostMaster::PreFilterModule'}-&gt;{'1-Match'} = {
        Module =&gt; 'Kernel::System::PostMaster::Filter::Match',
        Match =&gt; {
            From =&gt; 'noreply@',
        },
        Set =&gt; {
            'X-OTRS-Ignore' =&gt; 'yes',
        },
    };
    # Job Name: 2-Match
    # (sort emails with From: sales@example.com and Subject: **ORDER**
    # into queue 'Order')
    $Self-&gt;{'PostMaster::PreFilterModule'}-&gt;{'2-Match'} = {
        Module =&gt; 'Kernel::System::PostMaster::Filter::Match',
        Match =&gt; {
            To =&gt; 'sales@example.com',
            Subject =&gt; '**ORDER**',
        },
        Set =&gt; {
            'X-OTRS-Queue' =&gt; 'Order',
        },
    };
</pre><p>
</p></div></div><br class="example-break"><p>
Kernel::System::PostMaster::Filter::CMD модуль по умолчанию для получения
емейлов для внешних команд. Вывод передается в STDOUT и если результат
истинна, то устанавливается новый заголовок (например X-OTRS-Ignore: да или
X-OTRS-Queue: spam). Пример 7-3 может быть использован в
<code class="filename">Kernel/Config.pm</code>
</p><div class="example"><a name="filter-module-cmd-example"></a><p class="title"><b>Пример 4.4. Пример задания для модуля фильтрации Kernel::System::PostMaster::Filter::CMD</b></p><div class="example-contents"><p>
</p><pre class="programlisting">
    # Job Name: 5-SpamAssassin
    # (SpamAssassin example setup, ignore spam emails)
    $Self-&gt;{'PostMaster::PreFilterModule'}-&gt;{'5-SpamAssassin'} = {
        Module =&gt; 'Kernel::System::PostMaster::Filter::CMD',
        CMD =&gt; '/usr/bin/spamassassin | grep -i "X-Spam-Status: yes"',
        Set =&gt; {
            'X-OTRS-Ignore' =&gt; 'yes',
        },
    };
</pre><p>
</p></div></div><br class="example-break"><p>
    Kernel::System::PostMaster::Filter::ExternalTicketNumberRecognition is a
default module that adds the possibility to parse external identifiers, in
the email subject, the body or both using regular expressions. It then
stores this value in a defined dynamic field. When an email comes in, OTRS
will first search for an external identifier and when it finds one, query
OTRS on the pre-defined dynamic field field. If it finds an existing ticket,
it will update this ticket, otherwise it will create a new ticket with the
external reference number in the separate field.
</p><p>
    OTRS SysConfig already provide 4 different settings to setup different
external ticket numbers.  If more settings are needed they need to need to
be added manually. The following example can be used in
<code class="filename">Kernel/Config.pm</code> to extend SysConfig settings.
</p><div class="example"><a name="filter-module-externalticketrecognition-example"></a><p class="title"><b>Пример 4.5. 
        Example job for the filter module
Kernel::System::PostMaster::Filter::ExternalTicketNumberRecognition
    </b></p><div class="example-contents"><pre class="programlisting">
    # Job Name: ExternalNumber
    # External Ticket Number Reconition, check for Incident-&lt;number&gt; in incoming mails subject and
    # body from the addeesses &lt;sender&gt;@externalticket.com, if number is found it will be stored in
    # the dynamic field 'ExternalNumber' (that need to be setup in the Admin Panel).
    $Self-&gt;{'PostMaster::PreFilterModule'}-&gt;{'000-ExternalTicketNumberRecognition5'} =  {
        'FromAddressRegExp' =&gt; '\\s*@externalticket.com',
        'NumberRegExp'      =&gt; 'Incident-(\\d.*)',
        'SearchInSubject'   =&gt; '1',
        'SearchInBody'      =&gt; '1',
        'TicketStateTypes'  =&gt; 'new;open'
        'DynamicFieldName'  =&gt; 'ExternalNumber',
        'Module'            =&gt; 'Kernel::System::PostMaster::Filter::ExternalTicketNumberRecognition',
        'Name'              =&gt; 'Test External Ticket Number',
        'SenderType'        =&gt; 'system',
    };
    </pre></div></div><br class="example-break"><div class="itemizedlist"><p><span class="emphasis"><em>Configuration Options</em></span></p><ul class="itemizedlist" type="round"><li class="listitem"><p>FromAddressRegExp</p><p>
            This is an optional setting. Only mails matching this "From:" address will
be considered for this filter. You can adjust this setting to the sender
address your external system uses for outgoing mails. In case this address
can differ, you can set this option to empty. OTRS will in that case not
check the sender address.
        </p></li><li class="listitem"><p>NumberRegExp</p><p>
            This is a mandatory setting. This setting contains the regular expression
OTRS will use to extract the ticket number out of the subject and/or ticket
body. The default regular expression will match occurrences of for example
'Incident-12354' and will put the part between parentheses in the dynamic
field field, in this case '12354'.
        </p></li><li class="listitem"><p>SearchInSubject</p><p>If this is set to '1', the email subject is searched for a ticket number.</p></li><li class="listitem"><p>SearchInBody</p><p>If this is set to '1', the email body is searched for a ticket number.</p></li><li class="listitem"><p>TicketStateTypes</p><p>
            This is an optional setting. If given, it will search OTRS only for open
external tickets of given state types. The state types are separated with
semicolons.
        </p></li><li class="listitem"><p>DynamicField</p><p>
            This is a required setting. It defines the dynamic filed that is used to
store the external number (the field name must exist in the system and has
to be valid).
        </p></li><li class="listitem"><p>SenderType</p><p>This defines the sender type used for the articles created in OTRS.</p></li></ul></div><p>
Конечно, также есть возможность разработки своих собственных
PostMaster-модулей фильтрации.
</p></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="configure-pgp"></a>Безопасность электронной почты с PGP</h3></div></div></div><p>
OTRS has the capability to sign or encrypt outgoing messages with
PGP. Furthermore, encrypted incoming messages can be decrypted. Encryption
and decryption are done with the GPL tool GnuPG. To setup GnuPG for OTRS,
the following steps have to be performed:
</p><p>
</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
    Установка GnuPG с помощью менеджера пакетов вашей операционной системы.
    </p></li><li class="listitem"><p>
    Настройте GnuPG для использования с OTRS. Для GnuPG и приватного ключа нужно
создать необходимые директории. В командной строки для пользователя 'otrs'
нужно выполнить команду из нижеприведенного сценирия.
    </p><p>
    </p><pre class="screen">
    linux:~# su otrs
    linux:/root$ cd
    linux:~$ pwd
    /opt/otrs
    linux:~$ gpg --gen-key
    gpg (GnuPG) 1.4.2; Copyright (C) 2005 Free Software Foundation, Inc.
    This program comes with ABSOLUTELY NO WARRANTY.
    This is free software, and you are welcome to redistribute it
    under certain conditions. See the file COPYING for details.

    gpg: directory `/opt/otrs/.gnupg' created
    gpg: new configuration file `/opt/otrs/.gnupg/gpg.conf' created
    gpg: WARNING: options in `/opt/otrs/.gnupg/gpg.conf' are not yet active during t
    his run
    gpg: keyring `/opt/otrs/.gnupg/secring.gpg' created
    gpg: keyring `/opt/otrs/.gnupg/pubring.gpg' created
    Please select what kind of key you want:
       (1) DSA and Elgamal (default)
       (2) DSA (sign only)
       (5) RSA (sign only)
    Your selection? 1
    DSA keypair will have 1024 bits.
    ELG-E keys may be between 1024 and 4096 bits long.
    What keysize do you want? (2048)
    Requested keysize is 2048 bits
    Please specify how long the key should be valid.
         0 = key does not expire
      &lt;n&gt;  = key expires in n days
      &lt;n&gt;w = key expires in n weeks
      &lt;n&gt;m = key expires in n months
      &lt;n&gt;y = key expires in n years
    Key is valid for? (0)
    Key does not expire at all
    Is this correct? (y/N) y

    You need a user ID to identify your key; the software constructs the user ID
    from the Real Name, Comment and Email Address in this form:
        "Heinrich Heine (Der Dichter) &lt;heinrichh@duesseldorf.de&gt;"

    Real name: Ticket System
    Email address: support@example.com
    Comment: Private PGP Key for the ticket system with address support@example.com
    You selected this USER-ID:
    "Ticket System (Private PGP Key for the ticket system with address support@examp
    le.com) &lt;support@example.com&gt;"

    Change (N)ame, (C)omment, (E)mail or (O)kay/(Q)uit? O
    You need a Passphrase to protect your secret key.

    Passphrase: secret
    Repeat passphrase: secret

    We need to generate a lot of random bytes. It is a good idea to perform
    some other action (type on the keyboard, move the mouse, utilize the
    disks) during the prime generation; this gives the random number
    generator a better chance to gain enough entropy.
    ++++++++++.+++++++++++++++++++++++++....+++++.+++++...+++++++++++++++++++++++++.
    +++++++++++++++++++++++++.+++++.+++++.+++++++++++++++++++++++++&gt;++++++++++&gt;+++++
    .......&gt;+++++&lt;+++++................................+++++

    Not enough random bytes available.  Please do some other work to give
    the OS a chance to collect more entropy! (Need 280 more bytes)

    ++++++++++.+++++..++++++++++..+++++....++++++++++++++++++++.+++++++++++++++.++++
    ++++++++++++++++++++++++++.++++++++++.+++++++++++++++.++++++++++.+++++++++++++++
    ..+++++&gt;.+++++....&gt;+++++........................................................
    ...........................................................&gt;+++++&lt;+++++.........
    .............+++++^^^
    gpg: /opt/otrs/.gnupg/trustdb.gpg: trustdb created
    gpg: key 7245A970 marked as ultimately trusted
    public and secret key created and signed.

    gpg: checking the trustdb
    gpg: 3 marginal(s) needed, 1 complete(s) needed, PGP trust model
    gpg: depth: 0  valid:   1  signed:   0  trust: 0-, 0q, 0n, 0m, 0f, 1u
    pub   1024D/7245A970 2006-02-03
          Key fingerprint = 2ED5 BC36 D2B6 B055 7EE1  5833 1D7B F967 7245 A970
     uid                  Ticket System (Private pgp key for ticket system with addre
    ss support@example.com) &lt;support@example.com&gt;
    sub   2048g/52B97069 2006-02-03

    linux:~$
    </pre><p>
    </p><p>
    <span class="emphasis"><em>Сценарий: Настройка GnuPG.</em></span>
    </p><p>
        Как показано в нижеприведенном сценарии, настройки по умолчанию могут быть
применены для большинства из необходимых параметров. Правильно должны быть
указаны только пароль и значения для владельца ключа.
    </p></li><li class="listitem"><p>
    Теперь OTRS готов для использования PGP. Через Панель Администрирования
откройте интерфейс SysConfig  и найдите ссылку "PGP". Из результатов поиска
выберите подгруппу Crypt::PGP.
    </p><p>
    На странице с PGP-настройками, PGP должен быть активирован для OTRS (первая
опция). Также нужно установить ипроверить путь к gpg-программе.
    </p><p>
    Следующим нужно изменить конфигурационный параметр (PGP::Options). Используя
эти конфигурационные настройки можно определить параметры, которые будут
использоваться для каждого вызова gpg пользователем 'otrs'. Каталог с
конфигурационными файлами для GnuPG является очень важным. В примере
используется <code class="filename">/opt/otrs/.gnupg</code>. Эта директоиря была
создана на первом шаге конфигурации PGP.
    </p><p>
        Используя следующий конфигурационный параметр (PGP::Key::Password), можно
указать пары для ключей ID и их пароли для собственных закрытых
ключей. Поскольку партнеры извне пишут зашифрованные сообщения в систему
заявок используя ваш публичный ключ, OTRS может расшифровать эти сообщения с
помощью ID/паролей указаных здесь.
    </p><p>
    Как получить идентификатор вашего собственного закрытого ключа? ID вашего
собственного закрытого идентификатора отображается во время генерации
(см. выше шаг 1). Также есть возможность получить ID, указав команду из
нижеприведенного сценария вызванную с правами пользователя 'otrs':
    </p><p>
    </p><pre class="screen">
    linux:~# su otrs
    linux:/root$ cd
    linux:~$ pwd
    /opt/otrs
    linux:~$ gpg --list-keys
    /opt/otrs/.gnupg/pubring.gpg
    ----------------------------
    pub   1024D/7245A970 2006-02-03
    uid                  Ticket System (Private pgp key for ticket system with
    address support@example.com) &lt;support@example.com&gt;
    sub   2048g/52B97069 2006-02-03

    linux:~$
    </pre><p>
    </p><p>
    <span class="emphasis"><em>Сценарий: Получение ID вашего собственного приватного
ключа.</em></span>
    </p><p>
    Идентификатор (ID) закрытого ключа можно найти в строке, которая начинается
с "sub". Это шестнадцатеричное представление строки, длиной в восемь
символов, например "52B97069".  Пароль, который нужно указать для этого
ключа в системе обработки заявок такой же как данные при генерации ключей.
    </p><p>
    После того, как эти данные были введены, нажмите кнопку "Обновить" чтобы
сохранить настройки. Теперь OTRS готов принимать и расшифровывать
зашифрованные сообщения.
    </p></li><li class="listitem"><p>
    И наконец, нужно импортировать открытый ключ клиента. Это гарантирует, что
зашифрованные сообщения могут быть отправлены этому клиенту. Есть два
способа импортировать открытый ключ клиента.
    </p><p>
    Первый способ - указать открытый ключ клиента в веб-интерфейсе управления
клиентами.
    </p><p>
    Вторая возможность заключается в определении ключей посредством настройки
PGP, которая доступна через Панель Администрирования. В правой стороне этой
страницы отображаются все импортированные открытые ключи клиентов. После
того как PGP активирован и сконфигурирован, здесь также должен отображатся
ваш собственный открытый ключ. В левой части страницы настроек PGP можно
производить поиск по ключам. Также, новый открытый ключ может быть загружен
в систему из файла.
    </p><p>
    Файлы с открытым ключем, которые нужно импортировать в OTRS должны
соответствовать файлам ключей GnuPGP. В большинстве случаев, ключ
сохраняется в файле как "ASCII armored key". OTRS позволяет работать с этим
форматом.
    </p></li></ol></div><p>
</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="smime"></a>Безопасность электронной почты с S/MIME</h3></div></div></div><p>
At first glance, encryption with S/MIME seems a little more complicated than
with PGP. First, you have to establish a Certification Authority (CA) for
the OTRS system. The subsequent steps are very much like those needed with
PGP: configure OTRS, install your own certificate, import other public
certificates as needed, etc.
</p><p>
В большинстве случаев настройка S/MIME производится за пределами
веб-интерфейса OTRS, и должана осуществлятся в оболочке операционной системы
с правами пользователя 'otrs'. MIME конфигурация под Linux основана yа SSL
(OpenSSL). Поэтому, сначала проверьте установлен ли в вашей системе пакет
OpenSSL. OpenSSL-пакет содержит скрипт, который называется CA.pl, для
создания сертификата, все наиболее важные шаги, нужно проделать именно с
ним. Для упрощения процедуры узнайте, где в файловой системе находится
сценарий CA.pl и введите путь к его местоположению в переменную путей
оболочки (см. нижеприведенный сценарий).
</p><p>
</p><pre class="screen">
otrs@linux:~&gt; rpm -ql openssl | grep CA
/usr/share/ssl/misc/CA.pl
otrs@linux:~&gt; export PATH=$PATH:/usr/share/ssl/misc
otrs@linux:~&gt; which CA.pl
/usr/share/ssl/misc/CA.pl
otrs@linux:~&gt; mkdir tmp; cd tmp
otrs@linux:~/tmp&gt;
</pre><p>
</p><p>
<span class="emphasis"><em>Сценарий: Настройка S/MIME.</em></span>
</p><p>
Сценарий выше показывает, что была создана нова временная директория ~/tmp,
в которой хранятся сгенерированные сертификаты.
</p><p>
Для создания сертификата, проделайте следующие операции в командной строке
(предположим, что OTRS-администратор  должен создать SSL-сертификат с целью
тестирования и обучения. В случае, если у вас уже есть SSL-сертификат для
шифрования, используйте его и пропустите следующие шаги):
</p><p>
</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
    Создание собственного Центра Сертификации (Certification Authority) для
SSL. Вы должны подтвердить запрос на собственный SSL-сертификат
(см. нижеприведенный сценарий).
    </p><p>
    </p><pre class="screen">
otrs@linux:~/tmp&gt; CA.pl -newca
CA certificate filename (or enter to create)

Making CA certificate ...
Generating a 1024 bit RSA private key
...++++++
......++++++
writing new private key to './demoCA/private/cakey.pem'
Enter PEM pass phrase:
Verifying - Enter PEM pass phrase:
-----
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [AU]:DE
State or Province Name (full name) [Some-State]:OTRS-state
Locality Name (eg, city) []:OTRS-town
Organization Name (eg, company) [Internet Widgits Pty Ltd]:Your company
Organizational Unit Name (eg, section) []:
Common Name (eg, YOUR name) []:OTRS Admin
Email Address []:otrs@your-domain.tld
otrs@linux:~/tmp&gt; ls -la demoCA/
total 8
-rw-r--r--  1 otrs otrs 1330 2006-01-08 17:54 cacert.pem
drwxr-xr-x  2 otrs otrs   48 2006-01-08 17:53 certs
drwxr-xr-x  2 otrs otrs   48 2006-01-08 17:53 crl
-rw-r--r--  1 otrs otrs    0 2006-01-08 17:53 index.txt
drwxr-xr-x  2 otrs otrs   48 2006-01-08 17:53 newcerts
drwxr-xr-x  2 otrs otrs   80 2006-01-08 17:54 private
-rw-r--r--  1 otrs otrs   17 2006-01-08 17:54 serial
otrs@linux:~/tmp&gt;
    </pre><p>
    </p><p>
    <span class="emphasis"><em>Сценарий: Создание Центра Сертификации (Certification Authority)
для SSL.</em></span>
    </p></li><li class="listitem"><p>
    Создание запроса сертификата (см. Сценарий ниже).
    </p><p>
    </p><pre class="screen">
otrs@linux:~/tmp&gt; CA.pl -newreq
Generating a 1024 bit RSA private key
..........................................++++++
....++++++
writing new private key to 'newreq.pem'
Enter PEM pass phrase:
Verifying - Enter PEM pass phrase:
-----
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [AU]:DE\keyreturn
State or Province Name (full name) [Some-State]:OTRS-state
Locality Name (eg, city) []:OTRS-town
Organization Name (eg, company) [Internet Widgits Pty Ltd]:Your company
Organizational Unit Name (eg, section) []:
Common Name (eg, YOUR name) []:OTRS admin
Email Address []:otrs@your-domain.tld

Please enter the following 'extra' attributes
to be sent with your certificate request
A challenge password []:
An optional company name []:
Request (and private key) is in newreq.pem
otrs@linux:~/tmp&gt; ls -la
total 4
drwxr-xr-x  6 otrs otrs  232 2006-01-08 17:54 demoCA
-rw-r--r--  1 otrs otrs 1708 2006-01-08 18:04 newreq.pem
otrs@linux:~/tmp&gt;
    </pre><p>
    </p><p>
    <span class="emphasis"><em>Сценарий: Создание запроса сертификаата.</em></span>
    </p></li><li class="listitem"><p>
    Подпись запроса сертификата. Запрос сертификата может быть подписан, и таким
образом сертифицирован вашим собственным центром сертификации (CA), что
более правдоподобно, чем использование других, внешних CA
(см. нижеприведенный сценарий).
    </p><p>
    </p><pre class="screen">
otrs@linux:~/tmp&gt; CA.pl -signreq
Using configuration from /etc/ssl/openssl.cnf
Enter pass phrase for ./demoCA/private/cakey.pem:
Check that the request matches the signature
Signature ok
Certificate Details:
        Serial Number:
            fd:85:f6:9f:14:07:16:c8
        Validity
            Not Before: Jan  8 17:04:37 2006 GMT
            Not After : Jan  8 17:04:37 2007 GMT
        Subject:
            countryName               = DE
            stateOrProvinceName       = OTRS-state
            localityName              = OTRS-town
            organizationName          = Your Company
            commonName                = OTRS administrator
            emailAddress              = otrs@your-domain.tld
        X509v3 extensions:
            X509v3 Basic Constraints:
                CA:FALSE
            Netscape Comment:
                OpenSSL Generated Certificate
            X509v3 Subject Key Identifier:
                01:D9:1E:58:C0:6D:BF:27:ED:37:34:14:D6:04:AC:C4:64:98:7A:22
            X509v3 Authority Key Identifier:
                keyid:10:4D:8D:4C:93:FD:2C:AA:9A:B3:26:80:6B:F5:D5:31:E2:8E:DB:A8
                DirName:/C=DE/ST=OTRS-state/L=OTRS-town/O=Your Company/
                CN=OTRS admin/emailAddress=otrs@your-domain.tld
                serial:FD:85:F6:9F:14:07:16:C7

Certificate is to be certified until Jan  8 17:04:37 2007 GMT (365 days)
Sign the certificate? [y/n]:y

1 out of 1 certificate requests certified, commit? [y/n]y
Write out database with 1 new entries
Data Base Updated
Signed certificate is in newcert.pem
otrs@linux:~/tmp&gt;
    </pre><p>
    </p><p>
    <span class="emphasis"><em>Сценарий: Подпись запроса сертификата.</em></span>
    </p></li><li class="listitem"><p>
    Создание своего собственного сертификата, и все данные собираются с ним,
используя запрос сертификата (см. Сценарий ниже).
    </p><p>
    </p><pre class="screen">
otrs@linux:~/tmp&gt; CA.pl -pkcs12 "OTRS Certificate"
Enter pass phrase for newreq.pem:
Enter Export Password:
Verifying - Enter Export Password:
otrs@linux:~/tmp&gt; ls -la
total 12
drwxr-xr-x  6 otrs otrs  328 2006-01-08 18:04 demoCA
-rw-r--r--  1 otrs otrs 3090 2006-01-08 18:13 newcert.p12
-rw-r--r--  1 otrs otrs 3791 2006-01-08 18:04 newcert.pem
-rw-r--r--  1 otrs otrs 1708 2006-01-08 18:04 newreq.pem
otrs@linux:~/tmp&gt;
    </pre><p>
    </p><p>
    <span class="emphasis"><em>Сценарий: Создание нового сертификата.</em></span>
    </p></li></ol></div><p>
</p><p>
Теперь эти операции выполнены, установка S/MIME в OTRS должена быть
завершена.
</p><p>
Эта часть установки осуществляется в Панели Администрирования, выбрав ссылку
<a class="link" href="administration.html#adminarea-smime" title="SMIME">"SMIME"</a>. В случае, если в OTRS нету
поддержки S/MIME, маска указывает администратору удобные ссылки чтобы
активировать поддержку S/MIME.
</p><p>
Используя группу <a class="link" href="">"Crypt::SMIME"</a> в SysConfig, также
можно включить и настроить поддержку S/MIME.
</p><p>
Здесь можно активировать поддержку S/MIME, определить пути для команд
OpenSSL, и директории для сертификатов. Файл ключей должен хранится в
директории, указанной здесь. В противном случае OpenSSL не будет их
использовать.
</p><p>
Следующим шагом, который следует выполнить - перейти по ссылке <a class="link" href="administration.html#adminarea-smime" title="SMIME"> Настройка S/MIME в Панели
Администрирования</a>. Здесь можно импортировать закрытые ключи
OTRS-системы и открытые ключи других партнеров. Введите публичный ключ,
который был создан и добавлен в OTRS в начале этого раздела.
</p><p>
Перейдя по ссылке <a class="link" href="administration.html#adminarea-customers" title="Клиенты">Инструменты
администрирования клиентов</a> можно импортировать все открытые S/MIME
ключи партнеров по общению.
</p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="backup-and-restore.html">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="administration.html">Наверх</a></td><td width="40%" align="right"> <a accesskey="n" href="external-backends.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">Резервное копирование системы </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> Использование внешних хранилищ данных</td></tr></table></div></body></html>
