<html><head>
<!-- otrs.github.io -->
<link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="../../../../../documentation.css">
<script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="../../../../../documentation.js"></script>
<!-- otrs.github.io -->
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Chapter 2. Hacking OTRS</title><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"><link rel="home" href="index.html" title="OTRS 3.0 - Developer Manual"><link rel="up" href="index.html" title="OTRS 3.0 - Developer Manual"><link rel="prev" href="architecture-overview.html" title="Architecture Overview"><link rel="next" href="how-to-extend.html" title="How to Extend it"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 2. Hacking OTRS</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="architecture-overview.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="how-to-extend.html">Next</a></td></tr></table><hr></div><div class="chapter" title="Chapter 2. Hacking OTRS"><div class="titlepage"><div><div><h2 class="title"><a name="hacking"></a>Chapter 2. Hacking OTRS</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="hacking.html#how-it-works">How it Works</a></span></dt><dd><dl><dt><span class="section"><a href="hacking.html#idp9402544">Config Mechanism</a></span></dt><dd><dl><dt><span class="section"><a href="hacking.html#default-config">Default Config</a></span></dt><dt><span class="section"><a href="hacking.html#custom-config">Custom Config</a></span></dt><dt><span class="section"><a href="hacking.html#accessing-config-options">Accessing Config Options</a></span></dt><dt><span class="section"><a href="hacking.html#xml-config">XML Config Options</a></span></dt></dl></dd><dt><span class="section"><a href="hacking.html#idp9898128">Database Mechanism</a></span></dt><dd><dl><dt><span class="section"><a href="hacking.html#database-how-it-works">How it works</a></span></dt><dt><span class="section"><a href="hacking.html#database-driver">Database Drivers</a></span></dt><dt><span class="section"><a href="hacking.html#database-supported">Supported Databases</a></span></dt></dl></dd><dt><span class="section"><a href="hacking.html#idp12181808">Log Mechanism</a></span></dt><dd><dl><dt><span class="section"><a href="hacking.html#use-and-syntax">Use and Syntax</a></span></dt><dt><span class="section"><a href="hacking.html#example">Example</a></span></dt></dl></dd><dt><span class="section"><a href="hacking.html#skins">Skins</a></span></dt><dd><dl><dt><span class="section"><a href="hacking.html#idp13009888">Skin Basics</a></span></dt><dt><span class="section"><a href="hacking.html#idp14620448">How skins are loaded</a></span></dt><dt><span class="section"><a href="hacking.html#idp13753056">Creating a New Skin</a></span></dt></dl></dd><dt><span class="section"><a href="hacking.html#loader">The CSS and JavaScript "Loader"</a></span></dt><dd><dl><dt><span class="section"><a href="hacking.html#idp14203216">How it works</a></span></dt><dt><span class="section"><a href="hacking.html#idp12886208">Basic Operation</a></span></dt><dt><span class="section"><a href="hacking.html#loader-javascript">Configuring the Loader: JavaScript</a></span></dt><dt><span class="section"><a href="hacking.html#idp11923584">Configuring the Loader: CSS</a></span></dt></dl></dd><dt><span class="section"><a href="hacking.html#TemplatingMechanism">Templating Mechanism</a></span></dt><dd><dl><dt><span class="section"><a href="hacking.html#TemplateCommands">Template Commands</a></span></dt><dt><span class="section"><a href="hacking.html#using-templates">Using a template file</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="how-to-extend.html">How to Extend it</a></span></dt><dd><dl><dt><span class="section"><a href="how-to-extend.html#idp13769024">Module Format</a></span></dt><dd><dl><dt><span class="section"><a href="how-to-extend.html#core-modules">Core Modules</a></span></dt><dt><span class="section"><a href="how-to-extend.html#frontend-modules">Frontend Modules</a></span></dt><dt><span class="section"><a href="how-to-extend.html#old-module-description">Old Module Descriptions</a></span></dt></dl></dd><dt><span class="section"><a href="how-to-extend.html#idp17388832">Object Basics</a></span></dt><dd><dl><dt><span class="section"><a href="how-to-extend.html#object-options">Object Options</a></span></dt><dt><span class="section"><a href="how-to-extend.html#search-options">Search Options</a></span></dt><dt><span class="section"><a href="how-to-extend.html#config-naming">Config Naming</a></span></dt><dt><span class="section"><a href="how-to-extend.html#config-file">Config File</a></span></dt><dt><span class="section"><a href="how-to-extend.html#navbar-setting">NavBar Settings</a></span></dt><dt><span class="section"><a href="how-to-extend.html#screen-flow">Screen flow</a></span></dt></dl></dd><dt><span class="section"><a href="how-to-extend.html#idp13559968">Writing an OTRS module for a new object</a></span></dt><dd><dl><dt><span class="section"><a href="how-to-extend.html#what-we-want-to-write">What we want to write</a></span></dt><dt><span class="section"><a href="how-to-extend.html#default-config-file">Default Config File</a></span></dt><dt><span class="section"><a href="how-to-extend.html#writing-frontend-module">Frontend Module</a></span></dt><dt><span class="section"><a href="how-to-extend.html#writing-core-module">Core Module</a></span></dt><dt><span class="section"><a href="how-to-extend.html#dtl-template-file">dtl Template File</a></span></dt><dt><span class="section"><a href="how-to-extend.html#language-file">Language File</a></span></dt><dt><span class="section"><a href="how-to-extend.html#summery">Summary</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="how-to-publish.html">How to Publish your OTRS Extensions</a></span></dt><dd><dl><dt><span class="section"><a href="how-to-publish.html#idp16619680">Package Management</a></span></dt><dd><dl><dt><span class="section"><a href="how-to-publish.html#package-distribution">Package Distribution</a></span></dt><dt><span class="section"><a href="how-to-publish.html#package-commands">Package Commands</a></span></dt></dl></dd><dt><span class="section"><a href="how-to-publish.html#idp12883216">Package Building</a></span></dt><dd><dl><dt><span class="section"><a href="how-to-publish.html#package-spec-file">Package Spec File</a></span></dt><dt><span class="section"><a href="how-to-publish.html#package-example-sopm">Example .sopm</a></span></dt><dt><span class="section"><a href="how-to-publish.html#package-build">Package Build</a></span></dt><dt><span class="section"><a href="how-to-publish.html#package-life-cycle">Package Life Cycle - Install/Upgrade/Uninstall</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="upgrading-modules.html">How to Upgrade your OTRS Extensions to Newer Versions of OTRS</a></span></dt><dd><dl><dt><span class="section"><a href="upgrading-modules.html#upgrading-modules-2.4-3.0">Upgrading OTRS Extensions from 2.4 to 3.0</a></span></dt><dd><dl><dt><span class="section"><a href="upgrading-modules.html#idp13936080">
            Translation of configuration file descriptions.
        </a></span></dt><dt><span class="section"><a href="upgrading-modules.html#idp18034912">
            Configuration of NavBarModule was Changed
        </a></span></dt><dt><span class="section"><a href="upgrading-modules.html#idp12343456">
            Configuration of NavBar was Changed
        </a></span></dt><dt><span class="section"><a href="upgrading-modules.html#idp18373648">
            Configuration Setting Frontend::NavBarModule was Renamed
        </a></span></dt><dt><span class="section"><a href="upgrading-modules.html#idp7328784">
            PreferencesGroups configuration
        </a></span></dt></dl></dd></dl></dd></dl></div><div class="abstract" title="Abstract"><p class="title"><b>Abstract</b></p><p>
            In this chapter, we'll take a closer look at how OTRS works, how to extend it and how to
            publish your OTRS extensions.
        </p></div><div class="section" title="How it Works"><div class="titlepage"><div><div><h2 class="title"><a name="how-it-works"></a>How it Works</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="hacking.html#idp9402544">Config Mechanism</a></span></dt><dd><dl><dt><span class="section"><a href="hacking.html#default-config">Default Config</a></span></dt><dt><span class="section"><a href="hacking.html#custom-config">Custom Config</a></span></dt><dt><span class="section"><a href="hacking.html#accessing-config-options">Accessing Config Options</a></span></dt><dt><span class="section"><a href="hacking.html#xml-config">XML Config Options</a></span></dt><dd><dl><dt><span class="section"><a href="hacking.html#xml-config-variable">Types of XML Config Variables</a></span></dt><dt><span class="section"><a href="hacking.html#xml-config-string">String</a></span></dt><dt><span class="section"><a href="hacking.html#xml-config-textarea">Textarea</a></span></dt><dt><span class="section"><a href="hacking.html#xml-config-option">Options</a></span></dt><dt><span class="section"><a href="hacking.html#xml-config-array">Array</a></span></dt><dt><span class="section"><a href="hacking.html#xml-config-hash">Hash</a></span></dt><dt><span class="section"><a href="hacking.html#xml-config-subhash">Hash with SubArray, SubHash</a></span></dt><dt><span class="section"><a href="hacking.html#xml-config-navbar">FrontendModuleReg (NavBar)</a></span></dt><dt><span class="section"><a href="hacking.html#xml-config-navbarmodule">FrontendModuleReg (NavBarModule)</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="hacking.html#idp9898128">Database Mechanism</a></span></dt><dd><dl><dt><span class="section"><a href="hacking.html#database-how-it-works">How it works</a></span></dt><dd><dl><dt><span class="section"><a href="hacking.html#database-sql">SQL</a></span></dt><dt><span class="section"><a href="hacking.html#database-xml">XML</a></span></dt></dl></dd><dt><span class="section"><a href="hacking.html#database-driver">Database Drivers</a></span></dt><dt><span class="section"><a href="hacking.html#database-supported">Supported Databases</a></span></dt></dl></dd><dt><span class="section"><a href="hacking.html#idp12181808">Log Mechanism</a></span></dt><dd><dl><dt><span class="section"><a href="hacking.html#use-and-syntax">Use and Syntax</a></span></dt><dt><span class="section"><a href="hacking.html#example">Example</a></span></dt></dl></dd><dt><span class="section"><a href="hacking.html#skins">Skins</a></span></dt><dd><dl><dt><span class="section"><a href="hacking.html#idp13009888">Skin Basics</a></span></dt><dt><span class="section"><a href="hacking.html#idp14620448">How skins are loaded</a></span></dt><dt><span class="section"><a href="hacking.html#idp13753056">Creating a New Skin</a></span></dt></dl></dd><dt><span class="section"><a href="hacking.html#loader">The CSS and JavaScript "Loader"</a></span></dt><dd><dl><dt><span class="section"><a href="hacking.html#idp14203216">How it works</a></span></dt><dt><span class="section"><a href="hacking.html#idp12886208">Basic Operation</a></span></dt><dt><span class="section"><a href="hacking.html#loader-javascript">Configuring the Loader: JavaScript</a></span></dt><dd><dl><dt><span class="section"><a href="hacking.html#loader-common-javascript">Common JavaScript</a></span></dt><dt><span class="section"><a href="hacking.html#loader-module-javascript">Module-Specific JavaScript</a></span></dt></dl></dd><dt><span class="section"><a href="hacking.html#idp11923584">Configuring the Loader: CSS</a></span></dt><dd><dl><dt><span class="section"><a href="hacking.html#idp14089008">Common CSS</a></span></dt><dt><span class="section"><a href="hacking.html#idp13568288">Module-Specific CSS</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="hacking.html#TemplatingMechanism">Templating Mechanism</a></span></dt><dd><dl><dt><span class="section"><a href="hacking.html#TemplateCommands">Template Commands</a></span></dt><dd><dl><dt><span class="section"><a href="hacking.html#idp7458368">Data Manipulation Commands</a></span></dt><dt><span class="section"><a href="hacking.html#idp11264912">Localization Commands</a></span></dt><dt><span class="section"><a href="hacking.html#idp12075840">Template Processing Commands</a></span></dt><dt><span class="section"><a href="hacking.html#idp7312592">dtl:js_on_document_complete</a></span></dt></dl></dd><dt><span class="section"><a href="hacking.html#using-templates">Using a template file</a></span></dt></dl></dd></dl></div><div class="section" title="Config Mechanism"><div class="titlepage"><div><div><h3 class="title"><a name="idp9402544"></a>Config Mechanism</h3></div></div></div><div class="section" title="Default Config"><div class="titlepage"><div><div><h4 class="title"><a name="default-config"></a>Default Config</h4></div></div></div><p>
There are different default config files. The main one, which comes with the
framework, is:
        </p><p>
            <code class="filename">Kernel/Config/Defaults.pm</code>
        </p><p>
This file should be left untouched as it is automatically updated on framework updates.
There is also a sub directory where you can store the default config files
for your own modules. These files are used automatically.
        </p><p>
The directory is located under:
        </p><p>
            <code class="filename">$OTRS_HOME/Kernel/Config/Files/*.pm</code>
        </p><p>
And could look as follows:
        </p><p>
            <code class="filename">Kernel/config/Files/Calendar.pm</code>
        </p><p>
        </p><pre class="programlisting">
# module reg and nav bar
$Self-&gt;{'Frontend::Module'}-&gt;{'AgentCalendar'} = {
    Description =&gt; 'Calendar',
    NavBarName =&gt; 'Ticket',
    NavBar =&gt; [
        {
            Description =&gt; 'Calendar',
            Name =&gt; 'Calendar',
            Image =&gt; 'calendar.png',
            Link =&gt; 'Action=AgentCalendar',
            NavBar =&gt; 'Ticket',
            Prio =&gt; 5000,
            AccessKey =&gt; 'c',
        },
    ],
};

# show online customers
$Self-&gt;{'Frontend::NotifyModule'}-&gt;{'80-ShowCalendarEvents'} = {
    Module =&gt; 'Kernel::Output::HTML::NotificationCalendar',
};
        </pre><p>
        </p></div><div class="section" title="Custom Config"><div class="titlepage"><div><div><h4 class="title"><a name="custom-config"></a>Custom Config</h4></div></div></div><p>
If you want to change a config option, copy it to
        </p><p>
            <code class="filename">Kernel/Config.pm</code>
        </p><p>
and set the new option. This file will be read out last and so all default config
options are overwritten with your settings.
        </p><p>
This way it is easy to handle updates -  you just need the Kernel/Config.pm.
        </p></div><div class="section" title="Accessing Config Options"><div class="titlepage"><div><div><h4 class="title"><a name="accessing-config-options"></a>Accessing Config Options</h4></div></div></div><p>
You can read and write (for one request) the config options via the core module "Kernel::Config".
The config object is a base object and thus available in each Frontend Module.
        </p><p>
If you want to access a config option:
        </p><p>
        </p><pre class="programlisting">
my $ConfigOption = $Self-&gt;{ConfigObject}-&gt;Get('Prefix::Option');
        </pre><p>
        </p><p>
If you want to change a config option at runtime and just for this one request/process:
        </p><p>
        </p><pre class="programlisting">
$Self-&gt;{ConfigObject}-&gt;Set(
    Key =&gt; 'Prefix::Option'
    Value =&gt; 'SomeNewValue',
);
        </pre><p>
        </p></div><div class="section" title="XML Config Options"><div class="titlepage"><div><div><h4 class="title"><a name="xml-config"></a>XML Config Options</h4></div></div></div><p>
XML config files are located under:
        </p><p>
            <code class="filename">$OTRS_HOME/Kernel/Config/Files/*.xml</code>
        </p><p>
Each config file has the following layout:
        </p><p>
        </p><pre class="programlisting">
&lt;?xml version="1.0" encoding="utf-8" ?&gt;
&lt;otrs_config version="1.0" init="Changes"&gt;

    &lt;!--  config items will be here --&gt;

&lt;/otrs_config&gt;
        </pre><p>
        </p><p>
The "init" attribute describes where the config options should be loaded. There are different levels available and will be loaded/overloaded in the following order: "Framework" (for framework settings e. g. session option), "Application" (for application settings e. g. ticket options), "Config" (for extensions to existing applications e. g. ITSM options) and "Changes" (for custom development e. g. to overwrite framework or ticket options).
        </p><p>
If you want to add config options, here is an example:
        </p><p>
        </p><pre class="programlisting">
&lt;ConfigItem Name="Ticket::Hook" Required="1" Valid="1" ConfigLevel="300"&gt;
    &lt;Description Lang="en"&gt;The identifyer for a ticket. The default is Ticket#.&lt;/Description&gt;
    &lt;Description Lang="de"&gt;Ticket-Identifikator. Als Standard wird Ticket# verwendet.&lt;/Description&gt;
    &lt;Group&gt;Ticket&lt;/Group&gt;
    &lt;SubGroup&gt;Core::Ticket&lt;/SubGroup&gt;
    &lt;Setting&gt;
        &lt;String Regex=""&gt;Ticket#&lt;/String&gt;
    &lt;/Setting&gt;
&lt;/ConfigItem&gt;
        </pre><p>
        </p><p>
If "required" is set to "1", the config variable is included and cannot be disabled.
        </p><p>
If "valid" is set to "1", the config variable is active. If it is set to "0", the config variable is inactive.
        </p><p>
If the optional attribute "ConfigLevel" is set, the config variable might not be edited by the administrator,
depending on his own config level. The config variable "ConfigLevel" sets the level of technical experience
of the administrator. It can be 100 (Expert), 200 (Advanced) or 300 (Beginner).
As a guideline which config level should be given to an option, it is recommended that all options
having to do with the configuration of externel interaction, like Sendmail, LDAP, SOAP,
and others should get a config level of at least 200 (Advanced).
        </p><p>
The config variable is defined in the "setting" element.
        </p><div class="section" title="Types of XML Config Variables"><div class="titlepage"><div><div><h5 class="title"><a name="xml-config-variable"></a>Types of XML Config Variables</h5></div></div></div><p>
The XML config settings support various types of variables.
            </p></div><div class="section" title="String"><div class="titlepage"><div><div><h5 class="title"><a name="xml-config-string"></a>String</h5></div></div></div><p>
A config element for numbers and single-line strings.
Checking the validity with a regex is possible.
The check attribute checks elements on the file system.
This contains files and directories.
            </p><p>
            </p><pre class="programlisting">
&lt;Setting&gt;
    &lt;String Regex="" Check="File"&gt;&lt;/String&gt;
&lt;/Setting&gt;
            </pre><p>
            </p></div><div class="section" title="Textarea"><div class="titlepage"><div><div><h5 class="title"><a name="xml-config-textarea"></a>Textarea</h5></div></div></div><p>
A config element for multiline text.
            </p><p>
            </p><pre class="programlisting">
&lt;Setting&gt;
    &lt;TextArea Regex=""&gt;&lt;/TextArea&gt;
&lt;/Setting&gt;
            </pre><p>
            </p></div><div class="section" title="Options"><div class="titlepage"><div><div><h5 class="title"><a name="xml-config-option"></a>Options</h5></div></div></div><p>
This config element offers preset values as a pull-down menu.
            </p><p>
            </p><pre class="programlisting">
&lt;Setting&gt;
    &lt;Option SelectedID="Key"&gt;
        &lt;Item Key=""&gt;&lt;/Item&gt;
        &lt;Item Key=""&gt;&lt;/Item&gt;
    &lt;/Option&gt;
&lt;/Setting&gt;
            </pre><p>
            </p></div><div class="section" title="Array"><div class="titlepage"><div><div><h5 class="title"><a name="xml-config-array"></a>Array</h5></div></div></div><p>
With this config element arrays can be displayed.
            </p><p>
            </p><pre class="programlisting">
&lt;Setting&gt;
    &lt;Array&gt;
        &lt;Item&gt;&lt;/Item&gt;
        &lt;Item&gt;&lt;/Item&gt;
    &lt;/Array&gt;
&lt;/Setting&gt;
            </pre><p>
            </p></div><div class="section" title="Hash"><div class="titlepage"><div><div><h5 class="title"><a name="xml-config-hash"></a>Hash</h5></div></div></div><p>
With this config element hashes can be displayed.
            </p><p>
            </p><pre class="programlisting">
&lt;Setting&gt;
    &lt;Hash&gt;
        &lt;Item Key=""&gt;&lt;/Item&gt;
        &lt;Item Key=""&gt;&lt;/Item&gt;
    &lt;/Hash&gt;
&lt;/Setting&gt;
            </pre><p>
            </p></div><div class="section" title="Hash with SubArray, SubHash"><div class="titlepage"><div><div><h5 class="title"><a name="xml-config-subhash"></a>Hash with SubArray, SubHash</h5></div></div></div><p>
A hash can contain content, arrays or hashes.
            </p><p>
            </p><pre class="programlisting">
&lt;Setting&gt;
    &lt;Hash&gt;
        &lt;Item Key=""&gt;&lt;/Item&gt;
        &lt;Item Key=""&gt;
            &lt;Hash&gt;
                &lt;Item Key=""&gt;&lt;/Item&gt;
                &lt;Item Key=""&gt;&lt;/Item&gt;
            &lt;/Hash&gt;
        &lt;/Item&gt;
        &lt;Item Key=""&gt;
            &lt;Array&gt;
                &lt;Item&gt;&lt;/Item&gt;
                &lt;Item&gt;&lt;/Item&gt;
            &lt;/Array&gt;
        &lt;/Item&gt;
        &lt;Item Key=""&gt;&lt;/Item&gt;
    &lt;/Hash&gt;
&lt;/Setting&gt;
            </pre><p>
            </p></div><div class="section" title="FrontendModuleReg (NavBar)"><div class="titlepage"><div><div><h5 class="title"><a name="xml-config-navbar"></a>FrontendModuleReg (NavBar)</h5></div></div></div><p>
Module registration for Agent Interface.
            </p><p>
            </p><pre class="programlisting">
&lt;Setting&gt;
    &lt;FrontendModuleReg&gt;
        &lt;Group&gt;group1&lt;/Group&gt;
        &lt;Group&gt;group2&lt;/Group&gt;
        &lt;Description&gt;Logout&lt;/Description&gt;
        &lt;Title&gt;&lt;/Title&gt;
        &lt;NavBarName&gt;&lt;/NavBarName&gt;
        &lt;NavBar&gt;
            &lt;Description&gt;Logout&lt;/Description&gt;
            &lt;Name&gt;Logout&lt;/Name&gt;
            &lt;Image&gt;exit.png&lt;/Image&gt;
            &lt;Link&gt;Action=Logout&lt;/Link&gt;
            &lt;NavBar&gt;&lt;/NavBar&gt;
            &lt;Type&gt;&lt;/Type&gt;
            &lt;Block&gt;ItemPre&lt;/Block&gt;
            &lt;AccessKey&gt;l&lt;/AccessKey&gt;
            &lt;Prio&gt;100&lt;/Prio&gt;
        &lt;/NavBar&gt;
    &lt;/FrontendModuleReg&gt;
&lt;/Setting&gt;
            </pre><p>
            </p></div><div class="section" title="FrontendModuleReg (NavBarModule)"><div class="titlepage"><div><div><h5 class="title"><a name="xml-config-navbarmodule"></a>FrontendModuleReg (NavBarModule)</h5></div></div></div><p>
Module registration for Admin Interface
            </p><p>
            </p><pre class="programlisting">
&lt;Setting&gt;
    &lt;FrontendModuleReg&gt;
        &lt;Group&gt;admin&lt;/Group&gt;
        &lt;Group&gt;admin2&lt;/Group&gt;
        &lt;Description&gt;Admin&lt;/Description&gt;
        &lt;Title&gt;User&lt;/Title&gt;
        &lt;NavBarName&gt;Admin&lt;/NavBarName&gt;
        &lt;NavBarModule&gt;
            &lt;Module&gt;Kernel::Output::HTML::NavBarModuleAdmin&lt;/Module&gt;
            &lt;Name&gt;Users&lt;/Name&gt;
            &lt;Block&gt;Block1&lt;/Block&gt;
            &lt;Prio&gt;100&lt;/Prio&gt;
        &lt;/NavBarModule&gt;
    &lt;/FrontendModuleReg&gt;
&lt;/Setting&gt;
            </pre><p>
            </p></div></div></div><div class="section" title="Database Mechanism"><div class="titlepage"><div><div><h3 class="title"><a name="idp9898128"></a>Database Mechanism</h3></div></div></div><p>
OTRS comes with a database layer that supports different databases.
    </p><div class="section" title="How it works"><div class="titlepage"><div><div><h4 class="title"><a name="database-how-it-works"></a>How it works</h4></div></div></div><p>
The database layer (Kernel::System::DB) has two input options: SQL and XML.
        </p><div class="section" title="SQL"><div class="titlepage"><div><div><h5 class="title"><a name="database-sql"></a>SQL</h5></div></div></div><p>
The SQL interface should be used for normal database actions (SELECT, INSERT,
UPDATE, ...). It can be used like a normal Perl DBI interface.
            </p><div class="section" title="INSERT/UPDATE/DELETE"><div class="titlepage"><div><div><h6 class="title"><a name="database-sql-do"></a>INSERT/UPDATE/DELETE</h6></div></div></div><pre class="programlisting">
$Self-&gt;{DBObject}-&gt;Do(
    SQL=&gt; "INSERT INTO table (name, id) VALUES ('SomeName', 123)",
);

$Self-&gt;{DBObject}-&gt;Do(
    SQL=&gt; "UPDATE table SET name = 'SomeName', id = 123",
);

$Self-&gt;{DBObject}-&gt;Do(
    SQL=&gt; "DELETE FROM table WHERE id = 123",
);
            </pre></div><div class="section" title="SELECT"><div class="titlepage"><div><div><h6 class="title"><a name="database-sql-select"></a>SELECT</h6></div></div></div><pre class="programlisting">
my $SQL = "SELECT id FROM table WHERE tn = '123'";

$Self-&gt;{DBObject}-&gt;Prepare(SQL =&gt; $SQL, Limit =&gt; 15);

while (my @Row = $Self-&gt;{DBObject}-&gt;FetchrowArray()) {
    $Id = $Row[0];
}
return $Id;
            </pre><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
Take care to use Limit as param and not in the SQL string because
not all databases support LIMIT in SQL strings.
                </p></div><pre class="programlisting">
my $SQL = "SELECT id FROM table WHERE tn = ? AND group = ?";

$Self-&gt;{DBObject}-&gt;Prepare(
    SQL   =&gt; $SQL,
    Limit =&gt; 15,
    Bind  =&gt; [ $Tn, $Group ],
);

while (my @Row = $Self-&gt;{DBObject}-&gt;FetchrowArray()) {
    $Id = $Row[0];
}
return $Id;
            </pre><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
Use the Bind attribute where ever you can, especially for long statements. If
you use Bind you do not need the function Quote().
                </p></div></div><div class="section" title="QUOTE"><div class="titlepage"><div><div><h6 class="title"><a name="database-sql-quote"></a>QUOTE</h6></div></div></div><p>
String:
                    </p><pre class="programlisting">
my $QuotedString = $Self-&gt;{DBObject}-&gt;Quote("It's a problem!");
                    </pre><p>
                </p><p>
Integer:
                    </p><pre class="programlisting">
my $QuotedInteger = $Self-&gt;{DBObject}-&gt;Quote('123', 'Integer');
                    </pre><p>
                </p><p>
Number:
                    </p><pre class="programlisting">
my $QuotedNumber = $Self-&gt;{DBObject}-&gt;Quote('21.35', 'Number');
                    </pre><p>
                </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
Please use the Bind attribute instead of Quote() where ever you can.
                    </p></div></div></div><div class="section" title="XML"><div class="titlepage"><div><div><h5 class="title"><a name="database-xml"></a>XML</h5></div></div></div><p>
The XML interface should be used for INSERT, CREATE TABLE, DROP TABLE and ALTER TABLE.
As this syntax is different from database to database, using it makes sure that
you write applications that can be used in all of them.
            </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
The &lt;Insert&gt; has changed in &gt;=2.2. Values are now used in content area (not longer in attribut Value).
                </p></div><div class="section" title="INSERT"><div class="titlepage"><div><div><h6 class="title"><a name="database-xml-insert"></a>INSERT</h6></div></div></div><pre class="programlisting">
&lt;Insert Table="some_table"&gt;
    &lt;Data Key="id"&gt;1&lt;/Data&gt;
    &lt;Data Key="description" Type="Quote"&gt;exploit&lt;/Data&gt;
&lt;/Insert&gt;
            </pre></div><div class="section" title="CREATE TABLE"><div class="titlepage"><div><div><h6 class="title"><a name="database-xml-create"></a>CREATE TABLE</h6></div></div></div><p>
Possible data types are: BIGINT, SMALLINT, INTEGER, VARCHAR (Size=1-1000000), DATE (Format: yyyy-mm-dd hh:mm:ss) and LONGBLOB.
            </p><pre class="programlisting">
&lt;TableCreate Name="calendar_event"&gt;
    &lt;Column Name="id" Required="true" PrimaryKey="true" AutoIncrement="true" Type="BIGINT"/&gt;
    &lt;Column Name="title" Required="true" Size="250" Type="VARCHAR"/&gt;
    &lt;Column Name="content" Required="false" Size="250" Type="VARCHAR"/&gt;
    &lt;Column Name="start_time" Required="true" Type="DATE"/&gt;
    &lt;Column Name="end_time" Required="true" Type="DATE"/&gt;
    &lt;Column Name="owner_id" Required="true" Type="INTEGER"/&gt;
    &lt;Column Name="event_status" Required="true" Size="50" Type="VARCHAR"/&gt;
    &lt;Index Name="calendar_event_title"&gt;
        &lt;IndexColumn Name="title"/&gt;
    &lt;/Index&gt;
    &lt;Unique Name="calendar_event_title"&gt;
        &lt;UniqueColumn Name="title"/&gt;
    &lt;/Unique&gt;
    &lt;ForeignKey ForeignTable="users"&gt;
        &lt;Reference Local="owner_id" Foreign="id"/&gt;
    &lt;/ForeignKey&gt;
&lt;/TableCreate&gt;
            </pre></div><div class="section" title="DROP TABLE"><div class="titlepage"><div><div><h6 class="title"><a name="database-xml-drop"></a>DROP TABLE</h6></div></div></div><pre class="programlisting">
&lt;TableDrop Name="calendar_event"/&gt;
            </pre></div><div class="section" title="ALTER TABLE"><div class="titlepage"><div><div><h6 class="title"><a name="database-xml-alter"></a>ALTER TABLE</h6></div></div></div><p>
            The following shows an example of add, change and drop columns.
            </p><pre class="programlisting">
&lt;TableAlter Name="calendar_event"&gt;
    &lt;ColumnAdd Name="test_name" Type="varchar" Size="20" Required="1"/&gt;

    &lt;ColumnChange NameOld="test_name" NameNew="test_title" Type="varchar" Size="30" Required="1"/&gt;

    &lt;ColumnChange NameOld="test_title" NameNew="test_title" Type="varchar" Size="100" Required="0"/&gt;

    &lt;ColumnDrop Name="test_title"/&gt;

    &lt;IndexCreate Name="index_test3"&gt;
        &lt;IndexColumn Name="test3"/&gt;
    &lt;/IndexCreate&gt;

    &lt;IndexDrop Name="index_test3"/&gt;

    &lt;UniqueCreate Name="uniq_test3"&gt;
        &lt;UniqueColumn Name="test3"/&gt;
    &lt;/UniqueCreate&gt;

    &lt;UniqueDrop Name="uniq_test3"/&gt;
&lt;/TableAlter&gt;
            </pre><p>
            The next shows an example how to rename a table.
            </p><pre class="programlisting">
&lt;TableAlter NameOld="calendar_event" NameNew="calendar_event_new"/&gt;
            </pre></div><div class="section" title="Code to process XML"><div class="titlepage"><div><div><h6 class="title"><a name="database-xml-code"></a>Code to process XML</h6></div></div></div><pre class="programlisting">
my @XMLARRAY = @{$Self-&gt;ParseXML(String =&gt; $XML)};

my @SQL = $Self-&gt;{DBObject}-&gt;SQLProcessor(
    Database =&gt; \@XMLARRAY,
);
push(@SQL, $Self-&gt;{DBObject}-&gt;SQLProcessorPost());

for (@SQL) {
    $Self-&gt;{DBObject}-&gt;Do(SQL =&gt; $_);
}
            </pre></div></div></div><div class="section" title="Database Drivers"><div class="titlepage"><div><div><h4 class="title"><a name="database-driver"></a>Database Drivers</h4></div></div></div><p>
            The database drivers are located under <code class="filename">$OTRS_HOME/Kernel/System/DB/*.pm</code>.
        </p></div><div class="section" title="Supported Databases"><div class="titlepage"><div><div><h4 class="title"><a name="database-supported"></a>Supported Databases</h4></div></div></div><p>
        </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>MySQL</p></li><li class="listitem"><p>PostgreSQL</p></li><li class="listitem"><p>Oracle</p></li><li class="listitem"><p>MSSQL</p></li><li class="listitem"><p>DB2</p></li></ul></div><p>
        </p></div></div><div class="section" title="Log Mechanism"><div class="titlepage"><div><div><h3 class="title"><a name="idp12181808"></a>Log Mechanism</h3></div></div></div><p>
OTRS comes with a log backend that can be used for application logging and debugging.
    </p><div class="section" title="Use and Syntax"><div class="titlepage"><div><div><h4 class="title"><a name="use-and-syntax"></a>Use and Syntax</h4></div></div></div><p>
All module layers have ready-made Log Objects which can be used by
        </p><pre class="programlisting">
$Self-&gt;{LogObject}-&gt;Log(
    Priority =&gt; 'error',
    Message =&gt; 'Need something!',
);
        </pre><p>
        </p></div><div class="section" title="Example"><div class="titlepage"><div><div><h4 class="title"><a name="example"></a>Example</h4></div></div></div><p>
The following example shows how to use the log mechanism without a module layer.
        </p><pre class="programlisting">
use Kernel::Config;
use Kernel::System::Encode;
use Kernel::System::Log;

my $ConfigObject = Kernel::Config-&gt;new();
my $EncodeObject = Kernel::System::Encode-&gt;new(
    ConfigObject =&gt; $ConfigObject,
);
my $LogObject    = Kernel::System::Log-&gt;new(
    ConfigObject =&gt; $ConfigObject,
);

$Self-&gt;{LogObject}-&gt;Log(
    Priority =&gt; 'error',
    Message =&gt; 'Need something!',
);
        </pre><p>
        </p></div></div><div class="section" title="Skins"><div class="titlepage"><div><div><h3 class="title"><a name="skins"></a>Skins</h3></div></div></div><p>
        Since OTRS 3.0, the visual appearance of OTRS is controlled by "skins".
    </p><p>
        A skin is a set of CSS and image files, which together control how the GUI is
        presented to the user. Skins do not change the HTML content that is generated by OTRS
        (this is what "Themes" do), but they control how it is displayed. With the help
        of modern CSS standards it is possible to change the display thoroughly (e.g.
        repositioning parts of dialogs, hiding elements, ...).
    </p><div class="section" title="Skin Basics"><div class="titlepage"><div><div><h4 class="title"><a name="idp13009888"></a>Skin Basics</h4></div></div></div><p>
            All skins are in <code class="filename">$OTRS_HOME/var/httpd/htdocs/skins/$SKIN_TYPE/$SKIN_NAME</code>.
            There are two types of skins: agent and customer skins.
        </p><p>
            Each of the agents can select individually, which of the installed agent skins they want to "wear".
        </p><p>
            For the customer interface, a skin has to be selected globally with the config setting
            <code class="literal">Loader::Customer::SelectedSkin</code>. All customers will see this skin.
        </p></div><div class="section" title="How skins are loaded"><div class="titlepage"><div><div><h4 class="title"><a name="idp14620448"></a>How skins are loaded</h4></div></div></div><p>
            It is important to note that the "default" skin will <span class="emphasis"><em>always</em></span> be loaded <span class="emphasis"><em>first</em></span>.
            If the agent selected another skin than the "default" one, then the other one will be loaded only
            <span class="emphasis"><em>after</em></span> the default skin. By "loading" here we mean that OTRS will put tags into the HTML content
            which cause the CSS files to be loaded by the browser. Let's see an example of this:

            </p><pre class="programlisting">
    &lt;link rel="stylesheet" href="/otrs-web/skins/Agent/default/css-cache/CommonCSS_179376764084443c181048401ae0e2ad.css" /&gt;
    &lt;link rel="stylesheet" href="/otrs-web/skins/Agent/ivory/css-cache/CommonCSS_e0783e0c2445ad9cc59c35d6e4629684.css" /&gt;
            </pre><p>

            Here it can clearly be seen that the default skin is loaded first, and then the custom skin specified
            by the agent. In this example, we see the result of the activated loader (<code class="literal">Loader::Enabled</code>
            set to 1), which gathers all CSS files, concatenates and minifies them and serves them as one chunk to the
            browser. This saves bandwith and also reduces the number of HTTP requests. Let's see the same example with the
            Loader turned off:

            </p><pre class="programlisting">
    &lt;link rel="stylesheet" href="/otrs-web/skins/Agent/default/css/Core.Reset.css" /&gt;
    &lt;link rel="stylesheet" href="/otrs-web/skins/Agent/default/css/Core.Default.css" /&gt;
    &lt;link rel="stylesheet" href="/otrs-web/skins/Agent/default/css/Core.Header.css" /&gt;
    &lt;link rel="stylesheet" href="/otrs-web/skins/Agent/default/css/Core.OverviewControl.css" /&gt;
    &lt;link rel="stylesheet" href="/otrs-web/skins/Agent/default/css/Core.OverviewSmall.css" /&gt;
    &lt;link rel="stylesheet" href="/otrs-web/skins/Agent/default/css/Core.OverviewMedium.css" /&gt;
    &lt;link rel="stylesheet" href="/otrs-web/skins/Agent/default/css/Core.OverviewLarge.css" /&gt;
    &lt;link rel="stylesheet" href="/otrs-web/skins/Agent/default/css/Core.Footer.css" /&gt;
    &lt;link rel="stylesheet" href="/otrs-web/skins/Agent/default/css/Core.Grid.css" /&gt;
    &lt;link rel="stylesheet" href="/otrs-web/skins/Agent/default/css/Core.Form.css" /&gt;
    &lt;link rel="stylesheet" href="/otrs-web/skins/Agent/default/css/Core.Table.css" /&gt;
    &lt;link rel="stylesheet" href="/otrs-web/skins/Agent/default/css/Core.Widget.css" /&gt;
    &lt;link rel="stylesheet" href="/otrs-web/skins/Agent/default/css/Core.WidgetMenu.css" /&gt;
    &lt;link rel="stylesheet" href="/otrs-web/skins/Agent/default/css/Core.TicketDetail.css" /&gt;
    &lt;link rel="stylesheet" href="/otrs-web/skins/Agent/default/css/Core.Tooltip.css" /&gt;
    &lt;link rel="stylesheet" href="/otrs-web/skins/Agent/default/css/Core.Dialog.css" /&gt;
    &lt;link rel="stylesheet" href="/otrs-web/skins/Agent/default/css/Core.Print.css" /&gt;
    &lt;link rel="stylesheet" href="/otrs-web/skins/Agent/default/css/Core.Agent.CustomerUser.GoogleMaps.css" /&gt;
    &lt;link rel="stylesheet" href="/otrs-web/skins/Agent/default/css/Core.Agent.CustomerUser.OpenTicket.css" /&gt;
    &lt;link rel="stylesheet" href="/otrs-web/skins/Agent/ivory/css/Core.Dialog.css" /&gt;
            </pre><p>

            Here we can better see the individual files that come from the skins.
        </p><p>
            There are different types of CSS files: common files which must always be loaded,
            and "module-specific" files which are only loaded for special modules within the OTRS
            framework.
        </p><p>
            In addition, it is possible to specify CSS files which only must be loaded on IE7 or
            IE8 (in the case of the customer interface, also IE6). This is unfortunate, but it was
            not possible to develop a modern GUI on these browsers without having special CSS for them.
        </p><p>
            For details regarding the CSS file types, please see the <a class="link" href="hacking.html#loader" title='The CSS and JavaScript "Loader"'>section on the Loader</a>.
        </p><p>
            For each HTML page generation, the loader will first take all configured CSS files from the
            default skin, and then for each file look if it is also available in a custom skin (if a custom
            skin is selected) and load them after the default files.
        </p><p>
            That means a) that CSS files in custom skins need to have the same names as in the default skins,
            and b) that a custom skin does not need to have all files of the default skin. That is the big
            advantage of loading the default skin first: a custom skin has all default CSS rules present
            and only needs to change those which should result in a different display. That can often be
            done in a single file, like in the example above.
        </p><p>
            Another effect of this is that you  need to be careful to overwrite all default CSS rules in your
            custom skins that you want to change. Let's see an example:

            </p><pre class="programlisting">
.Header h1 {
    font-weight: bold;
    color: #000;
}
            </pre><p>

            This defines special headings inside of the .Header element as bold, black text. Now if you want to
            change that in your skin to another color and normal text, it is not enough to write

            </p><pre class="programlisting">
.Header h1 {
    color: #F00;
}
            </pre><p>

            Because the original rule for <code class="literal">font-weight</code> still applies. You need to override it explicitly:

            </p><pre class="programlisting">
.Header h1 {
    font-weight: normal;
    color: #F00;
}
            </pre><p>
        </p></div><div class="section" title="Creating a New Skin"><div class="titlepage"><div><div><h4 class="title"><a name="idp13753056"></a>Creating a New Skin</h4></div></div></div><p>In this section, we will be creating a new agent skin which replaces the default OTRS background color (white)
        with a custom company color (light grey) and the default logo by a custome one.
        Also we will configure that skin to be the one which all agents will see by default.</p><p>There are only two simple steps we need to take to achieve this goal:
            </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>create the skin files</p></li><li class="listitem"><p>configure the new logo and</p></li><li class="listitem"><p>make the skin known to the OTRS system.</p></li></ul></div><p>
        </p><p>
            Let's start by creating the files needed for our new skin. First of all, we need to create a new
            folder for this skin (we'll call it "custom"). This folder will be
            <code class="filename">$OTRS_HOME/var/httpd/htdocs/skins/Agent/custom</code>.
        </p><p>
            In there, we need to place the new CSS file in a new directory
            <code class="filename">css</code> which defines the new skin's appearance. We'll call it <code class="filename">Core.Default.css</code>
            (remember that it must have the same name as one of the files in the "default" skin). This is the code needed for the CSS file:

            </p><pre class="programlisting">
body {
    background-color: #c0c0c0; /* not very beautiful but it meets our purpose */
}
            </pre><p>
        </p><p>
            Now follows the second step, adding a new logo and making the new skin known to the OTRS system. For this, we first need
            to place our custom logo (e.g. <code class="filename">logo.png</code>) in a new directory (e.g. <code class="filename">img</code>) in our skin directory.
            Then we need to create a new config file <code class="filename">$OTRS_HOME/Kernel/Config/Files/CustomSkin.xml</code>, which will contain the needed settings
            as follows:

            </p><pre class="programlisting">
&lt;?xml version="1.0" encoding="utf-8" ?&gt;
&lt;otrs_config version="1.0" init="Framework"&gt;
    &lt;ConfigItem Name="AgentLogo" Required="0" Valid="1"&gt;
        &lt;Description Translatable="1"&gt;The logo shown in the header of the agent interface. The URL to the image must be a relative URL to the skin image directory.&lt;/Description&gt;
        &lt;Group&gt;Framework&lt;/Group&gt;
        &lt;SubGroup&gt;Frontend::Agent&lt;/SubGroup&gt;
        &lt;Setting&gt;
            &lt;Hash&gt;
                &lt;Item Key="URL"&gt;skins/Agent/custom/img/logo.png&lt;/Item&gt;
                &lt;Item Key="StyleTop"&gt;13px&lt;/Item&gt;
                &lt;Item Key="StyleRight"&gt;75px&lt;/Item&gt;
                &lt;Item Key="StyleHeight"&gt;67px&lt;/Item&gt;
                &lt;Item Key="StyleWidth"&gt;244px&lt;/Item&gt;
            &lt;/Hash&gt;
        &lt;/Setting&gt;
    &lt;/ConfigItem&gt;
    &lt;ConfigItem Name="Loader::Agent::Skin###100-custom" Required="0" Valid="1"&gt;
        &lt;Description Translatable="1"&gt;Custom skin for the development manual.&lt;/Description&gt;
        &lt;Group&gt;Framework&lt;/Group&gt;
        &lt;SubGroup&gt;Frontend::Agent&lt;/SubGroup&gt;
        &lt;Setting&gt;
            &lt;Hash&gt;
                &lt;Item Key="InternalName"&gt;custom&lt;/Item&gt;
                &lt;Item Key="VisibleName"&gt;Custom&lt;/Item&gt;
                &lt;Item Key="Description"&gt;Custom skin for the development manual.&lt;/Item&gt;
                &lt;Item Key="HomePage"&gt;www.yourcompany.com&lt;/Item&gt;
            &lt;/Hash&gt;
        &lt;/Setting&gt;
    &lt;/ConfigItem&gt;
&lt;/otrs_config&gt;
            </pre><p>

            To make this configuration active, we need to navigate to the SysConfig module in the admin area
            of OTRS (alternatively, you can run the script <code class="filename">$OTRS_HOME/bin/otrs.RebuildConfig.pl</code>).
            This will regenerate the Perl cache of the XML configuration files, so that our new skin is now known
            and can be selected in the system. To make it the default skin that new agents see before they made their
            own skin selection, edit the SysConfig setting "Loader::Agent::DefaultSelectedSkin" and set it to "custom".
        </p><p>
            In conclusion: to create a new skin in OTRS, we had to place the new logo file, and create one CSS and one XML file, resulting
            in three new files:
            </p><pre class="screen">
$OTRS_HOME/Kernel/Config/Files/CustomSkin.xml
$OTRS_HOME/var/httpd/htdocs/skins/Agent/custom/img/custom-logo.png
$OTRS_HOME/var/httpd/htdocs/skins/Agent/custom/css/Core.Header.css
            </pre><p>
        </p></div></div><div class="section" title='The CSS and JavaScript "Loader"'><div class="titlepage"><div><div><h3 class="title"><a name="loader"></a>The CSS and JavaScript "Loader"</h3></div></div></div><p>
        Starting with OTRS 3.0, the CSS and JavaScript code in OTRS grew
        to a large amount. To be able to satisfy both development concerns
        (good maintainability by a large number of separate files) and
        performance issues (making few HTTP requests and serving minified
        content without unneccessary whitespace and documentation)
        had to be addressed. To achieve these goals, the Loader was invented.
    </p><div class="section" title="How it works"><div class="titlepage"><div><div><h4 class="title"><a name="idp14203216"></a>How it works</h4></div></div></div><p>
            To put it simple, the Loader
            </p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
                        determines for each request
                        precisely which CSS and JavaScript files are needed at the client
                        side by the current application module
                    </p></li><li class="listitem"><p>
                        collects all the relevant data
                    </p></li><li class="listitem"><p>
                        minifies the data, removing unneccessary whitespace and documentation
                    </p></li><li class="listitem"><p>
                        serves it to the client in only a few HTTP reqests instead of many
                        individual ones, allowing the client to cache these snippets in the browser cache
                    </p></li><li class="listitem"><p>
                        perform these tasks in a highly performing way, utilizing the caching
                        mechanisms of OTRS.
                    </p></li></ul></div><p>
        </p><p>
            Of course, there is a little bit more detailed involved, but this should suffice
            as a first overview.
        </p></div><div class="section" title="Basic Operation"><div class="titlepage"><div><div><h4 class="title"><a name="idp12886208"></a>Basic Operation</h4></div></div></div><p>
            With the configuration settings <code class="literal">Loader::Enabled::CSS</code>
            and <code class="literal">Loader::Enabled::JavaScript</code>, the loader can be turned
            on and off for JavaScript and CSS, respectively (it is on by default).
        </p><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
                Because of rendering problems in Internet Explorer, the Loader cannot be turned
                off for CSS files for this client browser (config setting will be overridden).
                Up to version 8, Internet Explorer cannot handle more than 32 CSS files on a page.
            </p></div><p>
            To learn about how the Loader works, please turn it off in your OTRS installation
            with the aforementioned configuration settings. Now look at the source code of
            the application module that you are currently using in this OTRS system (after a
            reload, of course). You will see that there are many CSS files loaded in the
            <code class="literal">&lt;head&gt;</code> section of the page, and many JavaScript files
            at the bottom of the page, just before the closing <code class="literal">&lt;/body&gt;</code>
            element.
        </p><p>
            Having the content like this in many individual files with a readable formatting
            makes the development much easier, and even possible at all. However, this has the
            disadvantage of a large number of HTTP requests (network latency has a big effect)
            and unneccessary content (whitespace and documentation) which needs to be transferred
            to the client.
        </p><p>
            The Loader solves this problem by performing the steps outlined in the short description
            above. Please turn on the Loader again and reload your page now. Now you can see that there are only
            very few CSS and JavaScript tags in the HTML code, like this:

            </p><pre class="programlisting">
&lt;script type="text/javascript" src="/otrs30-dev-web/js/js-cache/CommonJS_d16010491cbd4faaaeb740136a8ecbfd.js"&gt;&lt;/script&gt;

&lt;script type="text/javascript" src="/otrs30-dev-web/js/js-cache/ModuleJS_b54ba9c085577ac48745f6849978907c.js"&gt;&lt;/script&gt;
            </pre><p>

            What just happened? During the original request generating the HTML code for this page,
            the Loader generated these two files (or took them from the cache) and put the
            shown <code class="literal">&lt;script&gt;</code> tags on the page which link to these files,
            instead of linking to all relevant JavaScript files separately (as you saw it without
            the loader being active).
        </p><p>
            The CSS section looks a little more complicated:

            </p><pre class="programlisting">
    &lt;link rel="stylesheet" type="text/css" href="/otrs30-dev-web/skins/Agent/default/css-cache/CommonCSS_00753c78c9be7a634c70e914486bfbad.css" /&gt;

&lt;!--[if IE 7]&gt;
    &lt;link rel="stylesheet" type="text/css" href="/otrs30-dev-web/skins/Agent/default/css-cache/CommonCSS_IE7_59394a0516ce2e7359c255a06835d31f.css" /&gt;
&lt;![endif]--&gt;

&lt;!--[if IE 8]&gt;
    &lt;link rel="stylesheet" type="text/css" href="/otrs30-dev-web/skins/Agent/default/css-cache/CommonCSS_IE8_ff58bd010ef0169703062b6001b13ca9.css" /&gt;
&lt;![endif]--&gt;
            </pre><p>

            The reason is that Internet Explorer 7 and 8 need special treatment in addition to the
            default CSS because of their lacking support of web standard technologies.
            So we have some normal CSS that is loaded in all browsers, and some special CSS
            that is inside of so-called "conditional comments" which cause it to be loaded
            <span class="emphasis"><em>only</em></span> by Internet Explorer 7/8. All other browsers will ignore it.
        </p><p>
            Now we have outlined how the loader works. Let's look at how you can utilize that in
            your own OTRS extensions by adding configuration data to the loader, telling it to
            load additional or alternative CSS or JavaScript content.
        </p></div><div class="section" title="Configuring the Loader: JavaScript"><div class="titlepage"><div><div><h4 class="title"><a name="loader-javascript"></a>Configuring the Loader: JavaScript</h4></div></div></div><p>
            To be able to operate correctly, the Loader needs to know which content it has to
            load for a particular OTRS application module. First, it will look for JavaScript
            files which <span class="emphasis"><em>always</em></span> have to be loaded, and then it looks for
            special files which are only relevant for the current application module.
        </p><div class="section" title="Common JavaScript"><div class="titlepage"><div><div><h5 class="title"><a name="loader-common-javascript"></a>Common JavaScript</h5></div></div></div><p>
                The list of JavaScript files to be loaded is configured in the configuration settings
                <code class="literal">Loader::Agent::CommonJS</code> (for the agent interface) and
                <code class="literal">Loader::Customer::CommonJS</code> (for the customer interface).
            </p><p>
                These settings are designed as hashes, so that OTRS extensions can add their own
                hash keys for additional content to be loaded. Let's look at an example:

                </p><pre class="programlisting">
&lt;ConfigItem Name="Loader::Agent::CommonJS###000-Framework" Required="1" Valid="1"&gt;
    &lt;Description Translatable="1"&gt;List of JS files to always be loaded for the agent interface.&lt;/Description&gt;
    &lt;Group&gt;Framework&lt;/Group&gt;
    &lt;SubGroup&gt;Core::Web&lt;/SubGroup&gt;
    &lt;Setting&gt;
        &lt;Array&gt;
            &lt;Item&gt;thirdparty/json/json2.js&lt;/Item&gt;
            &lt;Item&gt;thirdparty/jquery-1.4.2/jquery.js&lt;/Item&gt;

            ...

            &lt;Item&gt;Core.App.js&lt;/Item&gt;
            &lt;Item&gt;Core.Agent.js&lt;/Item&gt;
            &lt;Item&gt;Core.Agent.Search.js&lt;/Item&gt;
        &lt;/Array&gt;
    &lt;/Setting&gt;
&lt;/ConfigItem&gt;
                </pre><p>

                This is the list of JavaScript files which always need to be loaded
                for the agent interface of OTRS.
            </p><p>
                To add new content which is supposed to be loaded always in the agent interface,
                just add an XML configuration file with another hash entry:

                </p><pre class="programlisting">
&lt;ConfigItem Name="Loader::Agent::CommonJS###100-CustomPackage" Required="0" Valid="1"&gt;
    &lt;Description Translatable="1"&gt;List of JS files to always be loaded for the agent interface for package "CustomPackage".&lt;/Description&gt;
    &lt;Group&gt;Framework&lt;/Group&gt;
    &lt;SubGroup&gt;Core::Web&lt;/SubGroup&gt;
    &lt;Setting&gt;
        &lt;Array&gt;
            &lt;Item&gt;CustomPackage.App.js&lt;/Item&gt;
        &lt;/Array&gt;
    &lt;/Setting&gt;
&lt;/ConfigItem&gt;
                </pre><p>

                Simple, isn't it?
            </p></div><div class="section" title="Module-Specific JavaScript"><div class="titlepage"><div><div><h5 class="title"><a name="loader-module-javascript"></a>Module-Specific JavaScript</h5></div></div></div><p>
                Not all JavaScript is usable for all application modules of OTRS.
                Therefore it is possible to specify module-specific JavaScript files.
                Whenever a certain module is used (such as <code class="literal">AgentDashboard</code>),
                the module-specific JavaScript for this module will also be loaded.
                The configuration is done in the frontend module registration in the
                XML configurations.
                Again, an example:

                </p><pre class="programlisting">
&lt;ConfigItem Name="Frontend::Module###AgentDashboard" Required="0" Valid="1"&gt;
    &lt;Description Translatable="1"&gt;Frontend module registration for the agent interface.&lt;/Description&gt;
    &lt;Group&gt;Framework&lt;/Group&gt;
    &lt;SubGroup&gt;Frontend::Agent::ModuleRegistration&lt;/SubGroup&gt;
    &lt;Setting&gt;
        &lt;FrontendModuleReg&gt;
            &lt;Description&gt;Agent Dashboard&lt;/Description&gt;
            &lt;Title&gt;&lt;/Title&gt;
            &lt;NavBarName&gt;Dashboard&lt;/NavBarName&gt;
            &lt;NavBar&gt;
                &lt;Description Translatable="1"&gt;&lt;/Description&gt;
                &lt;Name Translatable="1"&gt;Dashboard&lt;/Name&gt;
                &lt;Link&gt;Action=AgentDashboard&lt;/Link&gt;
                &lt;NavBar&gt;Dashboard&lt;/NavBar&gt;
                &lt;Type&gt;Menu&lt;/Type&gt;
                &lt;Description Translatable="1"&gt;&lt;/Description&gt;
                &lt;Block&gt;ItemArea&lt;/Block&gt;
                &lt;AccessKey&gt;d&lt;/AccessKey&gt;
                &lt;Prio&gt;50&lt;/Prio&gt;
            &lt;/NavBar&gt;
            &lt;Loader&gt;
                &lt;JavaScript&gt;thirdparty/flot/excanvas.js&lt;/JavaScript&gt;
                &lt;JavaScript&gt;thirdparty/flot/jquery.flot.js&lt;/JavaScript&gt;
                &lt;JavaScript&gt;Core.UI.Chart.js&lt;/JavaScript&gt;
                &lt;JavaScript&gt;Core.UI.DnD.js&lt;/JavaScript&gt;
                &lt;JavaScript&gt;Core.Agent.Dashboard.js&lt;/JavaScript&gt;
            &lt;/Loader&gt;
        &lt;/FrontendModuleReg&gt;
    &lt;/Setting&gt;
&lt;/ConfigItem&gt;
                </pre><p>

                It is possible to put a <code class="literal">&lt;Loader&gt;</code> tag
                in the frontend module registrations which may contain
                <code class="literal">&lt;JavaScript&gt;</code> tags, one for each file
                that is supposed to be loaded for this application module.
            </p><p>
                Now you have all information you need to configure the way the Loader
                handles JavaScript code.
            </p><p>
                There is one special case: for <code class="literal">ToolbarModule</code>s, you can also add custom
                JavaScript files. Just add a <code class="literal">JavaScript</code> attribute to
                the configuration like this:

                </p><pre class="programlisting">
&lt;ConfigItem Name="Frontend::ToolBarModule###410-Ticket::AgentTicketEmail" Required="0" Valid="1"&gt;
    &lt;Description Translatable="1"&gt;Toolbar Item for a shortcut.&lt;/Description&gt;
    &lt;Group&gt;Ticket&lt;/Group&gt;
    &lt;SubGroup&gt;Frontend::Agent::ToolBarModule&lt;/SubGroup&gt;
    &lt;Setting&gt;
        &lt;Hash&gt;
            &lt;Item Key="Module"&gt;Kernel::Output::HTML::ToolBarLink&lt;/Item&gt;
            &lt;Item Key="Name"&gt;New email ticket&lt;/Item&gt;
            &lt;Item Key="Priority"&gt;1009999&lt;/Item&gt;
            &lt;Item Key="Link"&gt;Action=AgentTicketEmail&lt;/Item&gt;
            &lt;Item Key="Action"&gt;AgentTicketEmail&lt;/Item&gt;
            &lt;Item Key="AccessKey"&gt;l&lt;/Item&gt;
            &lt;Item Key="CssClass"&gt;EmailTicket&lt;/Item&gt;
            &lt;Item Key="JavaScript"&gt;OTRS.Agent.CustomToolbarModule.js&lt;/Item&gt;
        &lt;/Hash&gt;
    &lt;/Setting&gt;
&lt;/ConfigItem&gt;
                </pre><p>
            </p></div></div><div class="section" title="Configuring the Loader: CSS"><div class="titlepage"><div><div><h4 class="title"><a name="idp11923584"></a>Configuring the Loader: CSS</h4></div></div></div><p>
            The loader handles CSS files very similar to JavaScript files, as described
            in the previous <a class="link" href="hacking.html#loader-javascript" title="Configuring the Loader: JavaScript">section</a>, and extending
            the settings works in the same way too.
        </p><div class="section" title="Common CSS"><div class="titlepage"><div><div><h5 class="title"><a name="idp14089008"></a>Common CSS</h5></div></div></div><p>
                The way common CSS is handled is very similar to the way
                <a class="link" href="hacking.html#loader-common-javascript" title="Common JavaScript">common JavaScript</a>
                is loaded. Here, the configuration settings are called
                <code class="literal">Loader::Agent::CommonCSS</code> and
                <code class="literal">Loader::Customer::CommonCSS</code>, respectively.
            </p><p>
                However, as we already noted above, Internet Explorer 7 and 8
                (and for the customer interface also 6) need special treatment.
                That's why there are special configuration settings for them, to
                specify common CSS which should only be loaded in these browsers.
                The respective settings are
                <code class="literal">Loader::Agent::CommonCSS::IE7</code>,
                <code class="literal">Loader::Agent::CommonCSS::IE8</code>,
                <code class="literal">Loader::Customer::CommonCSS::IE6</code>,
                <code class="literal">Loader::Customer::CommonCSS::IE7</code> and
                <code class="literal">Loader::Customer::CommonCSS::IE8</code>.
            </p><p>
                An example:

                </p><pre class="programlisting">
&lt;ConfigItem Name="Loader::Agent::CommonCSS::IE8###000-Framework" Required="1" Valid="1"&gt;
    &lt;Description Translatable="1"&gt;List of IE8-specific CSS files to always be loaded for the agent interface.&lt;/Description&gt;
    &lt;Group&gt;Framework&lt;/Group&gt;
    &lt;SubGroup&gt;Core::Web&lt;/SubGroup&gt;
    &lt;Setting&gt;
        &lt;Array&gt;
            &lt;Item&gt;Core.OverviewSmall.IE8.css&lt;/Item&gt;
        &lt;/Array&gt;
    &lt;/Setting&gt;
&lt;/ConfigItem&gt;
                </pre><p>

                This is the list of common CSS files for the agent interface which
                should only be loaded in Internet Explorer 8.
            </p></div><div class="section" title="Module-Specific CSS"><div class="titlepage"><div><div><h5 class="title"><a name="idp13568288"></a>Module-Specific CSS</h5></div></div></div><p>
                Module-specific CSS is handled very similar to the way
                <a class="link" href="hacking.html#loader-module-javascript" title="Module-Specific JavaScript">module-specific JavaScript</a>
                is handled. It is also configured in the frontend module registrations. Example:

                </p><pre class="programlisting">
&lt;ConfigItem Name="Frontend::Module###Admin" Required="0" Valid="1"&gt;
    &lt;Description Translatable="1"&gt;Frontend module registration for the agent interface.&lt;/Description&gt;
    &lt;Group&gt;Framework&lt;/Group&gt;
    &lt;SubGroup&gt;Frontend::Admin::ModuleRegistration&lt;/SubGroup&gt;
    &lt;Setting&gt;
        &lt;FrontendModuleReg&gt;
            &lt;Group&gt;admin&lt;/Group&gt;
            &lt;Description&gt;Admin-Area&lt;/Description&gt;
            &lt;Title&gt;&lt;/Title&gt;
            &lt;NavBarName&gt;Admin&lt;/NavBarName&gt;
            &lt;NavBar&gt;
                &lt;Type&gt;Menu&lt;/Type&gt;
                &lt;Description Translatable="1"&gt;&lt;/Description&gt;
                &lt;Block&gt;ItemArea&lt;/Block&gt;
                &lt;Name Translatable="1"&gt;Admin&lt;/Name&gt;
                &lt;Link&gt;Action=Admin&lt;/Link&gt;
                &lt;NavBar&gt;Admin&lt;/NavBar&gt;
                &lt;AccessKey&gt;a&lt;/AccessKey&gt;
                &lt;Prio&gt;10000&lt;/Prio&gt;
            &lt;/NavBar&gt;
            &lt;NavBarModule&gt;
                &lt;Module&gt;Kernel::Output::HTML::NavBarModuleAdmin&lt;/Module&gt;
            &lt;/NavBarModule&gt;
            &lt;Loader&gt;
                &lt;CSS&gt;Core.Agent.Admin.css&lt;/CSS&gt;
                &lt;CSS_IE7&gt;Core.Agent.AdminIE7.css&lt;/CSS_IE7&gt;
                &lt;JavaScript&gt;Core.Agent.Admin.SysConfig.js&lt;/JavaScript&gt;
            &lt;/Loader&gt;
        &lt;/FrontendModuleReg&gt;
    &lt;/Setting&gt;
&lt;/ConfigItem&gt;
                </pre><p>

                Here we have a module (the admin overview page of the agent interface)
                which has special JavaScript, normal CSS
                (tagname <code class="literal">&lt;CSS&gt;</code>) and special CSS for
                Internet Explorer 7 (tagname <code class="literal">&lt;CSS_IE7&gt;</code>).
                All of these need to be loaded in addition to the common JavaScript
                and CSS defined for the agent interface.
            </p><p>
                It is also possible to specify module-specific CSS for Internet Explorer 8
                (tagname <code class="literal">&lt;CSS_IE8&gt;</code>) and, in the case of the customer interface,
                for Internet Explorer 6 (tagname <code class="literal">&lt;CSS_IE6&gt;</code>).
            </p><p>
                There is one special case: for <code class="literal">ToolbarModule</code>s, you can also add custom
                CSS files. Just add a <code class="literal">CSS</code>, <code class="literal">CSS_IE7</code> or
                <code class="literal">CSS_IE8</code> attribute to the configuration like this:

                </p><pre class="programlisting">
&lt;ConfigItem Name="Frontend::ToolBarModule###410-Ticket::AgentTicketEmail" Required="0" Valid="1"&gt;
    &lt;Description Translatable="1"&gt;Toolbar Item for a shortcut.&lt;/Description&gt;
    &lt;Group&gt;Ticket&lt;/Group&gt;
    &lt;SubGroup&gt;Frontend::Agent::ToolBarModule&lt;/SubGroup&gt;
    &lt;Setting&gt;
        &lt;Hash&gt;
            &lt;Item Key="Module"&gt;Kernel::Output::HTML::ToolBarLink&lt;/Item&gt;
            &lt;Item Key="Name"&gt;New email ticket&lt;/Item&gt;
            &lt;Item Key="Priority"&gt;1009999&lt;/Item&gt;
            &lt;Item Key="Link"&gt;Action=AgentTicketEmail&lt;/Item&gt;
            &lt;Item Key="Action"&gt;AgentTicketEmail&lt;/Item&gt;
            &lt;Item Key="AccessKey"&gt;l&lt;/Item&gt;
            &lt;Item Key="CssClass"&gt;EmailTicket&lt;/Item&gt;
            &lt;Item Key="CSS"&gt;OTRS.Agent.CustomToolbarModule.css&lt;/Item&gt;
            &lt;Item Key="CSS_IE7"&gt;OTRS.Agent.CustomToolbarModule.IE7.css&lt;/Item&gt;
        &lt;/Hash&gt;
    &lt;/Setting&gt;
&lt;/ConfigItem&gt;
                </pre><p>
            </p></div></div></div><div class="section" title="Templating Mechanism"><div class="titlepage"><div><div><h3 class="title"><a name="TemplatingMechanism"></a>Templating Mechanism</h3></div></div></div><p>
        Internally, OTRS uses a templating mechanism to dynamically generate its
        HTML pages (and other content), while keeping the program logic (Perl) and
        the presentation (HTML) separate. Typically, a frontend module will use an
        own template file, pass some data to it and return the rendered result to
        the user.
    </p><p>
        The template files are located at:
        <code class="filename">$OTRS_HOME/Kernel/Output/HTML/Standard/*.dtl</code>
    </p><p>
        Inside of these templates, a set of commands for data manipulation, localization
        and simple logical structures can be used. This section describes these commands
        and shows how to use them in templates.
    </p><div class="section" title="Template Commands"><div class="titlepage"><div><div><h4 class="title"><a name="TemplateCommands"></a>Template Commands</h4></div></div></div><div class="section" title="Data Manipulation Commands"><div class="titlepage"><div><div><h5 class="title"><a name="idp7458368"></a>Data Manipulation Commands</h5></div></div></div><p>
                In templates, dynamic data must be inserted, quoted etc. This section
                lists the relevant commands to do that.
            </p><div class="section" title='$Data{""}'><div class="titlepage"><div><div><h6 class="title"><a name="data"></a>$Data{""}</h6></div></div></div><p>
                    If data parameters are given to the templates by the application module,
                    these data can be output to the template. <code class="literal">$Data</code> is
                    the most simple, but also most dangerous one. It will insert the data
                    parameter whose name is specified inside of the {""} into the template
                    as it is, without any HTML quoting.
                </p><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
                        Because of the missing HTML quoting, this can result in security problems.
                        Never output data that was input by a user without quoting in HTML context.
                        The user could - for example - just insert a <code class="literal">&lt;script&gt;</code> tag,
                        and it would be output on the HTML page generated by OTRS.
                    </p><p>
                        Whenever possible, use <a class="link" href="hacking.html#qdata" title='$QData{""}'><code class="literal">$QData{""}</code></a> (in HTML) or
                        <a class="link" href="hacking.html#lqdata" title='$LQData{""}'><code class="literal">$LQData{""}</code></a> (in Links) instead.
                    </p></div><p>
                    Example: Whenever we generate HTML in the application, we need to output it to the
                    template without HTML quoting, like <code class="literal">&lt;select&gt;</code> elements, which
                    are generated by the function <code class="literal">Layout::BuildSelection</code> in OTRS.

                    </p><pre class="programlisting">
&lt;label for="Dropdown"&gt;Example Dropdown&lt;/label&gt;
$Data{"DropdownString"}
                    </pre><p>
                </p></div><div class="section" title='$QData{""}'><div class="titlepage"><div><div><h6 class="title"><a name="qdata"></a>$QData{""}</h6></div></div></div><p>
                    This command has the same function as <a class="link" href="hacking.html#data" title='$Data{""}'><code class="literal">$Data{""}</code></a>,
                    but it performs HTML quoting on the data as it is inserted to the template.

                    </p><pre class="programlisting">
The name of the author is $QData{"Name"}.
                    </pre><p>

                    It's also possible specify a maximum length for the value.
                    If, for example, you just want to show 8 characters of a variable (result will be "SomeName[...]"),
                    use the following:

                    </p><pre class="programlisting">
The first 20 characters of the author's name: $QData{"Name","20"}.
                    </pre><p>
                </p></div><div class="section" title='$LQData{""}'><div class="titlepage"><div><div><h6 class="title"><a name="lqdata"></a>$LQData{""}</h6></div></div></div><p>
                    This command has the same function as <a class="link" href="hacking.html#data" title='$Data{""}'><code class="literal">$Data{""}</code></a>,
                    but it performs <a class="ulink" href="http://en.wikipedia.org/wiki/Percent-encoding" target="_top">URL encoding</a>
                    on the data as it is inserted to the template. This should be used
                    to output single parameter names or values of URLs, to prevent security problems.
                    It cannot be used for complete URLs because
                    it will also mask <code class="literal">=</code>, for example.

                    </p><pre class="programlisting">
&lt;a href="$Env{"Baselink"};Location=$LQData{"File"}"&gt;$QData{"File","110"}&lt;/a&gt;
                    </pre><p>
                </p></div><div class="section" title='$Env{""}'><div class="titlepage"><div><div><h6 class="title"><a name="env"></a>$Env{""}</h6></div></div></div><p>
                    Inserts the environment variable with the name specified in {""}. Some examples:

                    </p><pre class="programlisting">
The current user name is: $Env{"UserFirstname"}

Some other common predefined variables are:

$Env{"SessionID"} --&gt; the current session id
$Env{"Time"} --&gt; the current time e. g.  Thu Dec 27 16:00:55 2001
$Env{"CGIHandle"} --&gt; the current CGI handle e. g.  index.pl
$Env{"UserCharset"} --&gt; the current site charset e. g.  iso-8859-1
$Env{"Baselink"} --&gt; the baselink --&gt; index.pl?SessionID=...
$Env{"UserFirstname"} --&gt; e. g. Dirk $Env{"UserFirstname"}
$Env{"UserLogin"} --&gt; e. g. mgg@x11.org
$Env{"UserIsGroup[users]"} = Yes --&gt; user groups (useful for own links)
$Env{"UserIsGroup[admin]"} = Yes $Env{"Action"} --&gt; the current action
                    </pre><p>
                </p><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
                        Because of the missing HTML quoting, this can result in security problems.
                        Never output data that was input by a user without quoting in HTML context.
                        The user could - for example - just insert a <code class="literal">&lt;script&gt;</code> tag,
                        and it would be output on the HTML page generated by OTRS.
                    </p><p>
                        Whenever possible, use <a class="link" href="hacking.html#qenv" title='$QEnv{""}'><code class="literal">$QEnv{""}</code></a> instead.
                    </p></div></div><div class="section" title='$QEnv{""}'><div class="titlepage"><div><div><h6 class="title"><a name="qenv"></a>$QEnv{""}</h6></div></div></div><p>
                    Works like <a class="link" href="hacking.html#data" title='$Data{""}'><code class="literal">$Env{""}</code></a>, but
                    performs HTML encoding when the data is inserted to the template.

                    </p><pre class="programlisting">
The current user name is: $QEnv{"UserFirstname"}
                    </pre><p>
                </p></div><div class="section" title='$Config{""}'><div class="titlepage"><div><div><h6 class="title"><a name="config"></a>$Config{""}</h6></div></div></div><p>
                    With this tag you can insert config variables into the template. Let's
                    see an example Kernel/Config.pm:

                    </p><pre class="programlisting">
[Kernel/Config.pm]
    # FQDN
    # (Full qualified domain name of your system.)
    $Self-&gt;{FQDN} = 'otrs.example.com';
    # AdminEmail
    # (Email of the system admin.)
    $Self-&gt;{AdminEmail} = 'admin@example.com';
[...]
                    </pre><p>

                    To output values from it in the template, use:

                    </p><pre class="programlisting">
The hostname is '$Config{"FQDN"}'
The admin email address is '$Config{"AdminEmail"}'
                    </pre><p>
                </p><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
                        Because of the missing HTML quoting, this can result in security problems.
                    </p><p>
                        Whenever possible, use <a class="link" href="hacking.html#quote" title='$Quote{""}'><code class="literal">$Quote{"$Config{""}"}</code></a>.
                    </p></div></div><div class="section" title='$Quote{""}'><div class="titlepage"><div><div><h6 class="title"><a name="quote"></a>$Quote{""}</h6></div></div></div><p>
                    This tag can be used to perform quoting on HTML strings, when no other quoting is possible.

                    </p><pre class="programlisting">
$Quote{"$Config{"ProductName"}"} ($Quote{"$Config{"Ticket::Hook"}"})
                    </pre><p>

                    It's also possible specify a maximum length for the value.
                    If, for example, you just want to show 8 characters of a variable (result will be "Some lon[...]"),
                    use the following:

                    </p><pre class="programlisting">
$Quote{"Some long long string", "8"})
                    </pre><p>
                </p></div></div><div class="section" title="Localization Commands"><div class="titlepage"><div><div><h5 class="title"><a name="idp11264912"></a>Localization Commands</h5></div></div></div><div class="section" title='$Text{""}'><div class="titlepage"><div><div><h6 class="title"><a name="text"></a>$Text{""}</h6></div></div></div><p>
                    Translates the enlosed string into the current user's selected language
                    and performs HTML quoting on the resulting string. If no translation is found,
                    the original string will be used.

                    </p><pre class="programlisting">
Translate this text: $Text{"Help"}
                    </pre><p>

                    When translating data coming from the application, use <code class="literal">$Data</code>
                    inside of <code class="literal">$Text</code>, not <code class="literal">$QData</code>, to prevent
                    double quoting:

                    </p><pre class="programlisting">
Translate data from the application: $Text{"$Data{"Type"}"}
                    </pre><p>

                    You can also specify parameters (%s) inside of the string which should be replaced
                    with other data:

                    </p><pre class="programlisting">
Translate this text and insert the given data: $Text{"Change %s settings", "$Data{"Type"}"}
                    </pre><p>
                </p></div><div class="section" title='$JSText{""}'><div class="titlepage"><div><div><h6 class="title"><a name="jstext"></a>$JSText{""}</h6></div></div></div><p>
                    Works in the same way as <a class="link" href="hacking.html#text" title='$Text{""}'><code class="literal">$Text{""}</code></a>, but
                    does not perform HTML encoding but JavaScript string escaping instead (all
                    <code class="literal">'</code> characters will be encoded as <code class="literal">\'</code>. So with
                    the help of this tag you can make sure that even dynamic strings will not break your
                    JavaScript code.

                    </p><pre class="programlisting">
window.alert('$JSText{"Some message's content"}');

// after the command was replaced in the template, this will
// result in (for an English speaking agent):

window.alert('Some message\'s content');
                    </pre><p>

                    Make sure to use <code class="literal">'</code> as string delimiter for strings where you want
                    to use <code class="literal">$JSText</code> inside.
                </p></div><div class="section" title='$TimeLong{""}'><div class="titlepage"><div><div><h6 class="title"><a name="timelong"></a>$TimeLong{""}</h6></div></div></div><p>
                    Inserts a localized date/time stamp (including a possible time zone
                    difference of the current agent).
                </p><p>
                    In different cultural areas, different convention for date and time
                    formatting are used. For example, what is the 01.02.2010 in Germany,
                    would be 02/01/2010 in the USA. <code class="literal">$Time{""}</code> abstracts
                    this away from the templates. Let's see an example:

                    </p><pre class="programlisting">
# from AgentTicketHistory.dtl
$TimeLong{"$Data{"CreateTime"}"}

# Result for US English locale:
06/09/2010 15:45:41
                    </pre><p>

                    First, the data is inserted from the application module with <code class="literal">$Data</code>.
                    Here always an ISO UTC timestamp (2010-06-09 15:45:41) must be passed as data to
                    <code class="literal">$TimeLong{""}</code>. Then <code class="literal">$TimeLong{""}</code> will
                    take that data and output it according to the date/time definition of the current
                    locale.
                </p><p>
                    The data passed to <code class="literal">$TimeLong{""}</code> must be UTC. If a time zone offset
                    is specified for the current agent, it will be applied to the UTC timestamp before
                    the output is generated.
                </p></div><div class="section" title='$TimeShort{""}'><div class="titlepage"><div><div><h6 class="title"><a name="timeshort"></a>$TimeShort{""}</h6></div></div></div><p>
                    Works like <a class="link" href="hacking.html#timelong" title='$TimeLong{""}'><code class="literal">$TimeLong{""}</code></a>,
                    but does not output the seconds.

                    </p><pre class="programlisting">
$TimeShort{"$Data{"CreateTime"}"}

# Result for US English locale:
06/09/2010 15:45
                    </pre><p>
                </p></div><div class="section" title='$Date{""}'><div class="titlepage"><div><div><h6 class="title"><a name="date"></a>$Date{""}</h6></div></div></div><p>
                    Works like <a class="link" href="hacking.html#timelong" title='$TimeLong{""}'><code class="literal">$TimeLong{""}</code></a>,
                    but outputs only the date, not the time.

                    </p><pre class="programlisting">
$Date{"$Data{"CreateTime"}"}

# Result for US English locale:
06/09/2010
                    </pre><p>
                </p></div></div><div class="section" title="Template Processing Commands"><div class="titlepage"><div><div><h5 class="title"><a name="idp12075840"></a>Template Processing Commands</h5></div></div></div><div class="section" title="Comment"><div class="titlepage"><div><div><h6 class="title"><a name="Comment"></a>Comment</h6></div></div></div><p>
                    The dtl comment starts with a # at the beginning of a line and will not be
                    shown in the html output. This can be used both for commenting the DTL (=Template) code
                    or for disabling parts of it.

                    </p><pre class="programlisting">
# this section is temporarily disabled
# &lt;div class="AsBlock"&gt;
#     &lt;a href="..."&gt;link&lt;/a&gt;
# &lt;/div&gt;
                    </pre><p>
                </p></div><div class="section" title='$Include{""}'><div class="titlepage"><div><div><h6 class="title"><a name="include"></a>$Include{""}</h6></div></div></div><p>
                    Includes another template file into the current one. The included file may also contain
                    template commands.

                    </p><pre class="programlisting">
# include Copyright.dtl
$Include{"Copyright"}
                    </pre><p>
                </p></div><div class="section" title="dtl:block"><div class="titlepage"><div><div><h6 class="title"><a name="block"></a>dtl:block</h6></div></div></div><p>
                    With this command, one can specify parts of a template file as a block. This block
                    needs to be explicitly filled with a function call from the application, to be
                    present in the generated output. The application can call the block 0 (it will not
                    be present in the output), 1 or more times (each with possibly a different set of
                    data parameters passed to the template).
                </p><p>
                    One common use case is the filling of a table with dynamic data:

                    </p><pre class="programlisting">
&lt;table class="DataTable"&gt;
    &lt;thead&gt;
        &lt;tr&gt;
            &lt;th&gt;$Text{"Name"}&lt;/th&gt;
            &lt;th&gt;$Text{"Type"}&lt;/th&gt;
            &lt;th&gt;$Text{"Comment"}&lt;/th&gt;
            &lt;th&gt;$Text{"Valid"}&lt;/th&gt;
            &lt;th&gt;$Text{"Changed"}&lt;/th&gt;
            &lt;th&gt;$Text{"Created"}&lt;/th&gt;
        &lt;/tr&gt;
    &lt;/thead&gt;
    &lt;tbody&gt;
&lt;!-- dtl:block:NoDataFoundMsg --&gt;
        &lt;tr&gt;
            &lt;td colspan="6"&gt;
                $Text{"No data found."}
            &lt;/td&gt;
        &lt;/tr&gt;
&lt;!-- dtl:block:NoDataFoundMsg --&gt;
&lt;!-- dtl:block:OverviewResultRow --&gt;
        &lt;tr&gt;
            &lt;td&gt;&lt;a class="AsBlock" href="$Env{"Baselink"}Action=$Env{"Action"};Subaction=Change;ID=$LQData{"ID"}"&gt;$QData{"Name"}&lt;/a&gt;&lt;/td&gt;
            &lt;td&gt;$Text{"$Data{"TypeName"}"}&lt;/td&gt;
            &lt;td title="$QData{"Comment"}"&gt;$QData{"Comment","20"}&lt;/td&gt;
            &lt;td&gt;$Text{"$Data{"Valid"}"}&lt;/td&gt;
            &lt;td&gt;$TimeShort{"$QData{"ChangeTime"}"}&lt;/td&gt;
            &lt;td&gt;$TimeShort{"$QData{"CreateTime"}"}&lt;/td&gt;
        &lt;/tr&gt;
&lt;!-- dtl:block:OverviewResultRow --&gt;
    &lt;/tbody&gt;
&lt;/table&gt;
                    </pre><p>

                    The surrounding table with the header is always generated.
                    If no data was found, the block <code class="literal">NoDataFoundMsg</code> is called
                    once, resulting in a table with one data row with the message "No data found."
                </p><p>
                    If data was found, for each row there is one function call made for the
                    block <code class="literal">OverViewResultRow</code> (each time passing in the data
                    for this particular row), resulting in a table with
                    as many data rows as results were found.
                </p><p>
                    Let's look at how the blocks are called from the application module:

                    </p><pre class="programlisting">
 my %List = $Self-&gt;{StateObject}-&gt;StateList(
    UserID =&gt; 1,
    Valid  =&gt; 0,
);

# if there are any states, they are shown
if (%List) {

    # get valid list
    my %ValidList = $Self-&gt;{ValidObject}-&gt;ValidList();
    for ( sort { $List{$a} cmp $List{$b} } keys %List ) {

        my %Data = $Self-&gt;{StateObject}-&gt;StateGet( ID =&gt; $_, );
        $Self-&gt;{LayoutObject}-&gt;Block(
            Name =&gt; 'OverviewResultRow',
            Data =&gt; {
                Valid =&gt; $ValidList{ $Data{ValidID} },
                %Data,
            },
        );
    }
}

# otherwise a no data found msg is displayed
else {
    $Self-&gt;{LayoutObject}-&gt;Block(
        Name =&gt; 'NoDataFoundMsg',
        Data =&gt; {},
    );
}
                    </pre><p>

                    Note how the blocks have both their name and an optional set of data
                    passed in as separate parameters to the block function call. Data inserting
                    commands inside a block always need the data provided to the block function
                    call of this block, not the <a class="link" href="hacking.html#using-templates" title="Using a template file">general template
                    rendering call</a>.
                </p><p>
                    For details, please refer to the documentation of <code class="literal">Kernel::Output::HTML::Layout</code>
                    on <a class="ulink" href="http://dev.otrs/org" target="_top">dev.otrs.org</a>.
                </p></div></div><div class="section" title="dtl:js_on_document_complete"><div class="titlepage"><div><div><h5 class="title"><a name="idp7312592"></a>dtl:js_on_document_complete</h5></div></div></div><p>
                Marks JavaScript code which should be executed after all CSS, JavaScript
                and other external content has been loaded and the basic JavaScript initialization
                was finished. Again, let's look at an example:

                </p><pre class="programlisting">
&lt;form title="$Text{"Move ticket to a different queue"}" action="$Env{"CGIHandle"}" method="get"&gt;
    &lt;input type="hidden" name="Action" value="AgentTicketMove"/&gt;
    &lt;input type="hidden" name="QueueID" value="$QData{"QueueID"}"/&gt;
    &lt;input type="hidden" name="TicketID" value="$QData{"TicketID"}"/&gt;
    &lt;label for="DestQueueID" class="InvisibleText"&gt;$Text{"Change queue"}:&lt;/label&gt;
    $Data{"MoveQueuesStrg"}
&lt;/form&gt;
&lt;!-- dtl:js_on_document_complete --&gt;
&lt;script type="text/javascript"&gt;
    $('#DestQueueID').bind('change', function (Event) {
        $(this).closest('form').submit();
    });
&lt;/script&gt;
&lt;!-- dtl:js_on_document_complete --&gt;
                </pre><p>

                This snippet creates a small form and puts an onchange-Handler on the
                &lt;select&gt; element which causes and automatical form submit.
            </p><p>
                Why is it neccessary to enclose the JavaScript code in
                <code class="literal">dtl:js_on_document_complate</code>?
                Starting with OTRS 3.0, JavaScript loading was
                moved to the footer part of the page for performance reasons. This means that
                within the &lt;body&gt; of the page, no JavaScript libraries are loaded yet.
                With <code class="literal">dtl:js_on_document_complete</code> you can make sure that this
                JavaScript is moved to a part of the final HTML document, where it will be
                executed only after the entire external JavaScript and CSS content has been
                successfully loaded and initialized.
            </p><p>
                Inside the <code class="literal">dtl:js_on_document_complete</code> block, you can use
                &lt;script&gt; tags to enclose your JavaScript code, but you do not have to do so.
                It may be beneficial because it will enable correct syntax highlighting in IDEs
                which support it.
            </p></div></div><div class="section" title="Using a template file"><div class="titlepage"><div><div><h4 class="title"><a name="using-templates"></a>Using a template file</h4></div></div></div><p>
            Ok, but how to actually process a template file and generate the result? This is really simple:

            </p><pre class="programlisting">
# render AdminState.dtl
$Output .= $Self-&gt;{LayoutObject}-&gt;Output(
    TemplateFile =&gt; 'AdminState',
    Data         =&gt; \%Param,
);
            </pre><p>

            In the frontend modules, the <code class="literal">Output()</code> function of
            <code class="literal">Kernel::Output::HTML::Layout</code> is called (after all the needed blocks
            have been called in this template) to generate the final output. An optional set of
            data parameters is passed to the template, for all data inserting commands which are not
            inside of a block.
        </p></div></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="architecture-overview.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="how-to-extend.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Architecture Overview </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> How to Extend it</td></tr></table></div></body></html>
