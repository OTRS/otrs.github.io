<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
       "http://www.w3.org/TR/html4/loose.dtd">
<html lang="de">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Использование внешних хранилищ данных</title>
    <meta name="description" content="">
    <meta name="author" content="OTRS Group">
    <meta http-equiv="X-UA-Compatible" content="edge">
    <link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
    <link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="../../../../doku.reset.css">
    <link rel="stylesheet" href="../../../../doku.design.css">
</head>
<body>
<div class="doconline">
    <div id="wrapper">
        <a id="logo" title="OTRS Documentation" href="http://doc.otrs.org/">Documentation</a>
        <div id="content">
            <div id="marginalia_wrapper">
                <ul id="marginalia"><li><a href="#">Admin Manual</a><ul><li><a href="#">OTRS 3.3</a><ul><li><a href="#">English</a><ul><li><a href="../../../../admin/3.3/en/html/index.html">HTML</a></li><li><a href="http://ftp.otrs.org/pub/otrs/doc/doc-admin/3.3/en/pdf/otrs_admin_book.pdf">PDF</a></li></ul></li></ul></li></ul></li></ul>
                <form action="http://www.google.com/cse" id="search">
                    <div>
                        <input type="hidden" value="016655303084217971695:zg-eih1lc60" name="cx">
                        <input type="hidden" value="UTF-8" name="ie">
                        <input type="text" name="q" value="" class="searchinput">
                        <input type="submit" name="sa" value="Search" class="searchsubmit">
                    </div>
                </form>
            </div>
            <div id="doc">
<!-- Start OriginalBodyContent -->
<div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Использование внешних хранилищ данных</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="email-settings.html">Пред.</a> </td><th width="60%" align="center">Глава 4. Администрирование</th><td width="20%" align="right"> <a accesskey="n" href="ticket-settings.html">След.</a></td></tr></table><hr></div><div class="section" title="Использование внешних хранилищ данных"><div class="titlepage"><div><div><h2 class="title"><a name="external-backends"></a>Использование внешних хранилищ данных</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="external-backends.html#customer-data">Данные клиентов</a></span></dt><dt><span class="section"><a href="external-backends.html#customer-user-backend">Пользовательский бэк-енд</a></span></dt><dd><dl><dt><span class="section"><a href="external-backends.html#customer-backend-db">База Данных (По умолчанию)</a></span></dt><dd><dl><dt><span class="section"><a href="external-backends.html#multi-customer-ids-db">Клиент с несколькими идентификаторами (Заявки Компании)</a></span></dt></dl></dd><dt><span class="section"><a href="external-backends.html#customer-backend-ldap">LDAP</a></span></dt><dd><dl><dt><span class="section"><a href="external-backends.html#multi-customer-ids-ldap">Клиент с несколькими идентификаторами (Заявки Компании)</a></span></dt></dl></dd><dt><span class="section"><a href="external-backends.html#multiple-customer-backends">Использование больше чем одного пользовательского хранилища данных с OTRS</a></span></dt></dl></dd><dt><span class="section"><a href="external-backends.html#auth-backends">Хранилища (бэк-енды) для аутентификации Агентов и Клиентов</a></span></dt><dd><dl><dt><span class="section"><a href="external-backends.html#agent-auth-backends">Хранилища данных (бэк-енды) для аутентификации Агентов</a></span></dt><dd><dl><dt><span class="section"><a href="external-backends.html#agent-auth-backend-db">База Данных (DB, по умаолчанию)</a></span></dt><dt><span class="section"><a href="external-backends.html#agent-auth-backend-ldap">LDAP</a></span></dt><dt><span class="section"><a href="external-backends.html#agent-auth-backend-httpbasic">HTTPBasicAuth-аутентификация для Агентов</a></span></dt><dt><span class="section"><a href="external-backends.html#agent-auth-backend-radius">Radius</a></span></dt></dl></dd><dt><span class="section"><a href="external-backends.html#customer-auth-backends">Хранилища информации для аутентификации (проверки подлинности) клиентов</a></span></dt><dd><dl><dt><span class="section"><a href="external-backends.html#customer-auth-backend-db">База Данных (По умолчанию)</a></span></dt><dt><span class="section"><a href="external-backends.html#customer-auth-backend-ldap">LDAP</a></span></dt><dt><span class="section"><a href="external-backends.html#customer-auth-backend-httpbasic">HTTPBasicAuth аутентификация для клиентов</a></span></dt><dt><span class="section"><a href="external-backends.html#customer-auth-backend-radius">Radius</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="external-backends.html#customer-self-registration">Настройка самостоятельной регистрации клиента</a></span></dt><dd><dl><dt><span class="section"><a href="external-backends.html#customer-self-registration-dtl">Настройка веб-интерфейса</a></span></dt><dt><span class="section"><a href="external-backends.html#customer-self-registration-mapping">Отображения клиентов</a></span></dt><dt><span class="section"><a href="external-backends.html#customer-self-registration-customer-table">Настройка таблицы customer_user в Базе Данных OTRS DB</a></span></dt></dl></dd></dl></div><div class="section" title="Данные клиентов"><div class="titlepage"><div><div><h3 class="title"><a name="customer-data"></a>Данные клиентов</h3></div></div></div><p>
OTRS работает с различными атрибутами данных клиентов, такими как имя
пользователя, адрес электронной почты, номер телефона и т.д. Эти атрибуты
отображаются в обеих фронтэндах, для Агентов и Клиентов. Они также
используются для проверки подлинности клиентов.
</p><p>
Данные клиентов, которые используются и отображаются в OTRS очень легко
настраиваются. Несмотря на это следующая информация будет всегда необходима
для проверки подлинности клиента:
</p><p>
</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>
      Вход пользователей
    </p></li><li class="listitem"><p>
      Адресс электронной почты
    </p></li><li class="listitem"><p>
      ID Клиента
    </p></li></ul></div><p>
</p><p>
Use the configuration parameters of the following script in your
<code class="filename">Kernel/Config.pm</code> file, if you want to display customer
information in your agent interface.
</p><p>
</p><pre class="programlisting">
    # Ticket::Frontend::CustomerInfo*
    # (show customer info on Compose (Phone and Email), Zoom and
    # Queue view)
    $Self-&gt;{'Ticket::Frontend::CustomerInfoCompose'} = 1;
    $Self-&gt;{'Ticket::Frontend::CustomerInfoZoom'} = 1;
</pre><p>
</p><p>
<span class="emphasis"><em>Сценарий: Конфигурационные параметры Kernel/Config.pm.</em></span>
</p></div><div class="section" title="Пользовательский бэк-енд"><div class="titlepage"><div><div><h3 class="title"><a name="customer-user-backend"></a>Пользовательский бэк-енд</h3></div></div></div><p>
Вы можете использоваь два типа хранилища информации клиентов: Базу Данных DB
и LDAP. Если у вас уже есть другой бэк-енд для хранения пользовательской
информации (например SAP), также есть возможность написать модуль для
использования этой функции.
</p><div class="section" title="База Данных (По умолчанию)"><div class="titlepage"><div><div><h4 class="title"><a name="customer-backend-db"></a>База Данных (По умолчанию)</h4></div></div></div><p>
В Примере 11-1 приведена конфигурация базы данных, которая использует данные
клиента, хранящиеся в базе данных OTRS.
</p><div class="example"><a name="db-customer-backend"></a><p class="title"><b>Пример 4.5. Настройка клиентского хранилища базы данных (DB)</b></p><div class="example-contents"><p>
</p><pre class="programlisting">
# CustomerUser (customer database backend and settings)
$Self-&gt;{CustomerUser} = {
    Name =&gt; 'Database Datasource',
    Module =&gt; 'Kernel::System::CustomerUser::DB',
    Params =&gt; {
        # if you want to use an external database, add the required settings
#            DSN =&gt; 'DBI:odbc:yourdsn',
#            Type =&gt; 'mssql', # only for ODBC connections
#            DSN =&gt; 'DBI:mysql:database=customerdb;host=customerdbhost',
#            User =&gt; '',
#            Password =&gt; '',
            Table =&gt; 'customer_user',
            # if your frontend is unicode and the charset of your
            # customer database server is iso-8859-1, use these options.
#           SourceCharset =&gt; 'iso-8859-1',
#           DestCharset =&gt; 'utf-8',

            # CaseSensitive will control if the SQL statements need LOWER()
            #   function calls to work case insensitively. Setting this to
            #   1 will improve performance dramatically on large databases.
            CaseSensitive =&gt; 0,
        },
# customer unique id
CustomerKey =&gt; 'login',

# customer #
CustomerID =&gt; 'customer_id',
CustomerValid =&gt; 'valid_id',
    CustomerUserListFields =&gt; ['first_name', 'last_name', 'email'],
    CustomerUserSearchFields =&gt; ['login', 'last_name', 'customer_id'],
    CustomerUserSearchPrefix =&gt; '',
    CustomerUserSearchSuffix =&gt; '*',
    CustomerUserSearchListLimit =&gt; 250,
    CustomerUserPostMasterSearchFields =&gt; ['email'],
    CustomerUserNameFields =&gt; ['title','first_name','last_name'],
    CustomerUserEmailUniqCheck =&gt; 1,
#    # show not own tickets in customer panel, CompanyTickets
#    CustomerUserExcludePrimaryCustomerID =&gt; 0,
#    # generate auto logins
#    AutoLoginCreation =&gt; 0,
#    AutoLoginCreationPrefix =&gt; 'auto',
#    # admin can change customer preferences
#    AdminSetPreferences =&gt; 1,
#    # cache time to live in sec. - cache any database queries
#    CacheTTL =&gt; 0,
#    # just a read only source
#    ReadOnly =&gt; 1,
    Map =&gt; [
        # note: Login, Email and CustomerID needed!
        # var, frontend, storage, shown (1=always,2=lite), required, storage-type, http-link, readonly, http-link-target
        [ 'UserTitle',      'Title',      'title',      1, 0, 'var', '', 0 ],
        [ 'UserFirstname',  'Firstname',  'first_name', 1, 1, 'var', '', 0 ],
        [ 'UserLastname',   'Lastname',   'last_name',  1, 1, 'var', '', 0 ],
        [ 'UserLogin',      'Username',   'login',      1, 1, 'var', '', 0 ],
        [ 'UserPassword',   'Password',   'pw',         0, 0, 'var', '', 0 ],
        [ 'UserEmail',      'Email',      'email',      1, 1, 'var', '', 0 ],

#        [ 'UserEmail',      'Email', 'email',           1, 1, 'var', '$Env{"CGIHandle"}?Action=AgentTicketCompose&amp;ResponseID=1&amp;TicketID=$Data{"TicketID"}&amp;ArticleID=$Data{"ArticleID"}', 0 ],
        [ 'UserCustomerID', 'CustomerID', 'customer_id', 0, 1, 'var', '', 0 ],

#        [ 'UserCustomerIDs', 'CustomerIDs', 'customer_ids', 1, 0, 'var', '', 0 ],
        [ 'UserPhone',        'Phone',       'phone',        1, 0, 'var', '', 0 ],
        [ 'UserFax',          'Fax',         'fax',          1, 0, 'var', '', 0 ],
        [ 'UserMobile',       'Mobile',      'mobile',       1, 0, 'var', '', 0 ],
        [ 'UserStreet',       'Street',      'street',       1, 0, 'var', '', 0 ],
        [ 'UserZip',          'Zip',         'zip',          1, 0, 'var', '', 0 ],
        [ 'UserCity',         'City',        'city',         1, 0, 'var', '', 0 ],
        [ 'UserCountry',      'Country',     'country',      1, 0, 'var', '', 0 ],
        [ 'UserComment',      'Comment',     'comments',     1, 0, 'var', '', 0 ],
        [ 'ValidID',          'Valid',       'valid_id',     0, 1, 'int', '', 0 ],
    ],
    # default selections
    Selections =&gt; {
        UserTitle =&gt; {
            'Mr.' =&gt; 'Mr.',
            'Mrs.' =&gt; 'Mrs.',
        },
    },
};
</pre><p>
</p></div></div><br class="example-break"><p>
Если нужно настроить данные клиентов, измените заголовки столбцов или
добавьте новые к таблице customer_user базы данных OTRS. В качестве примера
используйте нижеприведенный сценарий, в котором показано как добавить новое
поле для номера комнаты.
</p><p>
</p><pre class="screen">
linux:~# mysql -p
Enter password:
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 116 to server version: 5.0.18-Debian_7-log

Type 'help;' or '\h' for help. Type '\c' to clear the buffer.

mysql&gt; use otrs;
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
mysql&gt; ALTER TABLE customer_user ADD room VARCHAR (250);
Query OK, 1 rows affected (0.01 sec)
Records: 1  Duplicates: 0  Warnings: 0

mysql&gt; quit
Bye
linux:~#
</pre><p>
</p><p>
<span class="emphasis"><em>Сценарий: Добавление поля "комната" в таблицу customer_user
table. </em></span>
</p><p>
Теперь добавьте новый столбец в MAP-масив в
<code class="filename">Kernel/Config.pm</code>, как это показано в нижеприведенном
сценарии.
</p><p>
</p><pre class="programlisting">
    # var, frontend, storage, shown (1=always,2=lite), required, storage-type, http-link, readonly
    [...]
    [ 'UserRoom',      'Room',      'room',       0, 1, 'var', '', 0 ],
</pre><p>
</p><p>
<span class="emphasis"><em>Сценарий: Добавление поля "комната" в файл Kernel/Config.pm
file.</em></span>
</p><p>
It is also possible to edit all of this customer information via the
Customers link in the Agent interface.
</p><div class="section" title="Клиент с несколькими идентификаторами (Заявки Компании)"><div class="titlepage"><div><div><h5 class="title"><a name="multi-customer-ids-db"></a>Клиент с несколькими идентификаторами (Заявки Компании)</h5></div></div></div><p>
Одному клиенту можно назначить больше одного клиентского идентификатора
(Customer ID). Это может быть полезно, если клиенту необходимо получить
доступ к заявкам других  клиентов, например, руководитель хочет посмотреть
заявки своих помощников. Если клиент может получить доступ к заявкам другого
клиента, то используется особенность OTRS "заявки компании". Заявки компании
могут быть доступны перейдя по ссылке "Заявки Компании" в клиентской панели
управления.
</p><p>
Для использованя заявок компании, новый столбец с идентификатором (IDs),
который должен быть доступен для клиента, должен быть добавлен в таблицу
customer_user базы данных OTRS (см. Сценарий ниже).
</p><p>
</p><pre class="screen">
linux:~# mysql -p
Enter password:
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 124 to server version: 5.0.18-Debian_7-log

Type 'help;' or '\h' for help. Type '\c' to clear the buffer.

mysql&gt; use otrs;
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
mysql&gt; ALTER TABLE customer_user ADD customer_ids VARCHAR (250);
Query OK, 1 rows affected (0.02 sec)
Records: 1  Duplicates: 0  Warnings: 0

mysql&gt; quit
Bye
linux:~#
</pre><p>
</p><p>
    <span class="emphasis"><em>Сценарий: Добавление поля customer_ids в таблицу
customer_user.</em></span>
</p><p>
Теперь новый столбец должен быть добавлен в MAP-массив в
<code class="filename">Kernel/Config.pm</code>, как это показано в нижеприведенном
Сценарии.
</p><p>
</p><pre class="programlisting">
    # var, frontend, storage, shown (1=always,2=lite), required, storage-type, http-link, readonly
    [...]
    [ 'UserCustomerIDs', 'CustomerIDs', 'customer_ids', 1, 0, 'var', '', 0 ],
</pre><p>
</p><p>
<span class="emphasis"><em>Сценарий: Добавление поля UserCustomerIDs в
Kernel/Config.pm</em></span>
</p><p>
Теперь, новый столбец для мульти-идентификатора ( IDs) клиента можно
редактировать с помощью веб-интерфейса Агента, в разделе управления
клиентами.
</p><p>
Для того, чтобы убедится что один клиент имеет доступ к заявкам других
клиентов нужно добавить идентификаторы (IDs) этих пользователей в новое поле
для нескольких идентификаторов клиента. Каждый идентификатор (ID) должен
быть отделен точкой с запятой (см. ниже Пример 11-2).
</p><div class="example"><a name="company-tickets-db"></a><p class="title"><b>Пример 4.6. Хранение Заявок Компании в базе данных DB</b></p><div class="example-contents"><p>
Клиенты А, Б и Ц созданы в вашей системе и А хочет иметь доступ к заявкам Б
и Ц используя клиентскую панель. Б и Ц не должны иметь доступа к заявкам
других пользователей.
</p><p>
Для реализации этой структуры, измените таблицу customer_user и маппинг
(преобразование) в <code class="filename">Kernel/Config.pm</code> как это показано
выше. С помощью Панели Администрирования или используя ссылку Клиенты в
веб-интерфейсе Агента загрузите настройки пользователя А. Если настройки
отображаются, добавьте значения "Б;Ц;" в поле для CustomerIDs.
</p></div></div><br class="example-break"></div></div><div class="section" title="LDAP"><div class="titlepage"><div><div><h4 class="title"><a name="customer-backend-ldap"></a>LDAP</h4></div></div></div><p>
Если у вас есть LDAP­-каталог, в котором хранятся данные о клиентах, его
можно использовать в OTRS, в качестве хранилища данных о клиентах, как это
показано в Примере 11-3.
</p><div class="example"><a name="ldap-customer-backend"></a><p class="title"><b>Пример 4.7. Настройка LDAP в качестве клиентского бэк-енда</b></p><div class="example-contents"><p>
</p><pre class="programlisting">
# CustomerUser
# (customer ldap backend and settings)
$Self-&gt;{CustomerUser} = {
    Name =&gt; 'LDAP Data Source',
    Module =&gt; 'Kernel::System::CustomerUser::LDAP',
    Params =&gt; {
        # ldap host
        Host =&gt; 'bay.csuhayward.edu',
        # ldap base dn
        BaseDN =&gt; 'ou=seas,o=csuh',
        # search scope (one|sub)
        SSCOPE =&gt; 'sub',
        # The following is valid but would only be necessary if the
        # anonymous user does NOT have permission to read from the LDAP tree
        UserDN =&gt; '',
        UserPw =&gt; '',
        # in case you want to add always one filter to each ldap query, use
        # this option. e. g. AlwaysFilter =&gt; '(mail=*)' or AlwaysFilter =&gt; '(objectclass=user)'
        AlwaysFilter =&gt; '',
            # if both your frontend and your LDAP are unicode, use this:
            SourceCharset =&gt; 'utf-8',
            DestCharset   =&gt; 'utf-8',
            # if your frontend is unicode and the charset of your
            # ldap server is iso-8859-1, use these options.
            # SourceCharset =&gt; 'iso-8859-1',
            # DestCharset =&gt; 'utf-8',
            # Net::LDAP new params (if needed - for more info see perldoc Net::LDAP)
            Params =&gt; {
                port =&gt; 389,
                timeout =&gt; 120,
                async =&gt; 0,
                version =&gt; 3,
            },
    },
    # customer unique id
    CustomerKey =&gt; 'uid',
    # customer #
    CustomerID =&gt; 'mail',
    CustomerUserListFields =&gt; ['cn', 'mail'],
    CustomerUserSearchFields =&gt; ['uid', 'cn', 'mail'],
    CustomerUserSearchPrefix =&gt; '',
    CustomerUserSearchSuffix =&gt; '*',
    CustomerUserSearchListLimit =&gt; 250,
    CustomerUserPostMasterSearchFields =&gt; ['mail'],
    CustomerUserNameFields =&gt; ['givenname', 'sn'],
    # show not own tickets in customer panel, CompanyTickets
    CustomerUserExcludePrimaryCustomerID =&gt; 0,
    # add an ldap filter for valid users (expert setting)
#    CustomerUserValidFilter =&gt; '(!(description=locked))',
    # administrator can't change customer preferences
    AdminSetPreferences =&gt; 0,
#    # cache time to live in sec. - cache any database queries
#    CacheTTL =&gt; 0,
    Map =&gt; [
        # note: Login, Email and CustomerID are mandatory!
        # var, frontend, storage, shown (1=always,2=lite), required, storage-type, http-link, readonly
        [ 'UserTitle',      'Title',      'title',           1, 0, 'var', '', 0 ],
        [ 'UserFirstname',  'Firstname',  'givenname',       1, 1, 'var', '', 0 ],
        [ 'UserLastname',   'Lastname',   'sn',              1, 1, 'var', '', 0 ],
        [ 'UserLogin',      'Username',   'uid',             1, 1, 'var', '', 0 ],
        [ 'UserEmail',      'Email',      'mail',            1, 1, 'var', '', 0 ],
        [ 'UserCustomerID', 'CustomerID', 'mail',            0, 1, 'var', '', 0 ],
#        [ 'UserCustomerIDs', 'CustomerIDs', 'second_customer_ids', 1, 0, 'var', '', 0 ],
        [ 'UserPhone',      'Phone',      'telephonenumber', 1, 0, 'var', '', 0 ],
        [ 'UserAddress',    'Address',    'postaladdress',   1, 0, 'var', '', 0 ],
        [ 'UserComment',    'Comment',    'description',     1, 0, 'var', '', 0 ],
    ],
};
</pre><p>
</p></div></div><br class="example-break"><p>
Если дополнительные атрибуты клиента хранятся в LDAP-каталоге, например, имя
руководителя, номер мобильного телефона, или отдела, и если эту информацию
нужно отобразить в OTRS, просто расширьте MAP-массив в файле
<code class="filename">Kernel/Config.pm</code> записями для этих атрибутов, как
показано в нижеприведенном сценарии.
</p><p>
</p><pre class="programlisting">
    # var, frontend, storage, shown (1=always,2=lite), required, storage-type, http-link, readonly
    [...]
    [ 'UserPhone',      'Phone',      'telephonenumber', 1, 0, 'var', '', 0 ],
</pre><p>
</p><p>
<span class="emphasis"><em>Сценарий: Добавление нового поля в файл
Kernel/Config.pm.</em></span>
</p><div class="section" title="Клиент с несколькими идентификаторами (Заявки Компании)"><div class="titlepage"><div><div><h5 class="title"><a name="multi-customer-ids-ldap"></a>Клиент с несколькими идентификаторами (Заявки Компании)</h5></div></div></div><p>
При использовании LDAP-бэкэнда клиенту можно присвоить больше одного
клиентского айди (Customer ID). Для использования заявок компании, в
LDAP-директорию нужно добавить новое поле, которое содержит доступные агенту
идентификаторы (IDs).
</p><p>
Если в LDAP-каталоге было созадно новое поле, его также нужно добавить в
MAP-массив в <code class="filename">Kernel/Config.pm</code>, как это показано в
нижеприведенном сценарии.
</p><p>
</p><pre class="programlisting">
    # var, frontend, storage, shown (1=always,2=lite), required, storage-type, http-link, readonly
    [...]
    [ 'UserCustomerIDs', 'CustomerIDs', 'customer_ids', 1, 0, 'var', '', 0 ],
</pre><p>
</p><p>
<span class="emphasis"><em>Сценарий: Подстановка новых полей в Kernel/Config.pm
file.</em></span>
</p><p>
Клиентские идентификаторы (IDs) можно редактировать напрямую в
LDAP-директории. OTRS может только считать информацию из LDAP, но не
записывать.
</p><p>
Чтобы убедтися что клиент имеет доступ к заявкам других клиентов, добавьте
идентификаторы (IDs) клиентов, к заявкам которых нужен доступ, к новому полю
вашей LDAP-директории. Каждый идентификатор ID должен быть отделен точнкой с
запятой (см. ниже Рисунок 11-4).
</p><div class="example"><a name="company-tickets-ldap"></a><p class="title"><b>Пример 4.8. Использование заявок Компании с LDAP-бэкэндом</b></p><div class="example-contents"><p>
Клиенты А, Б и Ц созданны в вашей системе и А хочет иметь доступ к заявкам Б
и Ц через панель клиента. Б и Ц не должны иметь доступа к другим
пользователям.
</p><p>
Для реализации этой установки измените LDAP-директорию и маппинг (mapping) в
<code class="filename">Kernel/Config.pm</code>, как это показано выше. Затем добавьте
в вашей LDAP-директории значения "Б;Ц;" в поле для CustomerIDs, для клиента
"А".
</p></div></div><br class="example-break"></div></div><div class="section" title="Использование больше чем одного пользовательского хранилища данных с OTRS"><div class="titlepage"><div><div><h4 class="title"><a name="multiple-customer-backends"></a>Использование больше чем одного пользовательского хранилища данных с OTRS</h4></div></div></div><p>
Если в OTRS нужно использовать больше одного источника данных о клиентах
(например LDAP и базу данных), конфигурационный параметр CustomerUser должен
быть расширен числом, например "CustomerUser1", "CustomerUser2" (см. ниже
Пример 11-5).
</p><div class="example"><a name="multiple-customer-backend-example"></a><p class="title"><b>Пример 4.9. Использование больше чем одного пользовательского хранилища данных с OTRS</b></p><div class="example-contents"><p>
В следующем примере показано применение конфигурации как для LDAP так и для
базы данных клиентского бэкэнда с OTRS.
</p><p>
</p><pre class="programlisting">
# 1. Customer user backend: DB
# (customer database backend and settings)
$Self-&gt;{CustomerUser1} = {
    Name =&gt; 'Customer Database',
    Module =&gt; 'Kernel::System::CustomerUser::DB',
    Params =&gt; {
        # if you want to use an external database, add the
        # required settings
#        DSN =&gt; 'DBI:odbc:yourdsn',
#        Type =&gt; 'mssql', # only for ODBC connections
#        DSN =&gt; 'DBI:mysql:database=customerdb;host=customerdbhost',
#        User =&gt; '',
#        Password =&gt; '',
        Table =&gt; 'customer_user',
    },
    # customer unique id
    CustomerKey =&gt; 'login',
    # customer #
    CustomerID =&gt; 'customer_id',
    CustomerValid =&gt; 'valid_id',
    CustomerUserListFields =&gt; ['first_name', 'last_name', 'email'],
    CustomerUserSearchFields =&gt; ['login', 'last_name', 'customer_id'],
    CustomerUserSearchPrefix =&gt; '',
    CustomerUserSearchSuffix =&gt; '*',
    CustomerUserSearchListLimit =&gt; 250,
    CustomerUserPostMasterSearchFields =&gt; ['email'],
    CustomerUserNameFields =&gt; ['title','first_name','last_name'],
    CustomerUserEmailUniqCheck =&gt; 1,
#    # show not own tickets in customer panel, CompanyTickets
#    CustomerUserExcludePrimaryCustomerID =&gt; 0,
#    # generate auto logins
#    AutoLoginCreation =&gt; 0,
#    AutoLoginCreationPrefix =&gt; 'auto',
#    # admin can change customer preferences
#    AdminSetPreferences =&gt; 1,
#    # cache time to live in sec. - cache any database queries
#    CacheTTL =&gt; 0,
#    # just a read only source
#    ReadOnly =&gt; 1,
    Map =&gt; [

        # note: Login, Email and CustomerID needed!
        # var, frontend, storage, shown (1=always,2=lite), required, storage-type, http-link, readonly, http-link-target
        [ 'UserTitle',      'Title',      'title',        1, 0, 'var', '', 0 ],
        [ 'UserFirstname',  'Firstname',  'first_name',   1, 1, 'var', '', 0 ],
        [ 'UserLastname',   'Lastname',   'last_name',    1, 1, 'var', '', 0 ],
        [ 'UserLogin',      'Username',   'login',        1, 1, 'var', '', 0 ],
        [ 'UserPassword',   'Password',   'pw',           0, 0, 'var', '', 0 ],
        [ 'UserEmail',      'Email',      'email',        1, 1, 'var', '', 0 ],
        [ 'UserCustomerID', 'CustomerID', 'customer_id',  0, 1, 'var', '', 0 ],
        [ 'UserPhone',      'Phone',      'phone',        1, 0, 'var', '', 0 ],
        [ 'UserFax',        'Fax',        'fax',          1, 0, 'var', '', 0 ],
        [ 'UserMobile',     'Mobile',     'mobile',       1, 0, 'var', '', 0 ],
        [ 'UserStreet',     'Street',     'street',       1, 0, 'var', '', 0 ],
        [ 'UserZip',        'Zip',        'zip',          1, 0, 'var', '', 0 ],
        [ 'UserCity',       'City',       'city',         1, 0, 'var', '', 0 ],
        [ 'UserCountry',    'Country',    'country',      1, 0, 'var', '', 0 ],
        [ 'UserComment',    'Comment',    'comments',     1, 0, 'var', '', 0 ],
        [ 'ValidID',        'Valid',      'valid_id',     0, 1, 'int', '', 0 ],
    ],
    # default selections
    Selections =&gt; {
        UserTitle =&gt; {
            'Mr.' =&gt; 'Mr.',
            'Mrs.' =&gt; 'Mrs.',
        },
    },
};

# 2. Customer user backend: LDAP
# (customer ldap backend and settings)
$Self-&gt;{CustomerUser2} = {
    Name =&gt; 'LDAP Datasource',
    Module =&gt; 'Kernel::System::CustomerUser::LDAP',
    Params =&gt; {
        # ldap host
        Host =&gt; 'bay.csuhayward.edu',
        # ldap base dn
        BaseDN =&gt; 'ou=seas,o=csuh',
        # search scope (one|sub)
        SSCOPE =&gt; 'sub',
#        # The following is valid but would only be necessary if the
#        # anonymous user does NOT have permission to read from the LDAP tree
        UserDN =&gt; '',
        UserPw =&gt; '',
        # in case you want to add always one filter to each ldap query, use
        # this option. e. g. AlwaysFilter =&gt; '(mail=*)' or AlwaysFilter =&gt; '(objectclass=user)'
        AlwaysFilter =&gt; '',
        # if both your frontend and your LDAP are unicode, use this:
#        SourceCharset =&gt; 'utf-8',
#        DestCharset   =&gt; 'utf-8',
        # if your frontend is e. g. iso-8859-1 and the character set of your
        # ldap server is utf-8, use these options:
#        SourceCharset =&gt; 'utf-8',
#        DestCharset =&gt; 'iso-8859-1',

        # Net::LDAP new params (if needed - for more info see perldoc Net::LDAP)
        Params =&gt; {
            port =&gt; 389,
            timeout =&gt; 120,
            async =&gt; 0,
            version =&gt; 3,
        },
    },
    # customer unique id
    CustomerKey =&gt; 'uid',
    # customer #
    CustomerID =&gt; 'mail',
    CustomerUserListFields =&gt; ['cn', 'mail'],
    CustomerUserSearchFields =&gt; ['uid', 'cn', 'mail'],
    CustomerUserSearchPrefix =&gt; '',
    CustomerUserSearchSuffix =&gt; '*',
    CustomerUserSearchListLimit =&gt; 250,
    CustomerUserPostMasterSearchFields =&gt; ['mail'],
    CustomerUserNameFields =&gt; ['givenname', 'sn'],
    # show not own tickets in customer panel, CompanyTickets
    CustomerUserExcludePrimaryCustomerID =&gt; 0,
    # add a ldap filter for valid users (expert setting)
#    CustomerUserValidFilter =&gt; '(!(description=locked))',
    # admin can't change customer preferences
    AdminSetPreferences =&gt; 0,
    Map =&gt; [
        # note: Login, Email and CustomerID needed!
        # var, frontend, storage, shown (1=always,2=lite), required, storage-type, http-link, readonly
        [ 'UserTitle',      'Title',      'title',           1, 0, 'var', '', 0 ],
        [ 'UserFirstname',  'Firstname',  'givenname',       1, 1, 'var', '', 0 ],
        [ 'UserLastname',   'Lastname',   'sn',              1, 1, 'var', '', 0 ],
        [ 'UserLogin',      'Username',   'uid',             1, 1, 'var', '', 0 ],
        [ 'UserEmail',      'Email',      'mail',            1, 1, 'var', '', 0 ],
        [ 'UserCustomerID', 'CustomerID', 'mail',            0, 1, 'var', '', 0 ],
#        [ 'UserCustomerIDs', 'CustomerIDs', 'second_customer_ids', 1, 0, 'var', '', 0 ],
        [ 'UserPhone',      'Phone',      'telephonenumber', 1, 0, 'var', '', 0 ],
        [ 'UserAddress',    'Address',    'postaladdress',   1, 0, 'var', '', 0 ],
        [ 'UserComment',    'Comment',    'description',     1, 0, 'var', '', 0 ],
    ],
};
</pre><p>
</p></div></div><br class="example-break"><p>
Есть возможность интегрировать до 10 различных пользовательских
бэк-эндов. Используйте интерфейс управления клиентами в OTRS, чтобы
просматривать и редактировать данные о них (при условии наличия прав для
записи).
</p></div></div><div class="section" title="Хранилища (бэк-енды) для аутентификации Агентов и Клиентов"><div class="titlepage"><div><div><h3 class="title"><a name="auth-backends"></a>Хранилища (бэк-енды) для аутентификации Агентов и Клиентов</h3></div></div></div><p>
OTRS предлагает опцию для проверки подлинности агентов и клиентов с
использованием различных хранилищ данных (бэкендов).
</p><div class="section" title="Хранилища данных (бэк-енды) для аутентификации Агентов"><div class="titlepage"><div><div><h4 class="title"><a name="agent-auth-backends"></a>Хранилища данных (бэк-енды) для аутентификации Агентов</h4></div></div></div><div class="section" title="База Данных (DB, по умаолчанию)"><div class="titlepage"><div><div><h5 class="title"><a name="agent-auth-backend-db"></a>База Данных (DB, по умаолчанию)</h5></div></div></div><p>
В качестве бэк-энда для аутентификации агентов в OTRS, по умолчанию,
используется база данных. Чтобы добавлять агентов, редактировать данные о
них, перейдите на страницу <a class="link" href="administration.html#adminarea" title="Панель управления OTRS">Панель
Администрирования</a> и нажмите ссылку <a class="link" href="administration.html#adminarea-agents" title="Агенты">Интерфейс для управления агентами</a>
(см. ниже Пример 11.6).
</p><div class="example"><a name="configuration-agent-auth-backend-db"></a><p class="title"><b>Пример 4.10. Проверка подлинности агентов путем использования Базы Данных (DB) в качестве
хранилища информации.</b></p><div class="example-contents"><p>
</p><pre class="programlisting">
    $Self-&gt;{'AuthModule'} = 'Kernel::System::Auth::DB';
</pre><p>
</p></div></div><br class="example-break"></div><div class="section" title="LDAP"><div class="titlepage"><div><div><h5 class="title"><a name="agent-auth-backend-ldap"></a>LDAP</h5></div></div></div><p>
Если данные всех ваших агентов хранятся в LDAP-директории, то для
аутентификации пользователей в OTRS можно использовать LDAP-модуль (см. ниже
Пример 11-7). Этот модуль имеет права только на чтение дерева
LDAP-каталогов, что означает что нету возможности редактировать данные
пользователей используя ссылку <a class="link" href="administration.html#adminarea-agents" title="Агенты">
веб-интерфейс для управления пользователями </a> .
</p><div class="example"><a name="configuration-agent-auth-backend-ldap"></a><p class="title"><b>Пример 4.11. Проверка подлинности агентов при использовании LDAP в качестве хранилища
данных</b></p><div class="example-contents"><p>
</p><pre class="programlisting">
# This is an example configuration for an LDAP auth. backend.
# (Make sure Net::LDAP is installed!)
$Self-&gt;{'AuthModule'} = 'Kernel::System::Auth::LDAP';
$Self-&gt;{'AuthModule::LDAP::Host'} = 'ldap.example.com';
$Self-&gt;{'AuthModule::LDAP::BaseDN'} = 'dc=example,dc=com';
$Self-&gt;{'AuthModule::LDAP::UID'} = 'uid';

# Check if the user is allowed to auth in a posixGroup
# (e. g. user needs to be in a group xyz to use otrs)
$Self-&gt;{'AuthModule::LDAP::GroupDN'} = 'cn=otrsallow,ou=posixGroups,dc=example,dc=com';
$Self-&gt;{'AuthModule::LDAP::AccessAttr'} = 'memberUid';
# for ldap posixGroups objectclass (just uid)
#  $Self-&gt;{'AuthModule::LDAP::UserAttr'} = 'UID';
# for non ldap posixGroups objectclass (with full user dn)
#  $Self-&gt;{'AuthModule::LDAP::UserAttr'} = 'DN';

# The following is valid but would only be necessary if the
# anonymous user do NOT have permission to read from the LDAP tree
$Self-&gt;{'AuthModule::LDAP::SearchUserDN'} = '';
$Self-&gt;{'AuthModule::LDAP::SearchUserPw'} = '';

# in case you want to add always one filter to each ldap query, use
# this option. e. g. AlwaysFilter =&gt; '(mail=*)' or AlwaysFilter =&gt; '(objectclass=user)'
$Self-&gt;{'AuthModule::LDAP::AlwaysFilter'} = '';

# in case you want to add a suffix to each login name, then
# you can use this option. e. g. user just want to use user but
# in your ldap directory exists user@domain.
#    $Self-&gt;{'AuthModule::LDAP::UserSuffix'} = '@domain.com';

# Net::LDAP new params (if needed - for more info see perldoc Net::LDAP)
$Self-&gt;{'AuthModule::LDAP::Params'} = {
    port =&gt; 389,
    timeout =&gt; 120,
    async =&gt; 0,
    version =&gt; 3,
};
</pre><p>
</p></div></div><br class="example-break"><p>
The configuration parameters shown in the script below can be used to
synchronize the user data from your LDAP directory into your local OTRS
database. This reduces the number of requests to your LDAP server and speeds
up the authentication with OTRS. The data synchronization is done when the
agent authenticates the first time. Although the data can be syncronized
into the local OTRS database, the LDAP directory is the last instance for
the authentication, so an inactive user in the LDAP tree can't authenticate
to OTRS, even when the account data is already stored in the OTRS
database. The agent data in the LDAP directory can't be edited via the web
interface of OTRS, so the data has to be managed directly in the LDAP tree.
</p><p>
</p><pre class="programlisting">
# defines AuthSyncBackend (AuthSyncModule) for AuthModule
# if this key exists and is empty, there won't be a sync.
# example values: AuthSyncBackend, AuthSyncBackend2
$Self-&gt;{'AuthModule::UseSyncBackend'} = 'AuthSyncBackend';

# agent data sync against ldap
$Self-&gt;{'AuthSyncModule'} = 'Kernel::System::Auth::Sync::LDAP';
$Self-&gt;{'AuthSyncModule::LDAP::Host'} = 'ldap://ldap.example.com/';
$Self-&gt;{'AuthSyncModule::LDAP::BaseDN'} = 'dc=otrs, dc=org';
$Self-&gt;{'AuthSyncModule::LDAP::UID'} = 'uid';
$Self-&gt;{'AuthSyncModule::LDAP::SearchUserDN'} = 'uid=sys, ou=user, dc=otrs, dc=org';
$Self-&gt;{'AuthSyncModule::LDAP::SearchUserPw'} = 'some_pass';
$Self-&gt;{'AuthSyncModule::LDAP::UserSyncMap'} = {
    # DB -&gt; LDAP
    UserFirstname =&gt; 'givenName',
    UserLastname  =&gt; 'sn',
    UserEmail     =&gt; 'mail',
};
[...]

# AuthSyncModule::LDAP::UserSyncInitialGroups
# (sync following group with rw permission after initial create of first agent
# login)
$Self-&gt;{'AuthSyncModule::LDAP::UserSyncInitialGroups'} = [
    'users',
];
</pre><p>
</p><p>
<span class="emphasis"><em>Сценарий: Синхронизация пользовательских данных из
LDAP-директориив базу данных OTRS.</em></span>
</p></div><div class="section" title="HTTPBasicAuth-аутентификация для Агентов"><div class="titlepage"><div><div><h5 class="title"><a name="agent-auth-backend-httpbasic"></a>HTTPBasicAuth-аутентификация для Агентов</h5></div></div></div><p>
Если вы хотите реализовать решение "single sign on" для всех агентов, вы
можете использовать базовую аунентификацию (для всех систем) и
HTTPBasicAuth-модуль для OTRS (см. ниже Пример 11-8).
</p><div class="example"><a name="configuration-agent-auth-backend-htbasic"></a><p class="title"><b>Пример 4.12. Аутентификация Агентов с помощью HTTPBasic</b></p><div class="example-contents"><p>
</p><pre class="programlisting">
# This is an example configuration for an apache ($ENV{REMOTE_USER})
# auth. backend. Use it if you want to have a singe login through
# apache http-basic-auth
$Self-&gt;{'AuthModule'} = 'Kernel::System::Auth::HTTPBasicAuth';

# Note:
#
# If you use this module, you should use as fallback
# the following configuration settings if the user is not authorized
# apache ($ENV{REMOTE_USER})
$Self-&gt;{LoginURL} = 'http://host.example.com/not-authorised-for-otrs.html';
$Self-&gt;{LogoutURL} = 'http://host.example.com/thanks-for-using-otrs.html';
</pre><p>
</p></div></div><br class="example-break"></div><div class="section" title="Radius"><div class="titlepage"><div><div><h5 class="title"><a name="agent-auth-backend-radius"></a>Radius</h5></div></div></div><p>
Параметры конфигурации приведенные в Примере 11-9 могут быть использованы
для аутентификации агентов с использованием Radius-сервера.
</p><div class="example"><a name="configuration-agent-auth-backend-radius"></a><p class="title"><b>Пример 4.13. Аутентификация (проверка подлинности) агентов с использованием
Radius-сервера в качестве хранилища информации</b></p><div class="example-contents"><p>
</p><pre class="programlisting">
# This is example configuration to auth. agents against a radius server
$Self-&gt;{'AuthModule'} = 'Kernel::System::Auth::Radius';
$Self-&gt;{'AuthModule::Radius::Host'} = 'radiushost';
$Self-&gt;{'AuthModule::Radius::Password'} = 'radiussecret';
</pre><p>
</p></div></div><br class="example-break"></div></div><div class="section" title="Хранилища информации для аутентификации (проверки подлинности) клиентов"><div class="titlepage"><div><div><h4 class="title"><a name="customer-auth-backends"></a>Хранилища информации для аутентификации (проверки подлинности) клиентов</h4></div></div></div><div class="section" title="База Данных (По умолчанию)"><div class="titlepage"><div><div><h5 class="title"><a name="customer-auth-backend-db"></a>База Данных (По умолчанию)</h5></div></div></div><p>
Для аутентификации клиентов в OTRS, по умолчанию, используется база
данных. Используя базу данных в качестве хранилища,  все данные клиентов
можно редактировать через веб-интерфейс OTRS (см. ниже Пример 11-10).
</p><div class="example"><a name="configuration-customer-auth-backend-db"></a><p class="title"><b>Пример 4.14. Аутентификация Клиента в Базе Данных</b></p><div class="example-contents"><p>
</p><pre class="programlisting">
# This is the auth. module against the otrs db
$Self-&gt;{'Customer::AuthModule'} = 'Kernel::System::CustomerAuth::DB';
$Self-&gt;{'Customer::AuthModule::DB::Table'} = 'customer_user';
$Self-&gt;{'Customer::AuthModule::DB::CustomerKey'} = 'login';
$Self-&gt;{'Customer::AuthModule::DB::CustomerPassword'} = 'pw';
#$Self-&gt;{'Customer::AuthModule::DB::DSN'} = "DBI:mysql:database=customerdb;host=customerdbhost";
#$Self-&gt;{'Customer::AuthModule::DB::User'} = "some_user";
#$Self-&gt;{'Customer::AuthModule::DB::Password'} = "some_password";
</pre><p>
</p></div></div><br class="example-break"></div><div class="section" title="LDAP"><div class="titlepage"><div><div><h5 class="title"><a name="customer-auth-backend-ldap"></a>LDAP</h5></div></div></div><p>
Если у вас есть LDAP-каталог со всеми данными о клиентах, можно использовать
модуль LDAP для аутентификации клиентов в OTRS (см. Пример 11-11
ниже). Поскольку этот модуль имеет права только для чтения для данных из
LDAP-бэкенда, то нету возможности изменить данные клиента через веб.
</p><div class="example"><a name="configuration-customer-auth-backend-ldap"></a><p class="title"><b>Пример 4.15. Аутентификация пользователей с помощью LDAP-бэкэнда</b></p><div class="example-contents"><p>
</p><pre class="programlisting">
# This is an example configuration for an LDAP auth. backend.
# (make sure Net::LDAP is installed!)
$Self-&gt;{'Customer::AuthModule'} = 'Kernel::System::CustomerAuth::LDAP';
$Self-&gt;{'Customer::AuthModule::LDAP::Host'} = 'ldap.example.com';
$Self-&gt;{'Customer::AuthModule::LDAP::BaseDN'} = 'dc=example,dc=com';
$Self-&gt;{'Customer::AuthModule::LDAP::UID'} = 'uid';

# Check if the user is allowed to auth in a posixGroup
# (e. g. user needs to be in a group xyz to use otrs)
$Self-&gt;{'Customer::AuthModule::LDAP::GroupDN'} = 'cn=otrsallow,ou=posixGroups,dc=example,dc=com';
$Self-&gt;{'Customer::AuthModule::LDAP::AccessAttr'} = 'memberUid';
# for ldap posixGroups objectclass (just uid)
$Self-&gt;{'Customer::AuthModule::LDAP::UserAttr'} = 'UID';
# for non ldap posixGroups objectclass (full user dn)
#$Self-&gt;{'Customer::AuthModule::LDAP::UserAttr'} = 'DN';

# The following is valid but would only be necessary if the
# anonymous user does NOT have permission to read from the LDAP tree
$Self-&gt;{'Customer::AuthModule::LDAP::SearchUserDN'} = '';
$Self-&gt;{'Customer::AuthModule::LDAP::SearchUserPw'} = '';

# in case you want to add always one filter to each ldap query, use
# this option. e. g. AlwaysFilter =&gt; '(mail=*)' or AlwaysFilter =&gt; '(objectclass=user)'
$Self-&gt;{'Customer::AuthModule::LDAP::AlwaysFilter'} = '';

# in case you want to add a suffix to each customer login name, then
# you can use this option. e. g. user just want to use user but
# in your ldap directory exists user@domain.
#$Self-&gt;{'Customer::AuthModule::LDAP::UserSuffix'} = '@domain.com';

# Net::LDAP new params (if needed - for more info see perldoc Net::LDAP)
$Self-&gt;{'Customer::AuthModule::LDAP::Params'} = {
    port =&gt; 389,
    timeout =&gt; 120,
    async =&gt; 0,
    version =&gt; 3,
};
</pre><p>
</p></div></div><br class="example-break"></div><div class="section" title="HTTPBasicAuth аутентификация для клиентов"><div class="titlepage"><div><div><h5 class="title"><a name="customer-auth-backend-httpbasic"></a>HTTPBasicAuth аутентификация для клиентов</h5></div></div></div><p>
Если для пользователей нужно внедрить "single sign on"-решение, можно
использовать базовую, HTTPBasic аутентификацию (для всех систем) и
использовать модуль HTTPBasicAuth с OTRS (больше не нужно логинится в
OTRS). См. ниже Пример 11-12.
</p><div class="example"><a name="configuration-customer-auth-backend-htbasic"></a><p class="title"><b>Пример 4.16. Аутентификация клиентов с помощью HTTPBasic</b></p><div class="example-contents"><p>
</p><pre class="programlisting">
# This is an example configuration for an apache ($ENV{REMOTE_USER})
# auth. backend. Use it if you want to have a singe login through
# apache http-basic-auth
$Self-&gt;{'Customer::AuthModule'} = 'Kernel::System::CustomerAuth::HTTPBasicAuth';

# Note:
# If you use this module, you should use the following
# config settings as fallback, if user isn't login through
# apache ($ENV{REMOTE_USER})
$Self-&gt;{CustomerPanelLoginURL} = 'http://host.example.com/not-authorised-for-otrs.html';
$Self-&gt;{CustomerPanelLogoutURL} = 'http://host.example.com/thanks-for-using-otrs.html';
</pre><p>
</p></div></div><br class="example-break"></div><div class="section" title="Radius"><div class="titlepage"><div><div><h5 class="title"><a name="customer-auth-backend-radius"></a>Radius</h5></div></div></div><p>
Настройки приведенные в примере 11-13 могут быть использованы для
аутентификации ваших клиентов с помощью Radius-сервера.
</p><div class="example"><a name="configuration-customer-auth-backend-radius"></a><p class="title"><b>Пример 4.17. Аутентификация клиентов с использованием Radius</b></p><div class="example-contents"><p>
</p><pre class="programlisting">
# This is a example configuration to auth. customer against a radius server
$Self-&gt;{'Customer::AuthModule'} = 'Kernel::System::Auth::Radius';
$Self-&gt;{'Customer::AuthModule::Radius::Host'} = 'radiushost';
$Self-&gt;{'Customer::AuthModule::Radius::Password'} = 'radiussecret';
</pre><p>
</p></div></div><br class="example-break"></div></div></div><div class="section" title="Настройка самостоятельной регистрации клиента"><div class="titlepage"><div><div><h3 class="title"><a name="customer-self-registration"></a>Настройка самостоятельной регистрации клиента</h3></div></div></div><p>
Есть возможность настроить самостоятельную регистрацию новых клиентов,
доступную через панель customer.pl. Можно добавить новые дополнительные или
обязательные поля, такие как номер комнаты, адрес или состояние.
</p><p>
В следующем примере показано каким образом можно указать обязательные для
заполнения поля в базе данных клиентов, в данном случае, для хранения номера
клиента.
</p><div class="section" title="Настройка веб-интерфейса"><div class="titlepage"><div><div><h4 class="title"><a name="customer-self-registration-dtl"></a>Настройка веб-интерфейса</h4></div></div></div><p>
Для отображения нового поля для номера комнаты в веб-интерфейсе пользователя
(customer.pl), нужно внести изменения в .dtl-файл, который отвечает за
шаблон этого интерфейса. Отредактируйте файл
<code class="filename">Kernel/Output/HTML/Standard/CustomerLogin.dtl</code> добавив
новые поля после строки 80 (см. нижеприведенный сценарий).
</p><p>
</p><pre class="programlisting">
[...]
&lt;div class="NewLine"&gt;
    &lt;label for="Room"&gt;$Text{"Room{CustomerUser}"}&lt;/label&gt;
    &lt;input title="$Text{"Room Number"}" name="Room" type="text" id="UserRoom" maxlength="50" /&gt;
&lt;/div&gt;
[...]
</pre><p>
</p><p>
<span class="emphasis"><em>Сценарий: Отображение новых полей в веб-интерфейсе.</em></span>
</p></div><div class="section" title="Отображения клиентов"><div class="titlepage"><div><div><h4 class="title"><a name="customer-self-registration-mapping"></a>Отображения клиентов</h4></div></div></div><p>
На следующем этапе, нужно внести изменения в маппинг (mapping), рассширив
его новым элементом - номером комнаты. Чтобы убедится что изменения не
потеряются после обновления, установите настройкы "CustomerUser" из файла
<code class="filename">Kernel/Config/Defaults.pm</code> в файл
<code class="filename">Kernel/Config.pm</code>. Теперь измените MAP-массив, добавив
новое поле - номер комнаты, как это показано в нижеприведенном сценарии.
</p><p>
</p><pre class="programlisting">
# CustomerUser
# (customer database backend and settings)
$Self-&gt;{CustomerUser} = {
    Name =&gt; 'Database Backend',
    Module =&gt; 'Kernel::System::CustomerUser::DB',
    Params =&gt; {
        # if you want to use an external database, add the
        # required settings
#        DSN =&gt; 'DBI:odbc:yourdsn',
#        Type =&gt; 'mssql', # only for ODBC connections
#        DSN =&gt; 'DBI:mysql:database=customerdb;host=customerdbhost',
#        User =&gt; '',
#        Password =&gt; '',
        Table =&gt; 'customer_user',
    },
    # customer unique id
    CustomerKey =&gt; 'login',
    # customer #
    CustomerID =&gt; 'customer_id',
    CustomerValid =&gt; 'valid_id',
    CustomerUserListFields =&gt; ['first_name', 'last_name', 'email'],
#    CustomerUserListFields =&gt; ['login', 'first_name', 'last_name', 'customer_id', 'email'],
    CustomerUserSearchFields =&gt; ['login', 'last_name', 'customer_id'],
    CustomerUserSearchPrefix =&gt; '',
    CustomerUserSearchSuffix =&gt; '*',
    CustomerUserSearchListLimit =&gt; 250,
    CustomerUserPostMasterSearchFields =&gt; ['email'],
    CustomerUserNameFields =&gt; ['title', 'first_name', 'last_name'],
    CustomerUserEmailUniqCheck =&gt; 1,
#    # show not own tickets in customer panel, CompanyTickets
#    CustomerUserExcludePrimaryCustomerID =&gt; 0,
#    # generate auto logins
#    AutoLoginCreation =&gt; 0,
#    AutoLoginCreationPrefix =&gt; 'auto',
#    # admin can change customer preferences
#    AdminSetPreferences =&gt; 1,
#    # cache time to live in sec. - cache database queries
#    CacheTTL =&gt; 0,
#    # just a read only source
#    ReadOnly =&gt; 1,
    Map =&gt; [

        # note: Login, Email and CustomerID needed!
        # var, frontend, storage, shown (1=always,2=lite), required, storage-type, http-link, readonly, http-link-target
        [ 'UserTitle',      'Title',      'title',       1, 0, 'var', '', 0 ],
        [ 'UserFirstname',  'Firstname',  'first_name',  1, 1, 'var', '', 0 ],
        [ 'UserLastname',   'Lastname',   'last_name',   1, 1, 'var', '', 0 ],
        [ 'UserLogin',      'Username',   'login',       1, 1, 'var', '', 0 ],
        [ 'UserPassword',   'Password',   'pw',          0, 0, 'var', '', 0 ],
        [ 'UserEmail',      'Email',      'email',       1, 1, 'var', '', 0 ],
        [ 'UserCustomerID', 'CustomerID', 'customer_id', 0, 1, 'var', '', 0 ],
        [ 'UserPhone',      'Phone',      'phone',       1, 0, 'var', '', 0 ],
        [ 'UserFax',        'Fax',        'fax',         1, 0, 'var', '', 0 ],
        [ 'UserMobile',     'Mobile',     'mobile',      1, 0, 'var', '', 0 ],
        [ 'UserRoom',       'Room',       'room',        1, 0, 'var', '', 0 ],
        [ 'UserStreet',     'Street',     'street',      1, 0, 'var', '', 0 ],
        [ 'UserZip',        'Zip',        'zip',         1, 0, 'var', '', 0 ],
        [ 'UserCity',       'City',       'city',        1, 0, 'var', '', 0 ],
        [ 'UserCountry',    'Country',    'country',     1, 0, 'var', '', 0 ],
        [ 'UserComment',    'Comment',    'comments',    1, 0, 'var', '', 0 ],
        [ 'ValidID',        'Valid',      'valid_id',    0, 1, 'int', '', 0 ],
    ],
    # default selections
    Selections =&gt; {
        UserTitle =&gt; {
            'Mr.' =&gt; 'Mr.',
            'Mrs.' =&gt; 'Mrs.',
        },
    },
};
</pre><p>
</p><p>
<span class="emphasis"><em>Сценарий: Внесение изменений в map-массив.</em></span>
</p></div><div class="section" title="Настройка таблицы customer_user в Базе Данных OTRS DB"><div class="titlepage"><div><div><h4 class="title"><a name="customer-self-registration-customer-table"></a>Настройка таблицы customer_user в Базе Данных OTRS DB</h4></div></div></div><p>
Последним шагом является добавление нового столбца с номером комнаты в
таблицу customer_user базы данных OTRS (см. нижеприведенный сценарий). В
этой колонке будет хранится информация для номера комнаты.
</p><p>
</p><pre class="screen">
linux:~# mysql -p
Enter password:
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 6 to server version: 5.0.18-Debian_7-log

Type 'help;' or '\h' for help. Type '\c' to clear the buffer.

mysql&gt; use otrs;
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
mysql&gt; ALTER TABLE customer_user ADD room VARCHAR (200);
Query OK, 3 rows affected (0.01 sec)
Records: 3  Duplicates: 0  Warnings: 0

mysql&gt; quit
Bye
linux:~#
</pre><p>
</p><p>
<span class="emphasis"><em>Сценарий: Добавление новой колонки в таблицу
customer_user.</em></span>
</p><p>
Now the new field for the room should be displayed in the Customer
Information panel if filled, and in the Customer User administration
screens. Also, new customers should have to insert their room number if they
register a new account. If you use OTRS on Microsoft IIS, you should restart
the web server to activate the changes made in
<code class="filename">Config.pm</code>.
</p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="email-settings.html">Пред.</a> </td><td width="20%" align="center"><a accesskey="u" href="administration.html">Уровень выше</a></td><td width="40%" align="right"> <a accesskey="n" href="ticket-settings.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">Настройки электронной почты </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> Настройки Заявки</td></tr></table></div>
<!-- End OriginalBodyContent -->
            </div>
            <div id="footer">
                <p class="copyright">
            Copyright &copy;  2001-2012 OTRS Team, All Rights Reserved.
            - <a href="http://www.otrs.com/en/corporate-navigation/imprint/">Imprint</a>
                </p>
            </div>
        </div>
    </div>
</div>
<script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="../../../../doku.js"></script>
</body>
</html>
